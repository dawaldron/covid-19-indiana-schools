window.Teal=window.Teal||{};class Comscore{constructor(t){this.parent=t,this.settings=t.settings,this.pageData=t.pageData,this.settings.comscore.load&&!window.ns_?this.load():window.ns_&&this.init()}async load(){try{await Teal.Utils.loadAndWaitForInit(this.settings.comscore.scriptUrl,"tealplayer_comscore","ns_"),this.init()}catch(t){}}init(){this.parent.sm.subscribe(this,{META:this._onMetaChange,STATE:this._onStateChange}),this._setStreamingTag()}_setStreamingTag(){this.video={streamingTag:new window.ns_.StreamingTag({customerC2:this.settings.comscore.c2}),video:this.parent.elements.video,metadata:{c3:this.pageData.baseName,c4:this.parent.data.ssts.section,c6:"*null",c7:this.parent.data.pageURL.long,c8:this.parent.data.title,ns_st_ce:"*null",ns_st_ci:this.parent.data.id,ns_st_cl:1e3*this.parent.data.length,ns_st_ddt:this.parent.data.publishDate,ns_st_ge:this.parent.data.ssts.section,ns_st_ia:"*null",ns_st_tdt:"*null",ns_st_ti:"*null"}}}_onStateChange(t){t.controller===this.parent.sm.controllers.PREROLL?this._onStateChangePreroll(t.state):t.controller===this.parent.sm.controllers.VIDEO&&this._onStateChangeVideo(t.state)}_onStateChangePreroll(t){switch(t){case this.parent.sm.states.STARTED:this.comscoreAdPlayback();break;case this.parent.sm.states.DONE:this._stopStreamingTag()}}_onStateChangeVideo(t){switch(t){case this.parent.sm.states.STARTED:case this.parent.sm.states.PLAYING:this.comscoreContentPlayback();break;case this.parent.sm.states.PAUSED:case this.parent.sm.states.DONE:this._stopStreamingTag()}}comscoreAdPlayback(){this.video.streamingTag.playVideoAdvertisement({ns_st_cl:1e3*this.parent.ima.duration,ns_st_ci:this.video.metadata.ns_st_ci},window.ns_.StreamingTag.AdType.LinearOnDemandPreRoll)}comscoreContentPlayback(){this.video.streamingTag.playVideoContentPart(this.video.metadata,window.ns_.StreamingTag.ContentType.LongFormOnDemand)}_onMetaChange(t,s){t===this.parent.sm._docHidden.name&&s&&this._stopStreamingTag()}_stopStreamingTag(){this.video.streamingTag.stop()}}window.Teal.Comscore=Comscore;