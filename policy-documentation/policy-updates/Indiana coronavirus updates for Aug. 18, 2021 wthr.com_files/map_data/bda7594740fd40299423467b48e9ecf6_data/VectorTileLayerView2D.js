// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/has ../../../../core/ItemCache ../../../../core/promiseUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./TileIndex ./decluttering/debugging ../../tiling/TileKey".split(" "),function(A,F,y,k,r,t,e,c,d,a,b,l,v){const u=new r(10),h=new Map;r=function(){function p(n,x,D){this._vectorTileLayer=n;this._styleRepository=
x;this.devicePixelRatio=D;this._connection=this._glyphMosaic=this._spriteMosaic=null}var g=p.prototype;g.destroy=function(){this._connection&&(this._connection.close(),this._connection=null);this._vectorTileLayer=this._styleRepository=null;this._spriteMosaic&&(this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic=null)};g.start=function(){var n=F._asyncToGenerator(function*(x){const D=this._vectorTileLayer;var z=D.sourceNameToSource;const q=[];for(const B in z)q.push(this._fetchTileMap(z[B],
x));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,x);this._spriteSourcePromise.then(B=>{this._spriteMosaic=new a(1024,1024,250);this._spriteMosaic.setSpriteSource(B)});z=new d(this._styleRepository.glyphs);this._glyphMosaic=new c(1024,1024,z);this._broadcastPromise=e.open("WorkerTileHandler",{client:this,schedule:x.schedule,signal:x.signal}).then(B=>{this._connection=B;return Promise.all(this._connection.broadcast("setStyle",{style:D.currentStyleInfo.style,
vectorTileLayerMaxBuffers:k("vectortilelayer-max-buffers")},x))});return Promise.all(q)});return function(x){return n.apply(this,arguments)}}();g.updateStyle=function(){var n=F._asyncToGenerator(function*(x){yield this._broadcastPromise;return this._broadcastPromise=new Promise((D,z)=>{Promise.all(this._connection.broadcast("updateStyle",x)).then(D,z)})});return function(x){return n.apply(this,arguments)}}();g.setStyle=function(){var n=F._asyncToGenerator(function*(x,D){yield this._broadcastPromise;
this._styleRepository=x;const z=this._vectorTileLayer.sourceNameToSource,q=[];for(const B in z)q.push(this._fetchTileMap(z[B],null));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,null);this._spriteSourcePromise.then(B=>{this._spriteMosaic=new a(1024,1024,250);this._spriteMosaic.setSpriteSource(B)});x=new d(x.glyphs);this._glyphMosaic=new c(1024,1024,x);this._broadcastPromise=new Promise((B,H)=>{Promise.all(this._connection.broadcast("setStyle",{style:D,vectorTileLayerMaxBuffers:k("vectortilelayer-max-buffers")})).then(B,
H)});q.push(this._broadcastPromise);return Promise.all(q)});return function(x,D){return n.apply(this,arguments)}}();g.fetchTileData=function(n,x){return this._getRefKeys(n,x).then(D=>{const z=this._vectorTileLayer.sourceNameToSource,q=[];for(const B in z)q.push(B);return this._getSourcesData(q,D,x)})};g.parseTileData=function(n,x){const D=n&&n.data;if(!D)return Promise.resolve(null);const {sourceName2DataAndRefKey:z,transferList:q}=D;return 0===Object.keys(z).length?Promise.resolve(null):this._broadcastPromise.then(()=>
this._connection.getAvailableClient().then(B=>B.invoke("createTileAndParse",{key:n.key.id,sourceName2DataAndRefKey:z,styleLayerUIDs:n.styleLayerUIDs},{...x,transferList:q}).then(H=>({tileData:H}))))};g.getSprites=function(){var n=F._asyncToGenerator(function*(x){yield this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(x)});return function(x){return n.apply(this,arguments)}}();g.getGlyphs=function(n){return this._glyphMosaic.getGlyphItems(n.font,n.codePoints)};g.perfReport=function({key:n,
milliseconds:x}){l.perfAdd(n,x,"ms")};g._getTilePayload=function(){var n=F._asyncToGenerator(function*(x,D,z){x=v.pool.acquire(x.id);const q=this._vectorTileLayer.sourceNameToSource[D].getSourceTileUrl(x.level,x.row,x.col);v.pool.release(x);try{return{protobuff:yield this.request(q,z),sourceName:D}}catch(B){if(t.isAbortError(B))throw B;return{protobuff:null,sourceName:D}}});return function(x,D,z){return n.apply(this,arguments)}}();g.request=function(n,x){return y(n,{responseType:"array-buffer",...x}).then(({data:D})=>
D)};g._fetchTileMap=function(){var n=F._asyncToGenerator(function*(x,D){if(x.capabilities.operations.supportsTileMap&&x.tileIndex)return Promise.resolve();if(x.tileMapURL){var z=u.get(x.tileMapURL);if(z)x.tileIndex=z;else if(h.has(x.tileMapURL))try{var q=yield h.get(x.tileMapURL);x.tileIndex=new b(q.data)}catch(B){if(t.isAbortError(B))throw B;}else{D=y(x.tileMapURL,D);h.set(x.tileMapURL,D);try{q=yield D,h.delete(x.tileMapURL),u.put(x.tileMapURL,x.tileIndex),x.tileIndex=new b(q.data)}catch(B){if(h.delete(x.tileMapURL),
t.isAbortError(B))throw B;}}}});return function(x,D){return n.apply(this,arguments)}}();g._getRefKeys=function(n,x){const D=this._vectorTileLayer.sourceNameToSource,z=[];for(const q in D){const B=D[q].getRefKey(n,x);z.push(B)}return t.eachAlways(z)};g._getSourcesData=function(n,x,D){const z=[];for(let q=0;q<x.length;q++)if(null==x[q].value||null==n[q])z.push(null);else{const B=this._getTilePayload(x[q].value,n[q],D);z.push(B)}return t.eachAlways(z).then(q=>{const B={},H=[];for(let I=0;I<q.length;I++)q[I].value&&
q[I].value&&q[I].value.protobuff&&0<q[I].value.protobuff.byteLength&&(B[q[I].value.sourceName]={refKey:x[I].value.id,protobuff:q[I].value.protobuff},H.push(q[I].value.protobuff));return{sourceName2DataAndRefKey:B,transferList:H}})};F._createClass(p,[{key:"spriteMosaic",get:function(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}}]);return p}();A.TileHandler=r;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define("../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject ./RectangleBinPack ../webgl/Rect".split(" "),
function(A,F,y,k,r,t,e,c,d,a,b){return function(){function l(u,h,p){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=u;this.height=h;this._glyphSource=p;this._binPack=new a(u-4,h-4);this._glyphData.push(new Uint8Array(u*h));this._dirties.push(!0);this._textures.push(void 0)}var v=l.prototype;v.getGlyphItems=function(u,h){const p=[],g=this._glyphSource,n=new Set,x=1/256;for(const z of h)n.add(Math.floor(z*
x));const D=[];n.forEach(z=>{if(256>=z){const q=u+z;this._rangePromises.has(q)?D.push(this._rangePromises.get(q)):(z=g.getRange(u,z).then(()=>{this._rangePromises["delete"](q)},()=>{this._rangePromises["delete"](q)}),this._rangePromises.set(q,z),D.push(z))}});return Promise.all(D).then(()=>{let z=this._glyphIndex[u];z||(z={},this._glyphIndex[u]=z);for(const G of h){var q=z[G];if(q){p[G]={sdf:!0,rect:q.rect,metrics:q.metrics,page:q.page,code:G};continue}var B=g.getGlyph(u,G);if(!B||!B.metrics)continue;
q=B.metrics;let J;if(0===q.width)J=new b(0,0,0,0);else{const O=q.width+6,P=q.height+6;var H=O%4?4-O%4:4,I=P%4?4-P%4:4;1===H&&(H=5);1===I&&(I=5);J=this._binPack.allocate(O+H,P+I);J.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new a(this.width-4,this.height-4),J=this._binPack.allocate(O+H,P+I));
H=this._glyphData[this._currentPage];B=B.bitmap;let Q;if(B)for(let L=0;L<P;L++){I=O*L;Q=this.width*(J.y+L+1)+J.x;for(let M=0;M<O;M++)H[Q+M+1]=B[I+M]}}z[G]={rect:J,metrics:q,tileIDs:null,page:this._currentPage};p[G]={sdf:!0,rect:J,metrics:q,page:this._currentPage,code:G};this._dirties[this._currentPage]=!0}return p})};v.removeGlyphs=function(u){for(const h in this._glyphIndex){const p=this._glyphIndex[h];if(!p)continue;let g;for(const n in p)if(g=p[n],g.tileIDs["delete"](u),0===g.tileIDs.size){const x=
this._glyphData[g.page],D=g.rect;let z,q;for(let B=0;B<D.height;B++)for(z=this.width*(D.y+B)+D.x,q=0;q<D.width;q++)x[z+q]=0;delete p[n];this._dirties[g.page]=!0}}};v.bind=function(u,h,p,g=0){this._textures[p]||(this._textures[p]=new c(u,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));const n=this._textures[p];n.setSamplingMode(h);this._dirties[p]&&n.setData(this._glyphData[p]);u.bindTexture(n,g);this._dirties[p]=!1};v.dispose=function(){this._binPack=
null;for(const u of this._textures)u&&u.dispose();this._textures.length=0};return l}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../webgl/Rect"],function(A,F){return function(){function y(r,t){this._height=this._width=0;this._free=[];this._width=r;this._height=t;this._free.push(new F(0,0,r,t))}var k=y.prototype;k.allocate=function(r,t){if(r>this._width||t>this._height)return new F;let e=null,c=-1;for(let d=0;d<this._free.length;++d){const a=
this._free[d];r<=a.width&&t<=a.height&&(null===e||a.y<=e.y&&a.x<=e.x)&&(e=a,c=d)}if(null===e)return new F;this._free.splice(c,1);e.width<e.height?(e.width>r&&this._free.push(new F(e.x+r,e.y,e.width-r,t)),e.height>t&&this._free.push(new F(e.x,e.y+t,e.width,e.height-t))):(e.width>r&&this._free.push(new F(e.x+r,e.y,e.width-r,e.height)),e.height>t&&this._free.push(new F(e.x,e.y+t,r,e.height-t)));return new F(e.x,e.y,r,t)};k.release=function(r){for(let t=0;t<this._free.length;++t){const e=this._free[t];
if(e.y===r.y&&e.height===r.height&&e.x+e.width===r.x)e.width+=r.width;else if(e.x===r.x&&e.width===r.width&&e.y+e.height===r.y)e.height+=r.height;else if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)e.x=r.x,e.width+=r.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)e.y=r.y,e.height+=r.height;else continue;this._free.splice(t,1);this.release(r)}this._free.push(r)};A._createClass(y,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);
return y}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(A,F){let y=function(){function r(e){this._metrics=[];this._bitmaps=[];if(e)for(;e.next();)switch(e.tag()){case 1:{const c=e.getMessage();for(;c.next();)switch(c.tag()){case 3:{const d=c.getMessage();let a,b,l,v,u,h,p;for(;d.next();)switch(d.tag()){case 1:a=d.getUInt32();break;case 2:b=d.getBytes();break;case 3:l=d.getUInt32();break;case 4:v=d.getUInt32();break;case 5:u=
d.getSInt32();break;case 6:h=d.getSInt32();break;case 7:p=d.getUInt32();break;default:d.skip()}d.release();a&&(this._metrics[a]={width:l,height:v,left:u,top:h,advance:p},this._bitmaps[a]=b);break}default:c.skip()}c.release();break}default:e.skip()}}var t=r.prototype;t.getMetrics=function(e){return this._metrics[e]};t.getBitmap=function(e){return this._bitmaps[e]};return r}(),k=function(){function r(){this._ranges=[]}var t=r.prototype;t.getRange=function(e){return this._ranges[e]};t.addRange=function(e,
c){this._ranges[e]=c};return r}();return function(){function r(e){this._glyphInfo={};this._baseURL=e}var t=r.prototype;t.getRange=function(e,c){const d=this._getFontStack(e);if(d.getRange(c))return Promise.resolve();const a=256*c,b=a+255;e=this._baseURL.replace("{fontstack}",e).replace("{range}",a+"-"+b);return A(e,{responseType:"array-buffer"}).then(l=>{d.addRange(c,new y(new F(new Uint8Array(l.data),new DataView(l.data))))}).catch(()=>{d.addRange(c,new y)})};t.getGlyph=function(e,c){if(e=this._getFontStack(e)){var d=
Math.floor(c/256);if(!(256<d)&&(e=e.getRange(d)))return{metrics:e.getMetrics(c),bitmap:e.getBitmap(c)}}};t._getFontStack=function(e){let c=this._glyphInfo[e];c||(c=this._glyphInfo[e]=new k);return c};return r}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../symbols/cim/CIMSymbolHelper ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject ./RectangleBinPack ../webgl/Rect".split(" "),
function(A,F,y,k,r,t,e,c,d,a,b,l){return function(){function v(h,p,g=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=h||0>=p)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=h;this._pageHeight=p;0<g&&(this._maxItemSize=g);this._binPack=new b(h-4,p-4)}var u=v.prototype;u.dispose=function(){this._binPack=
null;this._mosaicRects={};for(const h of this._textures)h&&h.dispose();this._textures.length=0};u.getWidth=function(h){return h>=this._size.length?-1:this._size[h][0]};u.getHeight=function(h){return h>=this._size.length?-1:this._size[h][1]};u.getPageSize=function(h){return h>=this._size.length?null:this._size[h]};u.setSpriteSource=function(h){this.dispose();this.pixelRatio=h.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new b(this._pageWidth-4,this._pageHeight-4);const p=new Uint32Array(Math.floor(this._pageWidth)*
Math.floor(this._pageHeight));this._mosaicsData[0]=p;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=h};u.getSpriteItem=function(h,p=!1){var g=this._mosaicRects[h];if(g)return g;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let n;h&&h.startsWith("dasharray-")?([g,n]=this._rasterizeDash(h),p=!0):g=this._sprites.getSpriteInfo(h);if(!g||!g.width||!g.height||0>g.width||0>g.height)return null;const x=g.width,D=g.height,
[z,q,B]=this._allocateImage(x,D);if(0>=z.width)return null;this._copy(z,g,q,B,p,n);g={rect:z,width:x,height:D,sdf:g.sdf,simplePattern:!1,pixelRatio:g.pixelRatio,page:q};return this._mosaicRects[h]=g};u.getSpriteItems=function(h){const p={};for(const g of h)p[g.name]=this.getSpriteItem(g.name,g.repeat);return p};u.getMosaicItemPosition=function(h,p){p=(h=this.getSpriteItem(h,p))&&h.rect;if(!p)return null;p.width=h.width;p.height=h.height;return{tl:[p.x+2,p.y+2],br:[p.x+2+h.width,p.y+2+h.height],page:h.page}};
u.bind=function(h,p,g=0,n=0){this._textures[g]||(this._textures[g]=new d(h,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[g][0],height:this._size[g][1]},new Uint8Array(this._mosaicsData[g].buffer)));const x=this._textures[g];x.setSamplingMode(p);this._dirties[g]&&x.setData(new Uint8Array(this._mosaicsData[g].buffer));h.bindTexture(x,n);this._dirties[g]=!1};v._copyBits=function(h,p,g,n,x,D,z,q,B,H,I){let G=n*p+g;z=q*D+z;if(I)for(z-=D,I=-1;I<=H;I++,G=((I+H)%H+n)*p+g,z+=D)for(q=-1;q<=
B;q++)x[z+q]=h[G+(q+B)%B];else for(g=0;g<H;g++){for(n=0;n<B;n++)x[z+n]=h[G+n];G+=p;z+=D}};u._copy=function(h,p,g,n,x,D){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(g>=this._mosaicsData.length)){var z=new Uint32Array(D?D.buffer:this._sprites.image.buffer),q=this._mosaicsData[g];q&&z||console.error("Source or target images are uninitialized!");v._copyBits(z,D?p.width:this._sprites.width,p.x,p.y,q,n[0],h.x+2,h.y+2,p.width,p.height,x);this._dirties[g]=!0}};u._allocateImage=function(h,p){h+=
2;p+=2;var g=Math.max(h,p);if(this._maxItemSize&&this._maxItemSize<g)return g=new l(0,0,h,p),this._mosaicsData.push(new Uint32Array(h*p)),this._dirties.push(!0),this._size.push([h,p]),this._textures.push(void 0),[g,this._mosaicsData.length-1,[h,p]];g=h%4?4-h%4:4;let n=p%4?4-p%4:4;1===g&&(g=5);1===n&&(n=5);g=this._binPack.allocate(h+g,p+n);return 0>=g.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*
this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new b(this._pageWidth-4,this._pageHeight-4),this._allocateImage(h,p)):[g,this._currentPage,[this._pageWidth,this._pageHeight]]};u._rasterizeDash=function(h){var p=h.match(/\[(.*?)\]/);if(!p)return null;p=p[1].split(",").map(Number);h=h.slice(h.lastIndexOf("-")+1);const [g,n,x]=A.SymbolHelper.rasterizeDash(p,h);h=new Uint8Array(g.buffer);return[{x:0,y:0,width:n,height:x,
sdf:!0,pixelRatio:1},h]};return v}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(A,F,y){return function(){function k(t){if(t instanceof F.TilemapCache)this._tilemapCache=t;else if(t&&"index"in t)this._tilemap=t.index;else throw Error("Invalid tilemap!");}var r=k.prototype;r.dataKey=function(t,e){if(this._tilemapCache){const {level:c,row:d,col:a}=t,b=new y(t);return this._tilemapCache.fetchAvailabilityUpsample(c,
d,a,b,e).then(()=>{b.world=t.world;return b}).catch(l=>{if(A.isAbortError(l))throw l;return null})}return this._getIndexedDataKey(t)};r.forEach=function(t,e,c,d,a){this._callback=a;this._maxLevel=e+t;this._forEach(this._tilemap,e,c,d)};r._forEach=function(t,e,c,d){0!==t&&(this._callback(e,c,d),e!==this._maxLevel&&"object"===typeof t&&(this._forEach(t[0],e+1,2*c,2*d),this._forEach(t[1],e+1,2*c,2*d+1),this._forEach(t[2],e+1,2*c+1,2*d),this._forEach(t[3],e+1,2*c+1,2*d+1)))};r._getIndexedDataKey=function(t){const e=
[t];if(0>t.level||0>t.row||0>t.col||0<t.row>>t.level||0<t.col>>t.level)return Promise.resolve(null);for(;0!==t.level;)t=new y(t.level-1,t.row>>1,t.col>>1,t.world),e.push(t);t=this._tilemap;let c=e.pop(),d,a;if(1===t)return Promise.resolve(c);for(;e.length;)if(d=e.pop(),a=(d.col&1)+((d.row&1)<<1),t){if(0===t[a]){c=null;break}if(1===t[a]){c=d;break}c=d;t=t[a]}return Promise.resolve(c)};return k}()})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./Tilemap".split(" "),
function(A,F,y,k,r,t,e,c,d,a,b,l,v,u,h,p,g,n,x,D){var z;const q=c.getLogger("esri.layers.support.TilemapCache");A.TilemapCache=z=function(B){function H(G){G=B.call(this,G)||this;G._handles=new e;G._pendingTilemapRequests={};G._availableLevels={};G.levels=5;G.cacheByteSize=2097152;G.request=k;G._prefetchingEnabled=!0;return G}F._inheritsLoose(H,B);var I=H.prototype;I.initialize=function(){this._tilemapCache=new d(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),u.init(this,"layer.tileInfo.lods",G=>this._initializeAvailableLevels(G),!0)]);this._initializeTilemapDefinition()};I.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};I.castLevels=function(G){return 2>=G?(q.error("Minimum levels for Tilemap is 3, but got ",G),3):G};I.fetchTilemap=function(G,J,O,P){if(!this._availableLevels[G])return Promise.reject(new t("tilemap-cache:level-unavailable",`Level ${G} is unavailable in the service`));
const Q=this._tmpTilemapDefinition;if(G=this._tilemapFromCache(G,J,O,Q))return Promise.resolve(G);const L=P&&P.signal;P={...P,signal:null};return new Promise((M,K)=>{b.onAbort(L,()=>K(b.createAbortError()));const S=D.tilemapDefinitionId(Q);let U=this._pendingTilemapRequests[S];if(!U){U=D.Tilemap.fromDefinition(Q,P).then(aa=>{this._tilemapCache.put(S,aa,aa.byteSize);return aa});const W=()=>delete this._pendingTilemapRequests[S];this._pendingTilemapRequests[S]=U;U.then(W,W)}U.then(M,K)})};I.getAvailability=
function(G,J,O){return this._availableLevels[G]?(G=this._tilemapFromCache(G,J,O,this._tmpTilemapDefinition))?G.getAvailability(J,O):"unknown":"unavailable"};I.getAvailabilityUpsample=function(G,J,O,P){P.level=G;P.row=J;P.col=O;G=this.layer.tileInfo;for(G.updateTileInfo(P);;)if(J=this.getAvailability(P.level,P.row,P.col),"unavailable"===J){if(!G.upsampleTile(P))return"unavailable"}else return J};I.fetchAvailability=function(G,J,O,P){return this._availableLevels[G]?this.fetchTilemap(G,J,O,P).catch(Q=>
Q).then(Q=>{if(Q instanceof D.Tilemap)return Q=Q.getAvailability(J,O),"unavailable"===Q?Promise.reject(new t("tile-map:tile-unavailable","Tile is not available",{level:G,row:J,col:O})):Q;if(b.isAbortError(Q))throw Q;return"unknown"}):Promise.reject(new t("tilemap-cache:level-unavailable",`Level ${G} is unavailable in the service`))};I.fetchAvailabilityUpsample=function(G,J,O,P,Q){P.level=G;P.row=J;P.col=O;const L=this.layer.tileInfo;L.updateTileInfo(P);const M=this.fetchAvailability(G,J,O,Q).catch(K=>
{if(b.isAbortError(K))throw K;if(L.upsampleTile(P))return this.fetchAvailabilityUpsample(P.level,P.row,P.col,P);throw K;});this._fetchAvailabilityUpsamplePrefetch(P.id,G,J,O,Q,M);return M};I._fetchAvailabilityUpsamplePrefetch=function(){var G=F._asyncToGenerator(function*(J,O,P,Q,L,M){if(this._prefetchingEnabled){var K=`prefetch-${J}`;if(!this._handles.has(K)){var S=b.createAbortController();M.then(()=>S.abort(),()=>S.abort());var U=!1;this._handles.add({remove(){U||(U=!0,S.abort())}},K);yield l.waitTicks(10,
S.signal).catch(()=>{});U||(U=!0,this._handles.remove(K));if(!b.isAborted(S))for(J={id:J,level:O,row:P,col:Q},L={...L,signal:S.signal},O=this.layer.tileInfo,P=0;z._prefetches.length<z._maxPrefetch&&O.upsampleTile(J);++P){const W=this.fetchAvailability(J.level,J.row,J.col,L);z._prefetches.push(W);Q=()=>{z._prefetches.removeUnordered(W)};W.then(Q,Q)}}}});return function(J,O,P,Q,L,M){return G.apply(this,arguments)}}();I._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var G=this.layer.parsedUrl,
J=G.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:G.path,query:J?v.objectToQuery(J):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};I._tilemapFromCache=function(G,J,O,P){P.level=G;P.row=J-J%this.size;P.col=O-O%this.size;G=D.tilemapDefinitionId(P);return this._tilemapCache.get(G)};I._initializeAvailableLevels=function(G){this._availableLevels={};G&&G.forEach(J=>this._availableLevels[J.level]=
!0)};F._createClass(H,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const G=this;return{get prefetchingEnabled(){return G._prefetchingEnabled},set prefetchingEnabled(J){G._prefetchingEnabled=J},hasTilemap(J,O,P){return!!G._tilemapFromCache(J,O,P,G._tmpTilemapDefinition)}}}}]);return H}(r);A.TilemapCache._maxPrefetch=4;A.TilemapCache._prefetches=new a({initialSize:z._maxPrefetch});y.__decorate([h.property({constructOnly:!0,type:Number})],A.TilemapCache.prototype,"levels",
void 0);y.__decorate([g.cast("levels")],A.TilemapCache.prototype,"castLevels",null);y.__decorate([h.property({readOnly:!0,type:Number})],A.TilemapCache.prototype,"size",null);y.__decorate([h.property({constructOnly:!0,type:Number})],A.TilemapCache.prototype,"cacheByteSize",void 0);y.__decorate([h.property({constructOnly:!0})],A.TilemapCache.prototype,"layer",void 0);y.__decorate([h.property({constructOnly:!0})],A.TilemapCache.prototype,"request",void 0);A.TilemapCache=z=y.__decorate([x.subclass("esri.layers.support.TilemapCache")],
A.TilemapCache);Object.defineProperty(A,"__esModule",{value:!0})})},"esri/layers/support/Tilemap":function(){define(["exports","../../request","../../core/arrayUtils","../../core/Error","../../core/lang"],function(A,F,y,k,r){function t(c){if("vector-tile"===c.service.type)var d=`${c.service.url}/tilemap/${c.level}/${c.row}/${c.col}/${c.width}/${c.height}`;else d=c.service.tileServers,d=`${d&&d.length?d[c.row%d.length]:c.service.url}/tilemap/${c.level}/${c.row}/${c.col}/${c.width}/${c.height}`;(c=
c.service.query)&&(d=`${d}?${c}`);return d}let e=function(){function c(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var d=c.prototype;d.getAvailability=function(a,b){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(b-this.location.left);b=a>>3;const l=this._tileAvailabilityBitSet;return 0>b||b>l.length?"unknown":l[b]&1<<a%8?"available":"unavailable"};d._updateFromData=function(a){let b=
!0,l=!0;const v=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));let u=0;for(let h=0;h<a.length;h++){const p=h%8;a[h]?(l=!1,v[u]|=1<<p):b=!1;7===p&&++u}l?this._allAvailability="unavailable":b?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=v,this.byteSize+=v.length)};c.fromDefinition=function(a,b){const l=a.service.request||F,{row:v,col:u,width:h,height:p}=a,g={query:{f:"json"}};b=b?{...g,...b}:g;return l(t(a),b).then(n=>n.data).catch(n=>
{if(n&&n.details&&422===n.details.httpStatus)return{location:{top:v,left:u,width:h,height:p},valid:!0,data:y.constant(h*p,0)};throw n;}).then(n=>{if(n.location&&(n.location.top!==v||n.location.left!==u||n.location.width!==h||n.location.height!==p))throw new k("tilemap:location-mismatch","Tilemap response for different location than requested",{response:n,definition:{top:v,left:u,width:h,height:p}});return c.fromJSON(n)})};c.fromJSON=function(a){c.validateJSON(a);const b=new c;b.location=Object.freeze(r.clone(a.location));
b._updateFromData(a.data);return Object.freeze(b)};c.validateJSON=function(a){if(!a||!a.location)throw new k("tilemap:missing-location","Location missing from tilemap response");if(!1===a.valid)throw new k("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new k("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new k("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new k("tilemap:data-mismatch",
"Number of data items does not match width/height of tilemap");};return c}();A.Tilemap=e;A.default=e;A.tilemapDefinitionId=function(c){return`${c.level}/${c.row}/${c.col}/${c.width}/${c.height}`};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/debugging":function(){define(["exports"],function(A){function F(y,k){return`${Math.round(10*y)/10}${k}`}A.drawColliders=function(y,k){const r=window.COLLISION_XRAY;for(let v=0;v<k.length;++v){const u=!k[v].unique.show;
if(r||!u)for(const h of k[v].colliders){if(!h.enabled)continue;var t=!k[v].unique.parts[h.partIndex].show;if(!r&&t)continue;var e=h.xScreen,c=h.yScreen;const p=h.dxScreen,g=h.dyScreen;y.globalAlpha=u||t?.2:1;t=y;var d=e-1,a=c-1;t.fillStyle="green";t.fillRect(d,a,3,3);t=y;d=e+p;a=c+g;var b=h.width,l=h.height;t.strokeStyle="red";t.strokeRect(d,a,b,l);t=y;e=e+p-1;c=c+g-1;t.fillStyle="blue";t.fillRect(e,c,3,3);y.globalAlpha=1}}};A.drawGridIndex=function(y,k){y.strokeStyle="black";const r=k.cellSize,t=
k.rows,e=k.columns;for(let c=0;c<t;c++){const d=k.cells[c],a=c*r,b=(c+1)*r;for(let l=0;l<e;l++){const v=d[l],u=l*r;y.strokeRect(u,a,(l+1)*r-u,b-a);y.fillText(`cells:${v.length}`,u+4,a+12)}}};A.perfAdd=function(y,k,r){if(window.PERFORMANCE_RECORDING_STORAGE){var t=window.PERFORMANCE_RECORDING_STORAGE;t.perf=t.perf||{};t=t.perf;t[y]=t[y]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:r};t[y].time+=k;t[y].samples.push(k);if(null==t[y].min||k<t[y].min)t[y].min=k;if(null==t[y].max||k>t[y].max)t[y].max=
k}};A.perfClear=function(){window.PERFORMANCE_RECORDING_STORAGE&&(window.PERFORMANCE_RECORDING_STORAGE.perf={})};A.perfElement=function(y){if(!window.PERFORMANCE_RECORDING_STORAGE){var k=document.createElement("div");k.innerHTML="No recorded data is present because performance recording is disabled.";return k}k=document.createElement("div");var r=window.PERFORMANCE_RECORDING_STORAGE.perf;var t='\x3ctable style\x3d"border-collapse: collapse;"\x3e'+`<tr style="text-weight: bold; border-bottom: 1px solid "${y}";"><td>Name</td><td>Total</td><td>Runs</td><td>Average</td><td>Min</td><td>Distribution</td><td>Max</td><td>Histogram (${50} bins)</td></tr>`;
const e=[];for(var c in r)e.push({name:c,value:r[c].time/r[c].samples.length,sortkey:r[c].max});e.sort((u,h)=>-(u.sortkey-h.sortkey));c=e.map(u=>u.name);for(var d of c)t+="\x3ctr\x3e",t+=`<td>${d}</td>`,t+=`<td>${F(r[d].time,r[d].unit)}</td>`,t+=`<td>${r[d].samples.length}</td>`,t+=`<td>${F(r[d].time/r[d].samples.length,r[d].unit)}</td>`,t+=`<td style="text-align: right;">${F(r[d].min,r[d].unit)}</td>`,t+="\x3ctd data-distribution\x3d'1'\x3e\x3c/td\x3e",t+=`<td>${F(r[d].max,r[d].unit)}</td>`,t+="\x3ctd data-histogram\x3d'1'\x3e\x3c/td\x3e",
t+="\x3c/tr\x3e";k.innerHTML=t+"\x3ctable\x3e";t=k.querySelectorAll("td[data-distribution\x3d'1']");d=k.querySelectorAll("td[data-histogram\x3d'1']");for(let u=0;u<t.length;u++){let h=t[u];var a=document.createElement("canvas");a.height=10;a.width=100;var b=a.getContext("2d");b.strokeStyle=y;b.beginPath();b.moveTo(0,5);b.lineTo(100,5);if(r[c[u]].max>r[c[u]].min+.001)for(const p of r[c[u]].samples){var l=(p-r[c[u]].min)/(r[c[u]].max-r[c[u]].min);b.moveTo(100*l,3);b.lineTo(100*l,7)}b.stroke();b.strokeRect((e[u].value-
r[c[u]].min)/(r[c[u]].max-r[c[u]].min)*100-2,0,4,9);h.appendChild(a);h=d[u];{a=Array(50);for(b=0;b<a.length;b++)a[b]=0;for(const g of r[c[u]].samples)b=(g-r[c[u]].min)/(r[c[u]].max-r[c[u]].min),a[1===b?a.length-1:Math.floor(b*a.length)]++;b=document.createElement("canvas");b.height=30;b.width=120;l=b.getContext("2d");l.strokeStyle=y;l.fillStyle=y;let p=0;for(var v=0;v<a.length;v++)p=Math.max(p,a[v]);for(v=0;v<a.length;v++){const g=a[v];l.fillRect(v*b.width/a.length,b.height*(1-g/p),b.width/a.length,
g/p*b.height)}l.beginPath();l.moveTo(0,b.height);l.lineTo(b.width,b.height);l.stroke();h.appendChild(b)}}y=k.querySelectorAll("td");for(r=0;r<y.length;r++)y[r].style.padding="5px";return k};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/LRUCache","../../../../core/maybe","../../tiling/TileCoverage","../../tiling/TileKey"],function(A,F,y,k,r){const t=(c,d)=>c+1/(1<<2*d);let e=function(){function c(a,
b){this._tiles=new Map;this._tileCache=new F(40,l=>l.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;this._container=b}var d=c.prototype;d.destroy=function(){for(const [,a]of this._tiles)a.dispose();this._tiles=null;this._tileCache.clear();this._tileCache=null};d.update=function(a){this._updateCacheSize(a);const b=this.tileInfoView;a=b.getTileCoverage(a.state,0,"smallest");const {spans:l,lodInfo:v}=
a,{level:u}=v,h=new Set,p=new Set;for(const {row:n,colFrom:x,colTo:D}of l)for(let z=x;z<=D;z++){const q=r.getId(u,n,v.normalizeCol(z),v.getWorldForColumn(z)),B=this._getOrAcquireTile(q);h.add(q);B.processed()?this._addToContainer(B):p.add(new r(q))}for(const [n,x]of this._tiles)x.isCoverage=h.has(n);for(var g of p)this._findPlaceholdersForMissingTiles(g,h);g=!1;for(const [n,x]of this._tiles)x.neededForCoverage=h.has(n),x.neededForCoverage||x.isHoldingForFade&&b.intersects(a,x.key)&&h.add(n),x.isFading&&
(g=!0);for(const [n]of this._tiles)h.has(n)||this._releaseTile(n);k.pool.release(a);return!g};d.clear=function(){this._tiles.clear();this._tileCache.clear();this._visibleTiles.clear()};d.clearCache=function(){this._tileCache.clear()};d._findPlaceholdersForMissingTiles=function(a,b){var l=[];for(const [,v]of this._tiles)this._addPlaceholderChild(l,v,a,b);l=l.reduce(t,0);1E-6>Math.abs(1-l)||this._addPlaceholderParent(a.id,b)};d._addPlaceholderChild=function(a,b,l,v){if(!(b.key.level<=l.level)&&b.hasData()){{var u=
b.key;const h=u.level-l.level;u=l.row===u.row>>h&&l.col===u.col>>h&&l.world===u.world}u&&(this._addToContainer(b),v.add(b.id),a.push(b.key.level-l.level))}};d._addPlaceholderParent=function(a,b){for(;;){{const [v,u,h,p]=a.split("/");a=parseInt(v,10);a=0===a?null:`${a-1}/${parseInt(u,10)>>1}/${parseInt(h,10)>>1}/${parseInt(p,10)}`}if(!a||b.has(a))break;const l=this._getTile(a);if(l&&l.hasData()){this._addToContainer(l);b.add(l.id);break}}};d._getOrAcquireTile=function(a){let b=this._tiles.get(a);if(b)return b;
(b=this._tileCache.pop(a))||(b=this.acquireTile(new r(a)));this._tiles.set(a,b);return b};d._getTile=function(a){let b=this._tiles.get(a);if(b)return b;(b=this._tileCache.pop(a))&&this._tiles.set(a,b);return b};d._releaseTile=function(a){const b=this._tiles.get(a);this.releaseTile(b);this._removeFromContainer(b);this._tiles.delete(a);b.hasData()?this._tileCache.put(a,b,1):b.dispose()};d._addToContainer=function(a){let b;const l=[],v=this._container;if(!v.contains(a)){var u=this._visibleTiles;for(const [,
h]of u)this._canConnectDirectly(a,h)&&l.push(h),y.isNone(b)&&this._canConnectDirectly(h,a)&&(b=h);if(y.isSome(b)){for(const h of l)b.childrenTiles.delete(h),a.childrenTiles.add(h),h.parentTile=a;b.childrenTiles.add(a);a.parentTile=b}else for(const h of l)a.childrenTiles.add(h),h.parentTile=a;u.set(a.id,a);v.addChild(a)}};d._removeFromContainer=function(a){this._visibleTiles.delete(a.id);this._container.removeChild(a);if(y.isSome(a.parentTile)){a.parentTile.childrenTiles.delete(a);for(const b of a.childrenTiles)y.isSome(a.parentTile)&&
a.parentTile.childrenTiles.add(b)}for(const b of a.childrenTiles)b.parentTile=a.parentTile;a.parentTile=null;a.childrenTiles.clear()};d._canConnectDirectly=function(a,b){a=a.key;let {level:l,row:v,col:u,world:h}=b.key;for(b=this._visibleTiles;0<l;){l--;v>>=1;u>>=1;if(a.level===l&&a.row===v&&a.col===u&&a.world===h)return!0;if(b.has(`${l}/${v}/${u}/${h}`))break}return!1};d._updateCacheSize=function(a){a=a.state.size;if(a[0]!==this._viewSize[0]||a[1]!==this._viewSize[1]){var b=Math.ceil(a[0]/512)+1,
l=Math.ceil(a[1]/512)+1;this._viewSize[0]=a[0];this._viewSize[1]=a[1];this._tileCache.maxSize=5*b*l}};return c}();A.TileManager=e;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(A,F,y,k,r,t,e,c){c=function(a){function b(v,
u,h,p,g=null){h=a.call(this,v,h,p,[4096,4096])||this;h._memCache=g;h._referenced=0;h._hasSymbolBuckets=!1;h._memoryUsedByLayerData=0;h.layerData=new Map;h.layerCount=0;h.status="loading";h.allSymbolsFadingOut=!1;h.lastOpacityUpdate=0;h.symbols=new Map;h.isCoverage=!1;h.neededForCoverage=!1;h.decluttered=!1;h.invalidating=!1;h.parentTile=null;h.childrenTiles=new Set;h._processed=!1;h._referenced=1;h.styleRepository=u;h.id=v.id;h.transforms.tileUnitsToPixels=r.create();return h}F._inheritsLoose(b,a);
var l=b.prototype;l.setData=function(v){this.changeDataImpl(v);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};l.deleteLayerData=function(v){let u=!1;for(const h of v)this.layerData.has(h)&&(v=this.layerData.get(h),this._memoryUsedByLayerData-=v.memoryUsed,3===v.type&&this.symbols.has(h)&&(this.symbols.delete(h),u=!0),v.destroy(),this.layerData.delete(h),this.layerCount--);y.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData);
u&&this.emit("symbols-changed");this.requestRender()};l.processed=function(){return this._processed};l.hasData=function(){return 0<this.layerCount};l.dispose=function(){"unloaded"!==this.status&&(d.delete(this),b._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};l.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};l.retain=function(){++this._referenced};l.changeDataImpl=
function(v){let u=!1;if(v){v=this._createRenderBuckets(v);for(const [h,p]of v)this.layerData.has(h)&&(v=this.layerData.get(h),this._memoryUsedByLayerData-=p.memoryUsed,v.destroy(),this.layerData.delete(h),this.layerCount--),3===p.type&&(this.symbols.set(h,p.symbols),u=!0),this._memoryUsedByLayerData+=p.memoryUsed,this.layerData.set(h,p),this.layerCount++;y.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,h]of this.layerData)3===
h.type&&(this._hasSymbolBuckets=!0);u&&this.emit("symbols-changed")};l.attachWithContext=function(v){this.stage={context:v,trashDisplayObject(u){u.processDetach()},untrashDisplayObject(){return!1}}};l.setTransform=function(v,u){a.prototype.setTransform.call(this,v,u);var h=u/(v.resolution*v.pixelRatio);u=this.size[0]/this.coordRange[0]*h;h*=this.size[1]/this.coordRange[1];const p=[0,0];v.toScreen(p,this.coords);const g=this.transforms.tileUnitsToPixels;k.identity(g);k.translate(g,g,p);k.rotate(g,
g,Math.PI*v.rotation/180);k.scale(g,g,[u,h,1])};b._destroyRenderBuckets=function(v){if(v){var u=new Set;v.forEach(h=>{u.has(h)||(h.destroy(),u.add(h))});v.clear()}};l._createRenderBuckets=function(v){const u=new Map,h=new Map;for(const p of v){v=this._deserializeBucket(p,h);for(const g of v.layerUIDs)u.set(g,v)}return u};l._deserializeBucket=function(v,u){let h=u.get(v);if(h)return h;switch((new Uint32Array(v))[0]){case 1:h=new t.FillRenderBucket(v,this.styleRepository);break;case 2:h=new t.LineRenderBucket(v,
this.styleRepository);break;case 3:h=new t.SymbolRenderBucket(v,this.styleRepository,this);break;case 4:h=new t.CircleRenderBucket(v,this.styleRepository)}u.set(v,h);return h};F._createClass(b,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<e.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-
this.lastOpacityUpdate<e.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return b}(c.TiledDisplayObject);const d=new Map;A.VectorTile=c;A.printAllocations=function(){d.forEach((a,b)=>{console.log(`\n${b.key}:`);a[0].forEach(l=>console.log(l));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");
a[1].forEach(l=>console.log(l))})};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject ./decluttering/util".split(" "),
function(A,F,y,k,r,t,e,c,d,a,b,l,v){r=function(){function u(p,g){this.layerUIDs=[];this.isDestroyed=!1;this.data=p;this.memoryUsed=p.byteLength;let n=1;p=new Uint32Array(p);this.layerUIDs=[];const x=p[n++];for(let D=0;D<x;D++)this.layerUIDs[D]=p[n++];this.bufferDataOffset=n;g&&(this.layer=g.getStyleLayerByUID(this.layerUIDs[0]))}var h=u.prototype;h.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};h.prepareForRendering=function(p){y.isNone(this.data)||(this.doPrepareForRendering(p,
this.data,this.bufferDataOffset),this.data=null)};F._createClass(u,[{key:"isPreparedForRendering",get:function(){return y.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return u}();t=function(u){function h(g,n){n=u.call(this,g,n)||this;n.type=2;n.lineIndexStart=0;n.lineIndexCount=0;g=new Uint32Array(g);let x=n.bufferDataOffset;n.lineIndexStart=g[x++];n.lineIndexCount=g[x++];const D=g[x++];if(0<D){const z=new Map;for(let q=0;q<D;q++){const B=g[x++],H=g[x++],I=g[x++];
z.set(B,[H,I])}n.patternMap=z}n.bufferDataOffset=x;return n}F._inheritsLoose(h,u);var p=h.prototype;p.hasData=function(){return 0<this.lineIndexCount};p.triangleCount=function(){return this.lineIndexCount/3};p.doDestroy=function(){y.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();y.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();y.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=
null;this.memoryUsed=0};p.doPrepareForRendering=function(g,n,x){n=new Uint32Array(n);var D=new Int32Array(n.buffer);const z=n[x++];this.lineVertexBuffer=k.createVertex(g,35044,new Int32Array(D.buffer,4*x,z));x+=z;D=n[x++];this.lineIndexBuffer=k.createIndex(g,35044,new Uint32Array(n.buffer,4*x,D));x+=D;x=this.layer.lineMaterial;this.lineVertexArrayObject=new l(g,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return h}(r);e=function(u){function h(g,
n){n=u.call(this,g,n)||this;n.type=1;n.fillIndexStart=0;n.fillIndexCount=0;n.outlineIndexStart=0;n.outlineIndexCount=0;g=new Uint32Array(g);let x=n.bufferDataOffset;n.fillIndexStart=g[x++];n.fillIndexCount=g[x++];n.outlineIndexStart=g[x++];n.outlineIndexCount=g[x++];const D=g[x++];if(0<D){const z=new Map;for(let q=0;q<D;q++){const B=g[x++],H=g[x++],I=g[x++];z.set(B,[H,I])}n.patternMap=z}n.bufferDataOffset=x;return n}F._inheritsLoose(h,u);var p=h.prototype;p.hasData=function(){return 0<this.fillIndexCount||
0<this.outlineIndexCount};p.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};p.doDestroy=function(){y.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();y.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();y.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;y.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();y.isSome(this.outlineVertexBuffer)&&
this.outlineVertexBuffer.dispose();y.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};p.doPrepareForRendering=function(g,n,x){n=new Uint32Array(n);var D=new Int32Array(n.buffer),z=n[x++];this.fillVertexBuffer=k.createVertex(g,35044,new Int32Array(D.buffer,4*x,z));x+=z;z=n[x++];this.fillIndexBuffer=k.createIndex(g,35044,new Uint32Array(n.buffer,4*x,z));x+=z;z=n[x++];this.outlineVertexBuffer=
k.createVertex(g,35044,new Int32Array(D.buffer,4*x,z));x+=z;D=n[x++];this.outlineIndexBuffer=k.createIndex(g,35044,new Uint32Array(n.buffer,4*x,D));x+=D;n=this.layer;x=n.fillMaterial;n=n.outlineMaterial;this.fillVertexArrayObject=new l(g,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new l(g,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return h}(r);c=function(u){function h(g,
n,x){n=u.call(this,g,n)||this;n.type=3;n.iconPerPageElementsMap=new Map;n.glyphPerPageElementsMap=new Map;n.symbolInstances=[];n.isIconSDF=!1;n.opacityChanged=!1;n.lastOpacityUpdate=0;n.symbols=[];const D=new Uint32Array(g),z=new Int32Array(g);g=new Float32Array(g);let q=n.bufferDataOffset;n.isIconSDF=!!D[q++];var B=D[q++];for(var H=0;H<B;H++){var I=D[q++],G=D[q++],J=D[q++];n.iconPerPageElementsMap.set(I,[G,J])}B=D[q++];for(H=0;H<B;H++)I=D[q++],G=D[q++],J=D[q++],n.glyphPerPageElementsMap.set(I,[G,
J]);B=D[q++];H=D[q++];n.iconOpacity=new Int32Array(B);n.textOpacity=new Int32Array(H);q=v.deserializeSymbols(D,z,g,q,n.symbols,x);n.bufferDataOffset=q;return n}F._inheritsLoose(h,u);var p=h.prototype;p.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};p.triangleCount=function(){let g=0;for(const [,n]of this.iconPerPageElementsMap)g+=n[1];for(const [,n]of this.glyphPerPageElementsMap)g+=n[1];return g/3};p.doDestroy=function(){y.isSome(this.iconVertexArrayObject)&&
this.iconVertexArrayObject.dispose();y.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();y.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();y.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;y.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();y.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();y.isSome(this.textOpacityBuffer)&&
this.textOpacityBuffer.dispose();y.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};p.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var g=y.unwrap(this.iconOpacity),n=y.unwrap(this.iconOpacityBuffer);0<g.length&&g.byteLength===n.size&&n.setSubData(g);g=y.unwrap(this.textOpacity);n=y.unwrap(this.textOpacityBuffer);0<g.length&&g.byteLength===
n.size&&n.setSubData(g)}};p.doPrepareForRendering=function(g,n,x){n=new Uint32Array(n);var D=new Int32Array(n.buffer),z=n[x++];this.iconVertexBuffer=k.createVertex(g,35044,new Int32Array(D.buffer,4*x,z));x+=z;z=n[x++];this.iconIndexBuffer=k.createIndex(g,35044,new Uint32Array(n.buffer,4*x,z));x+=z;z=n[x++];this.textVertexBuffer=k.createVertex(g,35044,new Int32Array(D.buffer,4*x,z));x+=z;D=n[x++];this.textIndexBuffer=k.createIndex(g,35044,new Uint32Array(n.buffer,4*x,D));x+=D;this.iconOpacityBuffer=
k.createVertex(g,35044,y.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=k.createVertex(g,35044,y.unwrap(this.textOpacity).buffer);n=this.layer;x=n.iconMaterial;n=n.textMaterial;this.iconVertexArrayObject=new l(g,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new l(g,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};
return h}(r);d=function(u){function h(g,n){n=u.call(this,g,n)||this;n.type=4;n.circleIndexStart=0;n.circleIndexCount=0;g=new Uint32Array(g);let x=n.bufferDataOffset;n.circleIndexStart=g[x++];n.circleIndexCount=g[x++];n.bufferDataOffset=x;return n}F._inheritsLoose(h,u);var p=h.prototype;p.hasData=function(){return 0<this.circleIndexCount};p.triangleCount=function(){return this.circleIndexCount/3};p.doDestroy=function(){y.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();
y.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();y.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};p.doPrepareForRendering=function(g,n,x){n=new Uint32Array(n);var D=new Int32Array(n.buffer);const z=n[x++];this.circleVertexBuffer=k.createVertex(g,35044,new Int32Array(D.buffer,4*x,z));x+=z;D=n[x++];this.circleIndexBuffer=k.createIndex(g,35044,new Uint32Array(n.buffer,
4*x,D));x+=D;x=this.layer.circleMaterial;this.circleVertexArrayObject=new l(g,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return h}(r);A.CircleRenderBucket=d;A.FillRenderBucket=e;A.LineRenderBucket=t;A.RenderBucketBase=r;A.SymbolRenderBucket=c;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"./core"],function(A,F,y,k){let r=function(d){this.tile=d;this.parent=null;this.children=new Set},t=function(){function d(){this.nodes=new Map;this.roots=new Set}var a=d.prototype;a.create=function(b){const l=new r(b);let v;const u=[];this.nodes.forEach(h=>{this._canConnectDirectly(l,h)&&u.push(h);!v&&this._canConnectDirectly(h,l)&&(v=h)});if(v){for(const h of u)v.children.delete(h),l.children.add(h),h.parent=l;v.children.add(l);l.parent=v}else{this.roots.add(l);for(const h of u)l.children.add(h),
h.parent=l,this.roots.delete(h)}this.nodes.set(b.key.id,l);return l};a.destroy=function(b){y.isSome(b.parent)?(b.parent.children.delete(b),b.children.forEach(l=>{y.isSome(b.parent)&&b.parent.children.add(l)})):this.roots.delete(b);b.children.forEach(l=>{(l.parent=b.parent)||this.roots.add(l)});this.nodes.delete(b.tile.key.id)};a.clear=function(){this.roots.clear();this.nodes.clear()};a._canConnectDirectly=function(b,l){let {level:v,row:u,col:h}=l.tile.key;for({world:l}=l.tile.key;0<v;){v--;u>>=1;
h>>=1;if(b.tile.key.level===v&&b.tile.key.row===u&&b.tile.key.col===h&&b.tile.key.world===l)return!0;if(this.nodes.has(`${v}/${u}/${h}/${l}`))break}return!1};return d}(),e=function(){function d(){this._tileGraph=new t;this._tileArray=null}var a=d.prototype;a.has=function(b){return"string"===typeof b?this._tileGraph.nodes.has(b):this._tileGraph.nodes.has(b.key.id)};a.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(b=>{this._tileArray.push(b.tile)}));return this._tileArray};
a.getRoots=function(){const b=[];this._tileGraph.roots.forEach(l=>{b.push(l.tile)});return b};a.getParent=function(b){b=this._tileGraph.nodes.get("string"===typeof b?b:b.key.id);return y.isSome(b.parent)&&b.parent.tile};a.getChildren=function(b){const l=[];this._tileGraph.nodes.get("string"===typeof b?b:b.key.id).children.forEach(v=>{l.push(v.tile)});return l};a.get=function(b){return this._tileGraph.nodes.get(b).tile};a.removeKey=function(b){b=this._tileGraph.nodes.get(b);this._tileGraph.destroy(b);
this._tileArray=null};a.forEach=function(b){this._tileGraph.nodes.forEach((l,v)=>b(l.tile,v))};a.add=function(b){this._tileGraph.create(b);this._tileArray=null};a.remove=function(b){b=this._tileGraph.nodes.get(b.key.id);this._tileGraph.destroy(b);this._tileArray=null};a.clear=function(){this._tileGraph.clear();this._tileArray=[]};return d}(),c=function(){function d(b,l,v){this._rows=Math.ceil(l/v);this._columns=Math.ceil(b/v);this._cellSize=v;this.cells=Array(this._rows);for(b=0;b<this._rows;b++)for(this.cells[b]=
Array(this._columns),l=0;l<this._columns;l++)this.cells[b][l]=[]}var a=d.prototype;a.getCell=function(b,l){l=Math.min(Math.max(Math.floor(l/this._cellSize),0),this._rows-1);b=Math.min(Math.max(Math.floor(b/this._cellSize),0),this._columns-1);return this.cells[l]&&this.cells[l][b]||null};a.getCellSpan=function(b,l,v,u){return[Math.min(Math.max(Math.floor(b/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(l/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(v/this._cellSize),
0),this.columns-1),Math.min(Math.max(Math.floor(u/this._cellSize),0),this.rows-1)]};F._createClass(d,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return d}();A.GridIndex=c;A.TileForest=e;A.TileGraph=t;A.TileNode=r;A.deserializeSymbols=function(d,a,b,l,v,u){const h=a[l++];for(let n=0;n<h;n++){const x=new k.VTLSymbol(u);x.xTile=a[l++];x.yTile=a[l++];x.hash=a[l++];x.priority=a[l++];var p=
a[l++];for(var g=0;g<p;g++){const D=a[l++],z=a[l++],q=a[l++],B=a[l++],H=!!a[l++],I=a[l++],G=b[l++],J=b[l++],O=a[l++],P=a[l++];x.colliders.push({xTile:D,yTile:z,dxPixels:q,dyPixels:B,hard:H,partIndex:I,width:O,height:P,minLod:G,maxLod:J})}p=d[l++];for(g=0;g<p;g++)x.textVertexRanges.push([d[l++],d[l++]]);p=d[l++];for(g=0;g<p;g++)x.iconVertexRanges.push([d[l++],d[l++]]);v.push(x)}return l};A.tileCoordChange=function(d,a,b,l,v,u){b-=v;if(0<=b)return(a>>b)+(l-(u<<b))*(d>>b);b=-b;return a-(u-(l<<b))*(d>>
b)<<b};A.writeOpacityToBuffers=function(d,a,b){for(const [n,x]of d.symbols){{var l=d,v=a,u=b,h=x;const D=l.layerData.get(n);if(3===D.type){for(const z of h){h=z.unique;var p=void 0;if(z.selectedForRendering){var g=h.parts[0];p=g.startOpacity;g=g.targetOpacity;l.allSymbolsFadingOut=l.allSymbolsFadingOut&&0===g;p=u?Math.floor(127*p)|g<<7:g?255:0;p|=p<<24|p<<16|p<<8}else p=0;for(const [q,B]of z.iconVertexRanges)for(g=q;g<q+B;g+=4)D.iconOpacity[g/4]=p;z.selectedForRendering?(p=h.parts[1],h=p.startOpacity,
p=p.targetOpacity,l.allSymbolsFadingOut=l.allSymbolsFadingOut&&0===p,h=u?Math.floor(127*h)|p<<7:p?255:0,p=h<<24|h<<16|h<<8|h):p=0;for(const [q,B]of z.textVertexRanges)for(h=q;h<q+B;h+=4)D.textOpacity[h/4]=p}D.lastOpacityUpdate=v;D.opacityChanged=!0}}}};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(A){A.VTLSymbol=function(F){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=
[];this.iconVertexRanges=[];this.tile=F};A.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ./decluttering/debugging ./decluttering/SymbolFader ../webgl/enums ../webgl/TileContainer ../webgl/TiledDisplayObject ../../tiling/TileCoverage ../../tiling/TileKey".split(" "),
function(A,F,y,k,r,t,e,c,d,a,b,l){function v(u,h){if(u){const p=u.getLayoutProperty("visibility");if(!p||1!==p.getValue()&&(void 0===u.minzoom||u.minzoom<h+1E-6)&&(void 0===u.maxzoom||u.maxzoom>=h-1E-6))return!0}return!1}d=function(u){function h(g){g=u.call(this,g)||this;g._backgroundTiles=[];g._pointToCallbacks=new Map;g._fading=!1;return g}F._inheritsLoose(h,u);var p=h.prototype;p.destroy=function(){this.removeAllChildren();this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);
this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null);y.isSome(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[];this._pointToCallbacks.clear()};p.setStyleResources=function(g,n,x){this._spriteMosaic=g;this._glyphMosaic=n;this._styleRepository=x;y.isNone(this._symbolFader)&&(g=new e.SymbolFader(this._styleRepository,this.children),g.on("fade-start",()=>{this.emit("fade-start");this._fading=!0;this.requestRender()}),
g.on("fade-complete",()=>{this.emit("fade-complete");this._fading=!1;this.requestRender()}),this._symbolFader=g);y.unwrap(this._symbolFader).styleRepository=x};p.deleteStyleLayers=function(g){y.isSome(this._symbolFader)&&this._symbolFader.deleteStyleLayers(g)};p.hitTest=function(){var g=F._asyncToGenerator(function*(n,x){n=[n,x];x=k.createResolver();this._pointToCallbacks.set(n,x);this.requestRender();return x.promise});return function(n,x){return g.apply(this,arguments)}}();p.enterTileInvalidation=
function(){for(const g of this.children)g.invalidating=!0};p.createRenderParams=function(g){return{...u.prototype.createRenderParams.call(this,g),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}};p.doRender=function(g){!this.visible||g.drawPhase!==c.WGLDrawPhase.MAP&&g.drawPhase!==c.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||u.prototype.doRender.call(this,g)};p.addChild=function(g){u.prototype.addChild.call(this,
g);y.isSome(this._symbolFader)?this._symbolFader.addTile(g):g.decluttered=!0;this.requestRender();return g};p.removeChild=function(g){y.isSome(this._symbolFader)&&this._symbolFader.removeTile(g);this.requestRender();return u.prototype.removeChild.call(this,g)};p.renderChildren=function(g){if(g.drawPhase===c.WGLDrawPhase.DEBUG)u.prototype.renderChildren.call(this,g);else if(this._doRender(g),0<this._pointToCallbacks.size){const {context:n}=g,x=n.getBoundFramebufferObject();g.drawPhase=c.WGLDrawPhase.HITTEST;
const D=g.painter.effects.hittest;D.bind(g);this._doRender(g);D.draw(g,this._pointToCallbacks);n.bindFramebuffer(x)}};p.removeAllChildren=function(){for(let g=0;g<this.children.length;g++){const n=this.children[g];y.isSome(this._symbolFader)&&this._symbolFader.removeTile(n);n.dispose()}u.prototype.removeAllChildren.call(this)};p.getStencilTarget=function(){return this.children.filter(g=>g.neededForCoverage&&g.hasData())};p.restartDeclutter=function(){y.isSome(this._symbolFader)&&this._symbolFader.restartDeclutter()};
p._doRender=function(g){var {context:n}=g,x=this._styleRepository;if(x){var D=x.layers,z=!0;g.drawPhase===c.WGLDrawPhase.HITTEST&&(z=!1);0<x.backgroundBucketIds.length&&(g.renderPass="background",this._renderBackgroundLayers(g,x.backgroundBucketIds));u.prototype.renderChildren.call(this,g);g.drawPhase===c.WGLDrawPhase.MAP&&this._fade(g.displayLevel,g.state);if((x=this.children.filter(G=>G.visible&&G.hasData()))&&0!==x.length){for(var q of x)q.triangleCount=0;n.setStencilWriteMask(0);n.setColorMask(!0,
!0,!0,!0);n.setStencilOp(7680,7680,7681);n.setStencilTestEnabled(!0);n.setBlendingEnabled(!1);n.setDepthTestEnabled(!0);n.setDepthWriteEnabled(!0);n.setDepthFunction(515);n.setClearDepth(1);n.clear(n.gl.DEPTH_BUFFER_BIT);g.renderPass="opaque";for(q=D.length-1;0<=q;q--)this._renderStyleLayer(D[q],g,x);n.setDepthWriteEnabled(!1);n.setBlendingEnabled(z);n.setBlendFunctionSeparate(1,771,1,771);g.renderPass="translucent";for(z=0;z<D.length;z++)this._renderStyleLayer(D[z],g,x);n.setDepthTestEnabled(!1);
g.renderPass="symbol";for(z=0;z<D.length;z++)this._renderStyleLayer(D[z],g,x);n.bindVAO();n.setStencilTestEnabled(!0);n.setBlendingEnabled(!0);if(g.drawPhase===c.WGLDrawPhase.MAP&&(g=window.COLLISION_DEBUG_CTX)&&y.isSome(this._symbolFader)&&(g.clearRect(0,0,g.canvas.width,g.canvas.height),!this._fading||window.COLLISION_XRAY))for(const G of this.children)if(G.symbols){const J=[];G.symbols.forEach(O=>{J.push(...O)});if(window.COLLISION_SHOW_GRID){var B,H,I;(n=null==(B=this._symbolFader)?void 0:null==
(H=B._symbolDeclutterer)?void 0:null==(I=H._collisionJob)?void 0:I._gridIndex)&&t.drawGridIndex(g,n)}t.drawColliders(g,J)}}}};p._fade=function(g,n){y.isSome(this._symbolFader)&&(this._symbolFader.update(g,n)||this.requestRender())};p._renderStyleLayer=function(g,n,x){const {painter:D,renderPass:z}=n;if(void 0!==g){var q=g.getLayoutProperty("visibility");if(!q||1!==q.getValue()){switch(g.type){case 0:return;case 1:if("opaque"!==z&&"translucent"!==n.renderPass)return;var B="vtlFill";break;case 2:if("translucent"!==
z)return;B="vtlLine";break;case 4:if("symbol"!==z)return;B="vtlCircle";break;case 3:if("symbol"!==z)return;B="vtlSymbol"}x=3===g.type?x.filter(H=>H.decluttered):x.filter(H=>H.neededForCoverage);if("vtlSymbol"!==B&&(q=n.displayLevel,0===x.length||void 0!==g.minzoom&&g.minzoom>=q+1E-6||void 0!==g.maxzoom&&g.maxzoom<q-1E-6))return;q=g.uid;n.styleLayerUID=q;n.styleLayer=g;for(const H of x)if(H.layerData.has(q)){D.renderObjects(n,x,B);break}}}};p._renderBackgroundLayers=function(g,n){const {context:x,
displayLevel:D,painter:z,state:q}=g,B=this._styleRepository;var H=!1;for(var I of n)if(v(B.getLayerById(I),D)){H=!0;break}if(H){H=this._tileInfoView.getTileCoverage(g.state,0,"smallest");var {spans:G,lodInfo:J}=H,{level:O}=J,P=r.create();I=[];if(this._renderPasses){var Q=this._renderPasses[0];y.isSome(this._clippingInfos)&&(Q.brushes[0].prepareState(g,this._clippingInfos[0]),Q.brushes[0].drawMany(g,this._clippingInfos))}Q=this._backgroundTiles;var L=0;for(const {row:K,colFrom:S,colTo:U}of G)for(let W=
S;W<=U;W++){if(L<Q.length){var M=Q[L];M.key.set(O,K,J.normalizeCol(W),J.getWorldForColumn(W));this._tileInfoView.getTileBounds(P,M.key,!1);M.bounds=P;M.coords[0]=P[0];M.coords[1]=P[3]}else M=new l(O,K,J.normalizeCol(W),J.getWorldForColumn(W)),M=new a.TiledDisplayObject(M,this._tileInfoView.getTileBounds(r.create(),M),[512,512],[4096,4096]),Q.push(M);M.setTransform(q,this._tileInfoView.getTileResolution(M.key));I.push(M);L++}x.setStencilWriteMask(0);x.setColorMask(!0,!0,!0,!0);x.setStencilOp(7680,
7680,7681);x.setStencilFunction(514,0,255);O=!0;g.drawPhase===c.WGLDrawPhase.HITTEST&&(O=!1);x.setStencilTestEnabled(O);for(const K of n)n=B.getLayerById(K),v(n,D)&&(g.styleLayerUID=n.uid,g.styleLayer=n,z.renderObjects(g,I,"vtlBackground"));b.pool.release(H)}};return h}(d["default"]);A.VectorTileContainer=d;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../core/maybe ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util".split(" "),
function(A,F,y,k,r,t,e,c,d,a){y=function(b){function l(u,h){var p=b.call(this)||this;p.styleRepository=u;p._tileToHandle=new Map;p._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};p._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};p._completed=!1;p._symbolRepository=new d.SymbolRepository(4096,h,()=>new t.VTLUniqueSymbol);p._symbolDeclutterer=new c.SymbolDeclutterer(h,p._symbolRepository,(g,n,x)=>new e.CollisionJob(g,n,x,p.styleRepository,p._zoom,p._viewState.rotation),(g,n)=>
{g.allSymbolsFadingOut=!0;g.lastOpacityUpdate=n;a.writeOpacityToBuffers(g,n,!0);g.decluttered=!0;g.requestRender()},(g,n)=>p.styleRepository.getStyleLayerByUID(g.styleLayerUID).z-p.styleRepository.getStyleLayerByUID(n.styleLayerUID).z,g=>(g=p.styleRepository.getStyleLayerByUID(g).getLayoutProperty("visibility"))&&1===g.getValue()?!1:!0);return p}F._inheritsLoose(l,b);var v=l.prototype;v.addTile=function(u){u.decluttered=!1;this._tileToHandle.set(u,u.on("symbols-changed",()=>{this._symbolRepository.add(u);
this.restartDeclutter()}));this._symbolRepository.add(u);this.restartDeclutter()};v.removeTile=function(u){const h=this._tileToHandle.get(u);h&&(this._symbolRepository.removeTile(u),this.restartDeclutter(),h.remove(),this._tileToHandle.delete(u))};v.update=function(u,h){this._zoom=u;this._viewState={scale:h.scale,rotation:h.rotation,center:[h.center[0],h.center[1]],size:[h.size[0],h.size[1]]};this._continueDeclutter();return this._completed};v.restartDeclutter=function(){this._completed=!1;this._symbolDeclutterer.restart();
this._notifyUnstable()};v.clear=function(){this._completed=!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(u=>u.remove());this._tileToHandle.clear()};v.deleteStyleLayers=function(u){this._symbolRepository.deleteStyleLayers(u)};v._continueDeclutter=function(){if(!this._completed||this.stale)this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],
this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(r.DECLUTTER_BUDGET))&&this._scheduleNotifyStable()};v._scheduleNotifyStable=function(){k.isSome(this._stableNotificationHandle)&&
clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this.emit("fade-complete")},1.5*r.FADE_DURATION)};v._notifyUnstable=function(){k.isSome(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this.emit("fade-start")};F._createClass(l,[{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||
this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}}]);return l}(y);A.SymbolFader=y;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../chunks/mat3f32","./config","./util"],function(A,F,y,k){let r=function(){function t(c,d,a,b,l,v){this._symbols=c;this._styleRepository=b;this._zoom=
l;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new k.GridIndex(d,a,y.COLLISION_GRID_CELL_SIZE);this._si=Math.sin(Math.PI*v/180);this._co=Math.cos(Math.PI*v/180);for(const u of c)for(const h of u.symbols)this._allNeededMatrices.has(h.tile)||this._allNeededMatrices.set(h.tile,F.clone(h.tile.transforms.tileUnitsToPixels))}var e=t.prototype;e.work=function(c){const d=this._gridIndex,a=performance.now();for(;this._currentLayerCursor<
this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const z=this._symbols[this._currentLayerCursor],q=this._getProperties(z.styleLayerUID);for(;this._currentSymbolCursor<z.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-a>c)return!1;var b=z.symbols[this._currentSymbolCursor];if(!b.unique.show)continue;{var l=b,v=this._si,u=this._co,h=this._allNeededMatrices.get(b.tile),p=this._zoom;const {iconRotationAlignment:J,textRotationAlignment:O,
iconTranslate:P,iconTranslateAnchor:Q,textTranslate:L,textTranslateAnchor:M}=q;var g=0;for(const K of l.colliders){const [S,U]=0===K.partIndex?P:L;var n=0===K.partIndex?Q:M,x=K.minLod<=p&&p<=K.maxLod;g+=x?0:1;K.enabled=x;K.xScreen=K.xTile*h[0]+K.yTile*h[3]+h[6];K.yScreen=K.xTile*h[1]+K.yTile*h[4]+h[7];0===n?(K.xScreen+=u*S-v*U,K.yScreen+=v*S+u*U):(K.xScreen+=S,K.yScreen+=U);1===(0===K.partIndex?J:O)?(K.dxScreen=K.dxPixels,K.dyScreen=K.dyPixels):(K.dxScreen=u*(K.dxPixels+K.width/2)-v*(K.dyPixels+K.height/
2)-K.width/2,K.dyScreen=v*(K.dxPixels+K.width/2)+u*(K.dyPixels+K.height/2)-K.height/2)}0<l.colliders.length&&g===l.colliders.length&&(l.unique.show=!1)}l=b.unique;if(!l.show)continue;const {iconAllowOverlap:B,iconIgnorePlacement:H,textAllowOverlap:I,textIgnorePlacement:G}=q;for(const J of b.colliders)if(J.enabled&&(v=l.parts[J.partIndex],v.show)){if(u=!(J.partIndex?I:B))a:{u=J.xScreen+J.dxScreen;h=J.yScreen+J.dyScreen;p=u+J.width;g=h+J.height;const [O,P,Q,L]=d.getCellSpan(u,h,p,g);for(n=P;n<=L;n++)for(x=
O;x<=Q;x++){var D=d.cells[n][x];for(const M of D){D=M.xScreen+M.dxScreen;const K=M.yScreen+M.dyScreen,S=D+M.width,U=K+M.height;if(!(p<D||u>S||g<K||h>U)){u=!0;break a}}}u=!1}u&&(J.hard?l.show=!1:v.show=!1)}if(l.show)for(const J of b.colliders){if(!J.enabled)continue;if(J.partIndex?G:H)continue;if(!l.parts[J.partIndex].show)continue;b=J.xScreen+J.dxScreen;v=J.yScreen+J.dyScreen;const [O,P,Q,L]=this._gridIndex.getCellSpan(b,v,b+J.width,v+J.height);for(b=P;b<=L;b++)for(v=O;v<=Q;v++)this._gridIndex.cells[b][v].push(J)}}}return!0};
e._getProperties=function(c){var d=this._styleProps.get(c);if(d)return d;d=this._zoom;const a=this._styleRepository.getStyleLayerByUID(c);var b=0!==a.getLayoutValue("symbol-placement",d);let l=a.getLayoutValue("icon-rotation-alignment",d);2===l&&(l=b?0:1);let v=a.getLayoutValue("text-rotation-alignment",d);2===v&&(v=b?0:1);b=a.getPaintValue("icon-translate",d);const u=a.getPaintValue("icon-translate-anchor",d),h=a.getPaintValue("text-translate",d),p=a.getPaintValue("text-translate-anchor",d);d={iconAllowOverlap:a.getLayoutValue("icon-allow-overlap",
d),iconIgnorePlacement:a.getLayoutValue("icon-ignore-placement",d),textAllowOverlap:a.getLayoutValue("text-allow-overlap",d),textIgnorePlacement:a.getLayoutValue("text-ignore-placement",d),iconRotationAlignment:l,textRotationAlignment:v,iconTranslateAnchor:u,iconTranslate:b,textTranslateAnchor:p,textTranslate:h};this._styleProps.set(c,d);return d};return t}();A.CollisionJob=r;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./config"],function(A,F,y,k){function r(e,c){if(e.priority-c.priority)return e.priority-c.priority;const d=e.tile.key,a=c.tile.key;return d.world-a.world?d.world-a.world:d.level-a.level?d.level-a.level:d.row-a.row?d.row-a.row:d.col-a.col?d.col-a.col:e.xTile-c.xTile?e.xTile-c.xTile:e.yTile-c.yTile}let t=function(){function e(d,a,b,l,v,u){this._visibleTiles=d;this._symbolRepository=a;this._createCollisionJob=b;this._assignTileSymbolsOpacity=
l;this._symbolLayerSorter=v;this._isLayerVisible=u;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}var c=e.prototype;c.setScreenSize=function(d,a){this._screenWidth===d&&this._screenHeight===a||this.restart();this._screenWidth=d;this._screenHeight=a};c.restart=function(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=
!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0};c.continue=function(d){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var a=performance.now();if(!this._selectionJob.work(d))return!1;this._selectionJobCompleted=!0;d=Math.max(0,d-(performance.now()-a));if(0===d)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){a=
performance.now();if(!this._collisionJob.work(d))return!1;this._collisionJobCompleted=!0;d=Math.max(0,d-(performance.now()-a));if(0===d)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){a=performance.now();if(!this._opacityJob.work(d))return!1;this._opacityJobCompleted=!0;d=Math.max(0,d-(performance.now()-a));if(0===d)return!1}this._running=!1;return!0};c._createSelectionJob=function(){const d=this._symbolRepository.uniqueSymbols,a=[];let b=0,l=
0;const v=this._isLayerVisible,u=this._symbolLayerSorter;return{work:function(h){const p=performance.now();for(;l<d.length;l++,b=0){const n=d[l];var g=n.styleLayerUID;if(!v(g)){a[l]||(a[l]={styleLayerUID:g,symbols:[]});continue}a[l]=a[l]||{styleLayerUID:g,symbols:[]};const x=a[l];for(;b<n.uniqueSymbols.length;b++){g=n.uniqueSymbols[b];if(99===b%100&&performance.now()-p>h)return!1;let D=null,z=!1,q=!1;for(const B of g.tileSymbols)if(B.selectedForRendering=!1,!q||!z){const H=B.tile;if(!D||H.isCoverage||
H.neededForCoverage&&!z){D=B;if(H.neededForCoverage||H.isCoverage)q=!0;H.isCoverage&&(z=!0)}}D.selectedForRendering=!0;if(q){x.symbols.push(D);g.show=!0;for(const B of g.parts)B.show=!0}else g.show=!1}}for(const n of a)n.symbols.sort(r);return!0},get sortedSymbols(){return a.sort(u)}}};c._createOpacityJob=function(){function d(v,u){var h=v.symbols;for(const [,g]of h){var p=g;h=u;for(const n of p){p=n.unique;for(const x of p.parts)x.startOpacity+=(h-x.startTime)/k.FADE_DURATION*(.5<x.targetOpacity?
1:-1),x.startOpacity=Math.min(Math.max(x.startOpacity,0),1),x.startTime=h,x.targetOpacity=p.show&&x.show?1:0}}a(v,u);for(const g of v.childrenTiles)d(g,u)}const a=this._assignTileSymbolsOpacity,b=this._visibleTiles;let l=0;return{work(v){const u=performance.now();for(;l<b.length;l++){if(performance.now()-u>v)return!1;const h=b[l];if(y.isSome(h.parentTile))continue;const p=performance.now();d(h,p)}return!0}}};F._createClass(e,[{key:"running",get:function(){return this._running}}]);return e}();A.SymbolDeclutterer=
t;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./util"],function(A,F,y,k){let r=function(){function t(c,d,a){this.tileCoordRange=c;this._visibleTiles=d;this._createUnique=a;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}var e=t.prototype;e.add=function(c,d){this._uniqueSymbolLayerArray=null;let a=this._tiles.get(c.id);
a||(a={symbols:new Map},this._tiles.set(c.id,a));var b=new Map;if(d)for(var l of d)a.symbols.has(l)&&(b.set(l,a.symbols.get(l)),a.symbols.delete(l));else for(var [v]of c.layerData)a.symbols.has(v)&&(b.set(v,a.symbols.get(v)),a.symbols.delete(v));this._removeSymbols(b);d=c.symbols;b=new Map;for(const [u,h]of d)if(l=h.length,32<=l){v=this.tileCoordRange;do v/=2,l/=4;while(8<l&&64<v);l=new k.GridIndex(this.tileCoordRange,this.tileCoordRange,v);b.set(u,{flat:h,index:l});a.symbols.set(u,{flat:h,index:l});
for(const p of h)l.getCell(p.xTile,p.yTile).push(p)}else b.set(u,{flat:h}),a.symbols.set(u,{flat:h});this._addSymbols(c.key,d)};e.deleteStyleLayers=function(c){this._uniqueSymbolLayerArray=null;for(const [d,a]of this._tiles){const b=new Map;for(const l of c)a.symbols.has(l)&&(b.set(l,a.symbols.get(l)),a.symbols.delete(l));this._removeSymbols(b);0===a.symbols.size&&this._tiles.delete(d)}};e.removeTile=function(c){this._uniqueSymbolLayerArray=null;const d=this._tiles.get(c.id);if(d){var a=new Map;for(const [b]of c.symbols)d.symbols.has(b)&&
(a.set(b,d.symbols.get(b)),d.symbols.delete(b));this._removeSymbols(a);0===d.symbols.size&&this._tiles.delete(c.id)}};e._removeSymbols=function(c){for(const [a,{flat:b}]of c)for(const l of b){c=l.unique;var d=c.tileSymbols;const v=d.length-1;for(let u=0;u<v;u++)if(d[u]===l){d[u]=d[v];break}d.length=v;0===v&&(d=this._uniqueSymbolsReferences.get(a),d.delete(c),0===d.size&&this._uniqueSymbolsReferences.delete(a));l.unique=null}};e._addSymbols=function(c,d){if(0!==d.size){var a=this._visibleTiles;for(const b of a)b.parentTile||
b.key.world!==c.world||b.key.level===c.level&&!b.key.equals(c)||this._matchSymbols(b,c,d);for(const [b,l]of d)for(const v of l)y.isNone(v.unique)&&(c=this._createUnique(),v.unique=c,c.tileSymbols.push(v),d=this._uniqueSymbolsReferences.get(b),d||(d=new Set,this._uniqueSymbolsReferences.set(b,d)),d.add(c))}};e._matchSymbols=function(c,d,a){if(c.key.level>d.level){var b=c.key.level-d.level;if(c.key.row>>b!==d.row||c.key.col>>b!==d.col)return}if(d.level>c.key.level&&(b=d.level-c.key.level,d.row>>b!==
c.key.row||d.col>>b!==c.key.col))return;if(d.equals(c.key))for(var l of c.childrenTiles)this._matchSymbols(l,d,a);else{l=new Map;for(const [h,p]of a){var v=[];for(const n of p)a=k.tileCoordChange(this.tileCoordRange,n.xTile,d.level,d.col,c.key.level,c.key.col),b=k.tileCoordChange(this.tileCoordRange,n.yTile,d.level,d.row,c.key.level,c.key.row),0<=a&&a<this.tileCoordRange&&0<=b&&b<this.tileCoordRange&&v.push({symbol:n,xTransformed:a,yTransformed:b});a=[];b=c.key.level<d.level?1:1<<c.key.level-d.level;
const g=this._tiles.get(c.id).symbols.get(h);if(g){const n=g.flat;for(const x of v){var u=!1;let D;const z=x.xTransformed,q=x.yTransformed;D=y.isSome(g.index)?g.index.getCell(z,q):n;v=x.symbol;const B=v.hash;for(const H of D)if(B===H.hash&&Math.abs(z-H.xTile)<=b&&Math.abs(q-H.yTile)<=b){u=H.unique;v.unique=u;u.tileSymbols.push(v);u=!0;break}u||a.push(v)}}0<a.length&&l.set(h,a)}for(const h of c.childrenTiles)this._matchSymbols(h,d,l)}};e._createUniqueSymbolLayerArray=function(){var c=this._uniqueSymbolsReferences;
const d=Array(c.size);let a=0;for(const [b,l]of c){const v=Array(l.size);c=0;for(const u of l)v[c++]=u;d[a]={styleLayerUID:b,uniqueSymbols:v};a++}return d};F._createClass(t,[{key:"uniqueSymbols",get:function(){y.isNone(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}}]);return t}();A.SymbolRepository=r;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleLayer"],
function(A){return function(){function F(k,r){this._style=k;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;k.layers||(k.layers=[]);this.version=parseFloat(k.version);this.sprite=r?r.spriteUrl:k.sprite;this.glyphs=r?r.glyphsUrl:k.glyphs;if(this.layers=k.layers.map((t,e,c)=>this._create(t,e,c)))for(r=0;r<this.layers.length;r++)k=this.layers[r],this._layerByName[k.id.toLowerCase()]=k,this._uidToLayer.set(k.uid,k),0===k.type&&this.backgroundBucketIds.push(k.id);
this._identifyRefLayers()}var y=F.prototype;y.isPainterDataDriven=function(k){return(k=this._layerByName[k.toLowerCase()])?k.isPainterDataDriven():!1};y.getStyleLayerId=function(k){return k>=this.layers.length?null:this.layers[k].id};y.getStyleLayerByUID=function(k){k=this._uidToLayer.get(k);return null!=k?k:null};y.getStyleLayerIndex=function(k){return(k=this._layerByName[k.toLowerCase()])?this.layers.indexOf(k):-1};y.setStyleLayer=function(k,r){if(k&&k.id){var t=this._style;null!=r&&r>=this.layers.length&&
(r=this.layers.length-1);var e=!0,c;if(c=this._layerByName[k.id.toLowerCase()]){const d=this.layers.indexOf(c);r||(r=d);r===d?(e=!1,c=F._recreateLayer(k,c),this.layers[r]=c,t.layers[r]=k):(this.layers.splice(d,1),t.layers.splice(d,1),c=this._create(k,r,this.layers),this.layers.splice(r,0,c),t.layers.splice(r,0,k))}else c=this._create(k,r,this.layers),!r||r>=this.layers.length?(this.layers.push(c),t.layers.push(k)):(this.layers.splice(r,0,c),t.layers.splice(r,0,k));this._layerByName[k.id.toLowerCase()]=
c;this._uidToLayer.set(c.uid,c);e&&this._recomputeZValues();this._identifyRefLayers()}};y.getStyleLayer=function(k){return(k=this._layerByName[k.toLowerCase()])?{type:k.typeName,id:k.id,source:k.source,"source-layer":k.sourceLayer,minzoom:k.minzoom,maxzoom:k.maxzoom,filter:k.filter,layout:k.layout,paint:k.paint}:null};y.deleteStyleLayer=function(k){const r=this._layerByName[k.toLowerCase()];r&&(delete this._layerByName[k.toLowerCase()],this._uidToLayer.delete(r.uid),k=this.layers.indexOf(r),this.layers.splice(k,
1),this._style.layers.splice(k,1),this._recomputeZValues(),this._identifyRefLayers())};y.getLayerById=function(k){return this._layerByName[k.toLowerCase()]};y.getLayoutProperties=function(k){return(k=this._layerByName[k.toLowerCase()])?k.layout:null};y.getPaintProperties=function(k){return(k=this._layerByName[k.toLowerCase()])?k.paint:null};y.setPaintProperties=function(k,r){if(k=this._layerByName[k.toLowerCase()]){var t=F._recreateLayer({type:k.typeName,id:k.id,source:k.source,"source-layer":k.sourceLayer,
minzoom:k.minzoom,maxzoom:k.maxzoom,filter:k.filter,layout:k.layout,paint:r},k),e=this.layers.indexOf(k);this.layers[e]=t;this._style.layers[e].paint=r;this._layerByName[k.id.toLowerCase()]=t;this._uidToLayer.set(k.uid,t)}};y.setLayoutProperties=function(k,r){if(k=this._layerByName[k.toLowerCase()]){var t=F._recreateLayer({type:k.typeName,id:k.id,source:k.source,"source-layer":k.sourceLayer,minzoom:k.minzoom,maxzoom:k.maxzoom,filter:k.filter,layout:r,paint:k.paint},k),e=this.layers.indexOf(k);this.layers[e]=
t;this._style.layers[e].layout=r;this._layerByName[k.id.toLowerCase()]=t;this._uidToLayer.set(k.uid,t)}};y.setStyleLayerVisibility=function(k,r){if(k=this._layerByName[k.toLowerCase()]){var t=k.layout||{};t.visibility=r;r=F._recreateLayer({type:k.typeName,id:k.id,source:k.source,"source-layer":k.sourceLayer,minzoom:k.minzoom,maxzoom:k.maxzoom,filter:k.filter,layout:t,paint:k.paint},k);var e=this.layers.indexOf(k);this.layers[e]=r;this._style.layers[e].layout=t;this._layerByName[k.id.toLowerCase()]=
r;this._uidToLayer.set(k.uid,r)}};y.getStyleLayerVisibility=function(k){var r;k=this._layerByName[k.toLowerCase()];if(!k)return"none";k=k.layout;return null!=(r=null==k?void 0:k.visibility)?r:"visible"};y._recomputeZValues=function(){const k=this.layers,r=1/(k.length+1);for(let t=0;t<k.length;t++)k[t].z=1-(1+t)*r};y._identifyRefLayers=function(){const k=[],r=[];let t=0;for(const b of this.layers){const l=b.layout;if(1===b.type){var e,c=b,d=b.source+"|"+b.sourceLayer;d+=null!=(e="|"+(null==l?void 0:
l.visibility))?e:"";d+="|"+b.minzoom;d+="|"+b.maxzoom;d+="|"+JSON.stringify(b.filter);if(c.hasDataDrivenFill||c.hasDataDrivenOutline)d+="|"+t;k.push({key:d,layer:b})}else if(2===b.type){var a;c=b;d=b.source+"|"+b.sourceLayer;d+=null!=(a="|"+(null==l?void 0:l.visibility))?a:"";d+="|"+b.minzoom;d+="|"+b.maxzoom;d+="|"+JSON.stringify(b.filter);d+="|"+(void 0!==l?l["line-cap"]:"");d+="|"+(void 0!==l?l["line-join"]:"");c.hasDataDrivenLine&&(d+="|"+t);r.push({key:d,layer:b})}++t}this._assignRefLayers(k);
this._assignRefLayers(r)};y._assignRefLayers=function(k){k.sort((a,b)=>a.key<b.key?-1:a.key>b.key?1:0);let r,t;const e=k.length;for(let a=0;a<e;a++){const b=k[a];if(b.key===r)b.layer.refLayerId=t;else if(r=b.key,t=b.layer.id,1===b.layer.type){if(!b.layer.getPaintProperty("fill-outline-color"))for(var c=a+1;c<e;c++){var d=k[c];if(d.key===r){if(d.layer.getPaintProperty("fill-outline-color")){k[a]=d;k[c]=b;t=d.layer.id;break}}else break}}else if(2===b.layer.type)for(c=b.layer,d=a+1;d<e;d++){const l=
k[d];if(l.key!==r)break;const v=l.layer;if(c.canUseThinTessellation&&!v.canUseThinTessellation||!c.canUseThinTessellation&&(v.getPaintProperty("line-pattern")||v.getPaintProperty("line-dasharray")))c=v,k[a]=l,k[d]=b,t=l.layer.id}}};y._create=function(k,r,t){r=1-1/(t.length+1)*(1+r);t=this._runningId++;switch(k.type){case "background":return new A.BackgroundStyleLayer(0,k,r,t);case "fill":return new A.FillStyleLayer(1,k,r,t);case "line":return new A.LineStyleLayer(2,k,r,t);case "symbol":return new A.SymbolStyleLayer(3,
k,r,t);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new A.CircleStyleLayer(4,k,r,t)}throw Error("Unknown vector tile layer");};F._recreateLayer=function(k,r){switch(k.type){case "background":return new A.BackgroundStyleLayer(0,k,r.z,r.uid);case "fill":return new A.FillStyleLayer(1,k,r.z,r.uid);case "line":return new A.LineStyleLayer(2,k,r.z,r.uid);case "symbol":return new A.SymbolStyleLayer(3,k,r.z,r.uid);case "raster":throw Error("Unsupported vector tile raster layer");
case "circle":return new A.CircleStyleLayer(4,k,r.z,r.uid)}};return F}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(A,F,y,k,r,t,e,c,d,a,b){let l=function(){function D(q,B,H,I){this.type=
q;this.typeName=B.type;this.id=B.id;this.source=B.source;this.sourceLayer=B["source-layer"];this.minzoom=B.minzoom;this.maxzoom=B.maxzoom;this.filter=B.filter;this.layout=B.layout;this.paint=B.paint;this.z=H;this.uid=I;switch(q){case 0:this._layoutDefinition=d.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=d.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=d.StyleDefinition.fillLayoutDefinition;this._paintDefinition=d.StyleDefinition.fillPaintDefinition;
break;case 2:this._layoutDefinition=d.StyleDefinition.lineLayoutDefinition;this._paintDefinition=d.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=d.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=d.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=d.StyleDefinition.circleLayoutDefinition,this._paintDefinition=d.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}
var z=D.prototype;z.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=c.createFilter(this.filter)};z.getLayoutProperty=function(q){return this._layoutProperties[q]};z.getPaintProperty=function(q){return this._paintProperties[q]};z.getLayoutValue=function(q,B,H){let I;const G=this._layoutProperties[q];G&&(I=G.getValue(B,H));void 0===I&&(I=this._layoutDefinition[q]["default"]);return I};z.getPaintValue=function(q,B,H){let I;const G=this._paintProperties[q];
G&&(I=G.getValue(B,H));void 0===I&&(I=this._paintDefinition[q]["default"]);return I};z.isPainterDataDriven=function(){const q=this._paintProperties;if(q)for(const B in q)if(q[B].isDataDriven)return!0;return!1};z._parseLayout=function(q){const B={};for(const H in q){const I=this._layoutDefinition[H];I&&(B[H]=new a(I,q[H]))}return B};z._parsePaint=function(q){const B={};for(const H in q){const I=this._paintDefinition[H];I&&(B[H]=new a(I,q[H]))}return B};z.computeAttributesKey=function(q,B,H,I){let G=
0,J=0;for(const O of B){B=3;if(!O||O!==I){const {isLayout:P,isOptional:Q}=H[O];B=P?this.getLayoutProperty(O):this.getPaintProperty(O);B=null!=B&&B.interpolator?2:null!=B&&B.isDataDriven?1:Q&&!B?3:0}J|=B<<G;G+=2}return J<<3|q};return D}(),v=function(D){function z(q,B,H,I){q=D.call(this,q,B,H,I)||this;q.backgroundMaterial=new y.VTLBackgroundMaterial(q.computeAttributesKey(0,y.VTLBackgroundMaterial.ATTRIBUTES,y.VTLBackgroundMaterial.ATTRIBUTES_INFO));return q}F._inheritsLoose(z,D);return z}(l),u=function(D){function z(q,
B,H,I){q=D.call(this,q,B,H,I)||this;B=q.getPaintProperty("fill-color");H=q.getPaintProperty("fill-opacity");I=q.getPaintProperty("fill-pattern");q.hasDataDrivenColor=null==B?void 0:B.isDataDriven;q.hasDataDrivenOpacity=null==H?void 0:H.isDataDriven;q.hasDataDrivenFill=q.hasDataDrivenColor||q.hasDataDrivenOpacity||(null==I?void 0:I.isDataDriven);H=q.getPaintProperty("fill-outline-color");q.outlineUsesFillColor=!H;q.hasDataDrivenOutlineColor=null==H?void 0:H.isDataDriven;q.hasDataDrivenOutline=H?H.isDataDriven:
B?B.isDataDriven:!1;q.hasDataDrivenOutline=(H?q.hasDataDrivenOutlineColor:q.hasDataDrivenColor)||q.hasDataDrivenOpacity;q.fillMaterial=new r.VTLFillMaterial(q.computeAttributesKey(1,r.VTLFillMaterial.ATTRIBUTES,r.VTLFillMaterial.ATTRIBUTES_INFO));q.outlineMaterial=new r.VTLOutlineMaterial(q.computeAttributesKey(2,q.outlineUsesFillColor?r.VTLOutlineMaterial.ATTRIBUTES_FILL:r.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,q.outlineUsesFillColor?r.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:r.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),
q.outlineUsesFillColor);return q}F._inheritsLoose(z,D);return z}(l),h=function(D){function z(q,B,H,I){var G,J,O,P,Q,L,M,K,S;q=D.call(this,q,B,H,I)||this;B=q.getPaintProperty("line-pattern");q.lineMaterial=new t.VTLLineMaterial(q.computeAttributesKey(3,t.VTLLineMaterial.ATTRIBUTES,t.VTLLineMaterial.ATTRIBUTES_INFO,B?"line-dasharray":""));q.hasDataDrivenLine=(null==(G=q.getPaintProperty("line-blur"))?void 0:G.isDataDriven)||(null==(J=q.getPaintProperty("line-color"))?void 0:J.isDataDriven)||(null==
(O=q.getPaintProperty("line-gap-width"))?void 0:O.isDataDriven)||(null==(P=q.getPaintProperty("line-offset"))?void 0:P.isDataDriven)||(null==(Q=q.getPaintProperty("line-opacity"))?void 0:Q.isDataDriven)||(null==(L=q.getPaintProperty("line-pattern"))?void 0:L.isDataDriven)||(null==(M=q.getPaintProperty("line-dasharray"))?void 0:M.isDataDriven)||(null==(K=q.getLayoutProperty("line-cap"))?void 0:K.isDataDriven)||(null==(S=q.getPaintProperty("line-width"))?void 0:S.isDataDriven);q.canUseThinTessellation=
!1;!q.hasDataDrivenLine&&(G=q.getPaintProperty("line-width"),!G||"number"===typeof G&&.5*G<b.THIN_LINE_HALF_WIDTH_THRESHOLD)&&(G=q.getPaintProperty("line-offset"),!G||"number"===typeof G&&0===G)&&(q.canUseThinTessellation=!0);return q}F._inheritsLoose(z,D);z.prototype.getDashKey=function(q,B){switch(B){case 0:B="Butt";break;case 1:B="Round";break;case 2:B="Square";break;default:B="Butt"}return`dasharray-[${q.toString()}]-${B}`};return z}(l),p=function(D){function z(q,B,H,I){var G,J,O,P,Q,L,M,K,S,
U,W,aa;q=D.call(this,q,B,H,I)||this;q.iconMaterial=new e.VTLIconMaterial(q.computeAttributesKey(4,e.VTLIconMaterial.ATTRIBUTES,e.VTLIconMaterial.ATTRIBUTES_INFO));q.textMaterial=new e.VTLTextMaterial(q.computeAttributesKey(6,e.VTLTextMaterial.ATTRIBUTES,e.VTLTextMaterial.ATTRIBUTES_INFO));q.hasDataDrivenIcon=(null==(G=q.getPaintProperty("icon-color"))?void 0:G.isDataDriven)||(null==(J=q.getPaintProperty("icon-halo-blur"))?void 0:J.isDataDriven)||(null==(O=q.getPaintProperty("icon-halo-color"))?void 0:
O.isDataDriven)||(null==(P=q.getPaintProperty("icon-halo-width"))?void 0:P.isDataDriven)||(null==(Q=q.getPaintProperty("icon-opacity"))?void 0:Q.isDataDriven)||(null==(L=q.getLayoutProperty("icon-size"))?void 0:L.isDataDriven);q.hasDataDrivenText=(null==(M=q.getPaintProperty("text-color"))?void 0:M.isDataDriven)||(null==(K=q.getPaintProperty("text-halo-blur"))?void 0:K.isDataDriven)||(null==(S=q.getPaintProperty("text-halo-color"))?void 0:S.isDataDriven)||(null==(U=q.getPaintProperty("text-halo-width"))?
void 0:U.isDataDriven)||(null==(W=q.getPaintProperty("text-opacity"))?void 0:W.isDataDriven)||(null==(aa=q.getLayoutProperty("text-size"))?void 0:aa.isDataDriven);return q}F._inheritsLoose(z,D);return z}(l),g=function(D){function z(q,B,H,I){q=D.call(this,q,B,H,I)||this;q.circleMaterial=new k.VTLCircleMaterial(q.computeAttributesKey(5,k.VTLCircleMaterial.ATTRIBUTES,k.VTLCircleMaterial.ATTRIBUTES_INFO));return q}F._inheritsLoose(z,D);return z}(l),n=function(){function D(z,q,B){var H,I,G,J,O;this.allowOverlap=
z.getLayoutValue("icon-allow-overlap",q);this.ignorePlacement=z.getLayoutValue("icon-ignore-placement",q);this.keepUpright=z.getLayoutValue("icon-keep-upright",q);this.optional=z.getLayoutValue("icon-optional",q);this.rotationAlignment=z.getLayoutValue("icon-rotation-alignment",q);2===this.rotationAlignment&&(this.rotationAlignment=B?0:1);B=z.getLayoutProperty("icon-anchor");null!=(H=B)&&H.isDataDriven?this._anchorProp=B:this.anchor=z.getLayoutValue("icon-anchor",q);B=z.getLayoutProperty("icon-offset");
null!=(I=B)&&I.isDataDriven?this._offsetProp=B:this.offset=z.getLayoutValue("icon-offset",q);B=z.getLayoutProperty("icon-padding");null!=(G=B)&&G.isDataDriven?this._paddingProp=B:this.padding=z.getLayoutValue("icon-padding",q);B=z.getLayoutProperty("icon-rotate");null!=(J=B)&&J.isDataDriven?this._rotateProp=B:this.rotate=z.getLayoutValue("icon-rotate",q);B=z.getLayoutProperty("icon-size");null!=(O=B)&&O.isDataDriven?this._sizeProp=B:this.size=z.getLayoutValue("icon-size",q)}D.prototype.update=function(z,
q){this._anchorProp&&(this.anchor=this._anchorProp.getValue(z,q));this._offsetProp&&(this.offset=this._offsetProp.getValue(z,q));this._paddingProp&&(this.padding=this._paddingProp.getValue(z,q));this._rotateProp&&(this.rotate=this._rotateProp.getValue(z,q));this._sizeProp&&(this.size=this._sizeProp.getValue(z,q))};return D}(),x=function(){function D(z,q,B){var H,I,G,J,O,P,Q,L,M,K,S;this.allowOverlap=z.getLayoutValue("text-allow-overlap",q);this.ignorePlacement=z.getLayoutValue("text-ignore-placement",
q);this.keepUpright=z.getLayoutValue("text-keep-upright",q);this.optional=z.getLayoutValue("text-optional",q);this.rotationAlignment=z.getLayoutValue("text-rotation-alignment",q);2===this.rotationAlignment&&(this.rotationAlignment=B?0:1);B=z.getLayoutProperty("text-anchor");null!=(H=B)&&H.isDataDriven?this._anchorProp=B:this.anchor=z.getLayoutValue("text-anchor",q);B=z.getLayoutProperty("text-justify");null!=(I=B)&&I.isDataDriven?this._justifyProp=B:this.justify=z.getLayoutValue("text-justify",q);
B=z.getLayoutProperty("text-letter-spacing");null!=(G=B)&&G.isDataDriven?this._letterSpacingProp=B:this.letterSpacing=z.getLayoutValue("text-letter-spacing",q);B=z.getLayoutProperty("text-line-height");null!=(J=B)&&J.isDataDriven?this._lineHeightProp=B:this.lineHeight=z.getLayoutValue("text-line-height",q);B=z.getLayoutProperty("text-max-angle");null!=(O=B)&&O.isDataDriven?this._maxAngleProp=B:this.maxAngle=z.getLayoutValue("text-max-angle",q);B=z.getLayoutProperty("text-max-width");null!=(P=B)&&
P.isDataDriven?this._maxWidthProp=B:this.maxWidth=z.getLayoutValue("text-max-width",q);B=z.getLayoutProperty("text-offset");null!=(Q=B)&&Q.isDataDriven?this._offsetProp=B:this.offset=z.getLayoutValue("text-offset",q);B=z.getLayoutProperty("text-padding");null!=(L=B)&&L.isDataDriven?this._paddingProp=B:this.padding=z.getLayoutValue("text-padding",q);B=z.getLayoutProperty("text-rotate");null!=(M=B)&&M.isDataDriven?this._rotateProp=B:this.rotate=z.getLayoutValue("text-rotate",q);B=z.getLayoutProperty("text-size");
null!=(K=B)&&K.isDataDriven?this._sizeProp=B:this.size=z.getLayoutValue("text-size",q);B=z.getLayoutProperty("text-writing-mode");null!=(S=B)&&S.isDataDriven?this._writingModeProp=B:this.writingMode=z.getLayoutValue("text-writing-mode",q)}D.prototype.update=function(z,q){this._anchorProp&&(this.anchor=this._anchorProp.getValue(z,q));this._justifyProp&&(this.justify=this._justifyProp.getValue(z,q));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(z,q));this._lineHeightProp&&
(this.lineHeight=this._lineHeightProp.getValue(z,q));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(z,q));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(z,q));this._offsetProp&&(this.offset=this._offsetProp.getValue(z,q));this._paddingProp&&(this.padding=this._paddingProp.getValue(z,q));this._rotateProp&&(this.rotate=this._rotateProp.getValue(z,q));this._sizeProp&&(this.size=this._sizeProp.getValue(z,q));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(z,
q))};return D}();A.BackgroundStyleLayer=v;A.CircleStyleLayer=g;A.FillStyleLayer=u;A.IconLayout=n;A.LineStyleLayer=h;A.StyleLayer=l;A.SymbolStyleLayer=p;A.TextLayout=x;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(A,F,y){y=function(k){function r(e){return k.call(this,e)||this}F._inheritsLoose(r,k);var t=r.prototype;t.geometryInfo=
function(){return r.GEOMETRY_LAYOUT};t.opacityInfo=function(){return null};t.attributes=function(){return r.ATTRIBUTES};t.attributesInfo=function(){return r.ATTRIBUTES_INFO};return r}(y.VTLMaterial);y.ATTRIBUTES=[];y.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}];y.ATTRIBUTES_INFO={};A.VTLBackgroundMaterial=y;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/maybe","../MemoryBuffer"],function(A,F,y,k){let r=function(){function c(a){this._locations=new Map;this._key=a}var d=c.prototype;d.defines=function(){return[]};d.getStride=function(){this._layoutInfo||this._buildAttributesInfo();return this._stride};d.getAttributeLocations=function(){0===this._locations.size&&this._buildAttributesInfo();return this._locations};d.getLayoutInfo=function(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo};d.getEncodingInfos=
function(){this._propertyEncodingInfo||this._buildAttributesInfo();return this._propertyEncodingInfo};d.getUniforms=function(){this._uniforms||this._buildAttributesInfo();return this._uniforms};d.getShaderHeader=function(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader};d.getShaderMain=function(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain};d.setDataUniforms=function(a,b,l,v,u){var h=this.getUniforms();for(const p of h){const {name:g,type:n,getValue:x}=
p;h=x(l,b,v,u);if(null!==h)switch(n){case "float":a.setUniform1f(g,h);break;case "vec2":a.setUniform2fv(g,h);break;case "vec4":a.setUniform4fv(g,h)}}};d.encodeAttributes=function(a,b,l,v){const u=this.attributesInfo(),h=this.getEncodingInfos(),p=[];let g=0,n=0;for(const z of Object.keys(h)){var x,D=h[z];const {type:q,precisionFactor:B,isLayout:H}=u[z],I=H?l.getLayoutProperty(z):l.getPaintProperty(z),G=null==(x=I.interpolator)?void 0:x.getInterpolationRange(b);let J=0;for(const O of D){const {offset:P,
bufferElementsToAdd:Q}=O;if(0<Q){for(D=0;D<Q;D++)p.push(0);g+=n;n=O.bufferElementsToAdd}D=null!=v?v:I.getValue(G?G[J]:b,a);switch(q){case 0:case 1:p[g]|=this._encodeByte(D*(B||1),8*P);break;case 2:case 3:p[g]|=this._encodeShort(D*(B||1),8*P);break;case 4:case 5:p[g]|=this._encodeByte(D*(B||1),8*P);p[g]|=this._encodeByte(D*(B||1),8*P+8);break;case 6:case 7:p[g]|=this._encodeShort(D*(B||1),8*P);p[g]|=this._encodeShort(D*(B||1),8*P+16);break;case 8:case 9:p[g]|=this._encodeByte(D*(B||1),8*P);p[g]|=this._encodeByte(D*
(B||1),8*P+8);p[g]|=this._encodeByte(D*(B||1),8*P+16);p[g]|=this._encodeByte(D*(B||1),8*P+24);break;case 10:p[g]=this._encodeColor(D);break;case 11:case 12:this._encodePattern(g,p,D);break;default:throw Error("Unsupported encoding type");}J++}}return p};d.getAtributeState=function(a){const b=3+2*a;a=0|this._bit(b);return a|=this._bit(b+1)<<1};d._buildAttributesInfo=function(){const a=[],b={};var l={},v=-1;const u=this.attributesInfo();var h=this.attributes();let p=-1;for(const D of h){p++;h=this.getAtributeState(p);
if(0===h||3===h)continue;var g=u[D];const z=[];b[D]=z;g=g.type;for(let q=0;q<h;q++){const {dataType:B,bytesPerElement:H,count:I,normalized:G}=c._encodingInfo[g],J=H*I;let O=l[B];var n=0;!O||4<O.count+I?(v++,O={dataIndex:v,count:0,offset:0},4!==I&&(l[B]=O),a.push({location:-1,name:"a_data_"+v,count:I,type:B,normalized:G}),n=Math.ceil(Math.max(J/4,1))):(n=a[O.dataIndex],n.count+=I,n=Math.ceil(Math.max(n.count*H/4,1))-Math.ceil(Math.max(O.offset/4,1)));z.push({dataIndex:O.dataIndex,offset:O.offset,bufferElementsToAdd:n});
O.offset+=J;O.count+=I}}for(const D of a)switch(D.type){case 5120:case 5121:D.count=4;case 5122:case 5123:D.count+=D.count%2}this._buildVertexBufferLayout(a);l=0;v=this._layoutInfo.geometry;for(var x of v)this._locations.set(x.name,l++);if(x=this._layoutInfo.opacity)for(const D of x)this._locations.set(D.name,l++);this._buildShaderInfo(a,b);this._propertyEncodingInfo=b};d._buildVertexBufferLayout=function(a){const b={};var l=this.geometryInfo();let v=l[0].stride;if(0===a.length)b.geometry=l;else{const u=
[];let h=v;for(const p of a)v+=t(p.type)*p.count;for(const p of l)l={...p},l.stride=v,u.push(l);for(const p of a)u.push({name:p.name,count:p.count,type:p.type,offset:h,stride:v,normalized:p.normalized||!1,divisor:0}),h+=t(p.type)*p.count;b.geometry=u}this.opacityInfo()&&(b.opacity=this.opacityInfo());this._layoutInfo=b;this._stride=v};d._buildShaderInfo=function(a,b){let l="\n",v="\n";const u=[];for(var h of a)l+=`attribute ${this._getType(h.count)} ${h.name};\n`;var p=this.attributes();a=this.attributesInfo();
h=-1;for(const x of p){h++;const {name:D,type:z,precisionFactor:q,isLayout:B}=a[x];p=q&&1!==q?` * ${1/q}`:"";const {bytesPerElement:H,count:I}=c._encodingInfo[z];var g=G=>`a_data_${G.dataIndex}${e(I,G.offset,H)}`;switch(this.getAtributeState(h)){case 0:p=this._getType(I);var n=`u_${D}`;u.push({name:n,type:p,getValue:(G,J,O,P)=>{O=B?G.getLayoutValue(x,J):G.getPaintValue(x,J);if(11===z){G=G.getDashKey(O,G.getLayoutValue("line-cap",J));P=P.getMosaicItemPosition(G,!1);if(y.isNone(P))return null;const {tl:Q,
br:L}=P;return[Q[0],L[1],L[0],Q[1]]}if(12===z){P=P.getMosaicItemPosition(O,-1===x.indexOf("line-"));if(y.isNone(P))return null;const {tl:Q,br:L}=P;return[Q[0],L[1],L[0],Q[1]]}return 10===z?(P=O[3],[P*O[0],P*O[1],P*O[2],P]):O}});l+=`uniform ${p} ${n};\n`;v+=`${p} ${D} = ${n};\n`;break;case 1:n=g(b[x][0]);v+=`${this._getType(I)} ${D} = ${n}${p};\n`;break;case 2:{n=`u_t_${D}`;u.push({name:n,type:"float",getValue:(J,O,P,Q)=>(B?J.getLayoutProperty(x):J.getPaintProperty(x)).interpolator.interpolationUniformValue(P,
O)});l+=`uniform float ${n};\n`;const G=g(b[x][0]);g=g(b[x][1]);v+=`${this._getType(I)} ${D} = mix(${G}${p}, ${g}${p}, ${n});\n`}}}this._shaderHeader=l;this._shaderMain=v;this._uniforms=u};d._bit=function(a){return(this._key&1<<a)>>a};d._getType=function(a){switch(a){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");};d._encodeColor=function(a){const b=255*a[3];return k.i8888to32(a[0]*b,a[1]*b,a[2]*b,b)};d._encodePattern=function(a,b,l){if(l&&
l.rect){var v=l.rect,u=l.width;l=l.height;b[a]=this._encodeShort(v.x+2,0);b[a]|=this._encodeShort(v.y+2+l,16);b[a+1]=this._encodeShort(v.x+2+u,0);b[a+1]|=this._encodeShort(v.y+2,16)}};d._encodeByte=function(a,b){return(a&255)<<b};d._encodeShort=function(a,b){return(a&65535)<<b};F._createClass(c,[{key:"key",get:function(){return this._key}},{key:"type",get:function(){return this._key&7}}]);return c}();r._encodingInfo={[0]:{dataType:5120,bytesPerElement:1,count:1,normalized:!1},[1]:{dataType:5121,bytesPerElement:1,
count:1,normalized:!1},[2]:{dataType:5122,bytesPerElement:2,count:1,normalized:!1},[3]:{dataType:5123,bytesPerElement:2,count:1,normalized:!1},[4]:{dataType:5120,bytesPerElement:1,count:2,normalized:!1},[5]:{dataType:5121,bytesPerElement:1,count:2,normalized:!1},[6]:{dataType:5122,bytesPerElement:2,count:2,normalized:!1},[7]:{dataType:5123,bytesPerElement:2,count:2,normalized:!1},[8]:{dataType:5120,bytesPerElement:1,count:4,normalized:!1},[9]:{dataType:5121,bytesPerElement:1,count:4,normalized:!1},
[10]:{dataType:5121,bytesPerElement:1,count:4,normalized:!0},[11]:{dataType:5123,bytesPerElement:2,count:4,normalized:!1},[12]:{dataType:5123,bytesPerElement:2,count:4,normalized:!1}};const t=c=>{switch(c){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1}},e=(c,d,a)=>{d/=a;if(1===c)switch(d){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===c)switch(d){case 0:return".xy";case 1:return".yz";
case 2:return".zw"}else if(3===c)switch(d){case 0:return".xyz";case 1:return".yzw"}return""};A.VTLMaterial=r;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(A){return function(){function F(k){this._array=[];0>=k&&console.error("strideInBytes must be positive!");this._stride=k}var y=F.prototype;y.reset=function(){this.array.length=0};y.toBuffer=function(){return(new Uint32Array(this._array)).buffer};
F.i1616to32=function(k,r){return 65535&k|r<<16};F.i8888to32=function(k,r,t,e){return k&255|(r&255)<<8|(t&255)<<16|e<<24};F.i8816to32=function(k,r,t){return k&255|(r&255)<<8|t<<16};A._createClass(F,[{key:"array",get:function(){return this._array}},{key:"index",get:function(){return 4*this._array.length/this._stride}},{key:"itemSize",get:function(){return this._stride}},{key:"sizeInBytes",get:function(){return 4*this._array.length}}]);return F}()})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(A,F,y){y=function(k){function r(e){return k.call(this,e)||this}F._inheritsLoose(r,k);var t=r.prototype;t.geometryInfo=function(){return r.GEOMETRY_LAYOUT};t.opacityInfo=function(){return null};t.attributes=function(){return r.ATTRIBUTES};t.attributesInfo=function(){return r.ATTRIBUTES_INFO};return r}(y.VTLMaterial);y.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");
y.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}];y.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:1},"circle-color":{name:"color",type:10},"circle-opacity":{name:"opacity",type:1,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:1,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:10},"circle-stroke-opacity":{name:"stroke_opacity",type:1,precisionFactor:100},"circle-blur":{name:"blur",type:1,precisionFactor:32}};
A.VTLCircleMaterial=y;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(A,F,y){let k=function(r){function t(c){return r.call(this,c)||this}F._inheritsLoose(t,r);var e=t.prototype;e.geometryInfo=function(){return t.GEOMETRY_LAYOUT};e.opacityInfo=function(){return null};e.attributes=function(){return t.ATTRIBUTES};e.attributesInfo=function(){return t.ATTRIBUTES_INFO};
return t}(y.VTLMaterial);k.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];k.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}];k.ATTRIBUTES_INFO={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100},"fill-pattern":{name:"tlbr",type:12,isOptional:!0}};y=function(r){function t(c,d){c=r.call(this,c)||this;c.usefillColor=d;return c}F._inheritsLoose(t,r);var e=t.prototype;e.geometryInfo=function(){return t.GEOMETRY_LAYOUT};
e.opacityInfo=function(){return null};e.attributes=function(){return this.usefillColor?t.ATTRIBUTES_FILL:t.ATTRIBUTES_OUTLINE};e.attributesInfo=function(){return this.usefillColor?t.ATTRIBUTES_INFO_FILL:t.ATTRIBUTES_INFO_OUTLINE};return t}(y.VTLMaterial);y.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];y.ATTRIBUTES_FILL=["fill-color","fill-opacity"];y.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,
normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}];y.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}};y.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}};A.VTLFillMaterial=k;A.VTLOutlineMaterial=y;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(A,F,y){y=function(k){function r(e){return k.call(this,e)||this}F._inheritsLoose(r,k);var t=r.prototype;t.geometryInfo=function(){return r.GEOMETRY_LAYOUT};t.opacityInfo=function(){return null};t.attributes=function(){return r.ATTRIBUTES};t.attributesInfo=function(){return r.ATTRIBUTES_INFO};return r}(y.VTLMaterial);y.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");
y.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_extrude_offset",count:4,type:5120,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_dir_normal",count:4,type:5120,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:12,stride:16,normalized:!1,divisor:0}];y.ATTRIBUTES_INFO={"line-width":{name:"width",type:1,precisionFactor:2},"line-gap-width":{name:"gap_width",type:1,precisionFactor:2},"line-offset":{name:"offset",
type:0,precisionFactor:2},"line-color":{name:"color",type:10},"line-opacity":{name:"opacity",type:1,precisionFactor:100},"line-blur":{name:"blur",type:1,precisionFactor:4},"line-pattern":{name:"tlbr",type:12,isOptional:!0},"line-dasharray":{name:"tlbr",type:11,isOptional:!0}};A.VTLLineMaterial=y;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],
function(A,F,y){const k=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],r=[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}];let t=function(e){function c(a){return e.call(this,a)||this}
F._inheritsLoose(c,e);var d=c.prototype;d.geometryInfo=function(){return k};d.opacityInfo=function(){return r};d.attributes=function(){return c.ATTRIBUTES};d.attributesInfo=function(){return c.ATTRIBUTES_INFO};return c}(y.VTLMaterial);t.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");t.ATTRIBUTES_INFO={"icon-color":{name:"color",type:10},"icon-opacity":{name:"opacity",type:1,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:10},
"icon-halo-width":{name:"halo_width",type:1,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"icon-size":{name:"size",type:1,precisionFactor:32,isLayout:!0}};y=function(e){function c(a){return e.call(this,a)||this}F._inheritsLoose(c,e);var d=c.prototype;d.geometryInfo=function(){return k};d.opacityInfo=function(){return r};d.attributes=function(){return c.ATTRIBUTES};d.attributesInfo=function(){return c.ATTRIBUTES_INFO};return c}(y.VTLMaterial);y.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");
y.ATTRIBUTES_INFO={"text-color":{name:"color",type:10},"text-opacity":{name:"opacity",type:1,precisionFactor:100},"text-halo-color":{name:"halo_color",type:10},"text-halo-width":{name:"halo_width",type:1,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"text-size":{name:"size",type:1,isLayout:!0}};A.VTLIconMaterial=t;A.VTLTextMaterial=y;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression",
"../expression/types"],function(A,F){return function(){function y(k){this._expression=k}y.prototype.filter=function(k,r){if(!this._expression)return!0;try{return this._expression.evaluate(k,r)}catch(t){return console.log(t.message),!0}};y.createFilter=function(k){if(!k)return null;this.isLegacyFilter(k)&&(k=this.convertLegacyFilter(k));try{const r=A.createExpression(k,null,F.BooleanType);return new y(r)}catch(r){return console.log(r.message),null}};y.isLegacyFilter=function(k){if(!Array.isArray(k)||
0===k.length)return!0;switch(k[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===k.length&&"string"===typeof k[1]&&!Array.isArray(k[2]);case "in":return 3<=k.length&&"string"===typeof k[1]&&!Array.isArray(k[2]);case "!in":return!0;case "any":case "all":for(let r=1;r<k.length;r++)if(!this.isLegacyFilter(k[1]))return!1;return!0;case "none":return!0;case "has":return 2===k.length&&("$id"===k[1]||"$type"===k[1]);case "!has":return!0;default:return!1}};
y.convertLegacyFilter=function(k){if(!Array.isArray(k)||0===k.length)return!0;const r=k[0];if(1===k.length)return"any"!==r;switch(r){case "\x3d\x3d":return y.convertComparison("\x3d\x3d",k[1],k[2]);case "!\x3d":return y.negate(y.convertComparison("\x3d\x3d",k[1],k[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return y.convertComparison(r,k[1],k[2]);case "in":return y.convertIn(k[1],k.slice(2));case "!in":return y.negate(y.convertIn(k[1],k.slice(2)));case "any":case "all":case "none":return y.convertCombining(r,
k.slice(1));case "has":return y.convertHas(k[1]);case "!has":return y.negate(y.convertHas(k[1]));default:throw Error("Unexpected legacy filter.");}};y.convertComparison=function(k,r,t){switch(r){case "$type":return[k,["geometry-type"],t];case "$id":return[k,["id"],t];default:return[k,["get",r],t]}};y.convertIn=function(k,r){switch(k){case "$type":return["in",["geometry-type"],["literal",r]];case "$id":return["in",["id"],["literal",r]];default:return["in",["get",k],["literal",r]]}};y.convertHas=function(k){switch(k){case "$type":return!0;
case "$id":return["has-id"];default:return["has",k]}};y.convertCombining=function(k,r){return[k].concat(r.map(this.convertLegacyFilter))};y.negate=function(k){return["!",k]};return y}()})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../Color ../../../../../core/colorUtils ../../../unitBezier ../GeometryUtils ./types".split(" "),function(A,F,y,k,r,t,e){function c(w,f,m){var C=typeof w;if("string"===
C||"boolean"===C||"number"===C||null===w){if(m)switch(m.kind){case "string":"string"!==C&&(w=da.toString(w));break;case "number":"number"!==C&&(w=da.toNumber(w));break;case "color":w=da.toColor(w)}w=["literal",w]}if(!Array.isArray(w)||0===w.length)throw Error("Expression must be a non empty array");C=w[0];if("string"!==typeof C)throw Error("First element of expression must be a string");const E=ia[C];if(void 0===E)throw Error(`Invalid expression operator "${C}"`);if(!E)throw Error(`Unimplemented expression operator "${C}"`);
return E.parse(w,f,m)}let d=function(){function w(m){this.parent=m;this.vars={}}var f=w.prototype;f.add=function(m,C){this.vars[m]=C};f.get=function(m){return this.vars[m]?this.vars[m]:this.parent?this.parent.get(m):null};return w}(),a=function(){function w(){this.type=e.ValueType}w.parse=function(f){if(1<f.length)throw Error('"id" does not expect arguments');return new w};w.prototype.evaluate=function(f,m){return null==f?void 0:f.id};return w}(),b=function(){function w(){this.type=e.StringType}w.parse=
function(f){if(1<f.length)throw Error('"geometry-type" does not expect arguments');return new w};w.prototype.evaluate=function(f,m){if(!f)return null;switch(f.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}};return w}(),l=function(){function w(){this.type=e.ObjectType}w.parse=function(f){if(1<f.length)throw Error('"properties" does not expect arguments');return new w};w.prototype.evaluate=function(f,m){return null==f?void 0:f.values};return w}(),v=
function(){function w(){this.type=e.NumberType}w.parse=function(f){if(1<f.length)throw Error('"zoom" does not expect arguments');return new w};w.prototype.evaluate=function(f,m){return m};return w}(),u=function(){function w(f,m,C){this.lhs=f;this.rhs=m;this.compare=C;this.type=e.BooleanType}w.parse=function(f,m,C){if(3!==f.length&&4!==f.length)throw Error(`"${f[0]}" expects 2 or 3 arguments`);if(4===f.length)throw Error(`"${f[0]}" collator not supported`);return new w(c(f[1],m),c(f[2],m),C)};w.prototype.evaluate=
function(f,m){return this.compare(this.lhs.evaluate(f,m),this.rhs.evaluate(f,m))};return w}(),h=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){return u.parse(m,C,(E,N)=>E===N)};return f}(u),p=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){return u.parse(m,C,(E,N)=>E!==N)};return f}(u),g=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,
C){return u.parse(m,C,(E,N)=>E<N)};return f}(u),n=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){return u.parse(m,C,(E,N)=>E<=N)};return f}(u),x=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){return u.parse(m,C,(E,N)=>E>N)};return f}(u),D=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){return u.parse(m,C,(E,N)=>E>=N)};return f}(u),
z=function(){function w(f){this.arg=f;this.type=e.BooleanType}w.parse=function(f,m){if(2!==f.length)throw Error('"!" expects 1 argument');return new w(c(f[1],m))};w.prototype.evaluate=function(f,m){return!this.arg.evaluate(f,m)};return w}(),q=function(){function w(f){this.args=f;this.type=e.BooleanType}w.parse=function(f,m){const C=[];for(let E=1;E<f.length;E++)C.push(c(f[E],m));return new w(C)};w.prototype.evaluate=function(f,m){for(const C of this.args)if(!C.evaluate(f,m))return!1;return!0};return w}(),
B=function(){function w(f){this.args=f;this.type=e.BooleanType}w.parse=function(f,m){const C=[];for(let E=1;E<f.length;E++)C.push(c(f[E],m));return new w(C)};w.prototype.evaluate=function(f,m){for(const C of this.args)if(C.evaluate(f,m))return!0;return!1};return w}(),H=function(){function w(f){this.args=f;this.type=e.BooleanType}w.parse=function(f,m){const C=[];for(let E=1;E<f.length;E++)C.push(c(f[E],m));return new w(C)};w.prototype.evaluate=function(f,m){for(const C of this.args)if(C.evaluate(f,
m))return!1;return!0};return w}(),I=function(){function w(f,m,C){this.type=f;this.args=m;this.fallback=C}w.parse=function(f,m,C){if(4>f.length)throw Error('"case" expects at least 3 arguments');if(1===f.length%2)throw Error('"case" expects an odd number of arguments');let E;const N=[];for(let R=1;R<f.length-1;R+=2){const V=c(f[R],m),T=c(f[R+1],m,C);E||(E=T.type);N.push({condition:V,output:T})}f=c(f[f.length-1],m,C);E||(E=f.type);return new w(E,N,f)};w.prototype.evaluate=function(f,m){for(const C of this.args)if(C.condition.evaluate(f,
m))return C.output.evaluate(f,m);return this.fallback.evaluate(f,m)};return w}(),G=function(){function w(f,m){this.type=f;this.args=m}w.parse=function(f,m){if(2>f.length)throw Error('"coalesce" expects at least 1 argument');let C;const E=[];for(let N=1;N<f.length;N++){const R=c(f[N],m);C||(C=R.type);E.push(R)}return new w(C,E)};w.prototype.evaluate=function(f,m){for(const C of this.args){const E=C.evaluate(f,m);if(null!==E)return E}return null};return w}(),J=function(){function w(f,m,C,E,N){this.type=
f;this.input=m;this.labels=C;this.outputs=E;this.fallback=N}w.parse=function(f,m){if(3>f.length)throw Error('"match" expects at least 3 arguments');if(0===f.length%2)throw Error('"case" expects an even number of arguments');let C;const E=c(f[1],m),N=[],R={};let V;for(let Y=2;Y<f.length-1;Y+=2){var T=f[Y];Array.isArray(T)||(T=[T]);for(const ea of T){T=typeof ea;if("string"!==T&&"number"!==T)throw Error('"match" requires string or number literal as labels');if(!V)V=T;else if(T!==V)throw Error('"match" requires labels to have the same type');
R[ea]=N.length}T=c(f[Y+1],m);C||(C=T.type);N.push(T)}return new w(C,E,R,N,c(f[f.length-1],m))};w.prototype.evaluate=function(f,m){const C=this.input.evaluate(f,m);return(this.outputs[this.labels[C]]||this.fallback).evaluate(f,m)};return w}(),O=function(){function w(m,C,E,N,R){this.operator=m;this.type=C;this.interpolation=E;this.input=N;this.stops=R}w.parse=function(m,C,E){const N=m[0];if(5>m.length)throw Error(`"${N}" expects at least 4 arguments`);const R=m[1];if(!Array.isArray(R)||0===R.length)throw Error(`"${R}" is not a valid interpolation`);
switch(R[0]){case "linear":if(1!==R.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==R.length||"number"!==typeof R[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==R.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var V=1;5>V;V++){var T=R[V];if("number"!==typeof T||0>T||1<T)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");
}break;default:throw Error(`"${m[0]}" unknown interpolation type "${R[0]}"`);}if(1!==m.length%2)throw Error(`"${N}" expects an even number of arguments`);V=c(m[2],C,e.NumberType);let Y;"interpolate-hcl"===N||"interpolate-lab"===N?Y=e.ColorType:E&&"value"!==E.kind&&(Y=E);E=[];for(T=3;T<m.length;T+=2){const ea=m[T];if("number"!==typeof ea)throw Error(`"${N}" requires stop inputs as literal numbers`);if(E.length&&E[E.length-1][0]>=ea)throw Error(`"${N}" requires strictly ascending stop inputs`);const ja=
c(m[T+1],C,Y);Y||(Y=ja.type);E.push([ea,ja])}if(Y&&Y!==e.ColorType&&Y!==e.NumberType&&("array"!==Y.kind||Y.itemType!==e.NumberType))throw Error(`"${N}" cannot interpolate type ${e.typeToString(Y)}`);return new w(N,Y,R,V,E)};var f=w.prototype;f.evaluate=function(m,C){var E=this.stops;if(1===E.length)return E[0][1].evaluate(m,C);var N=this.input.evaluate(m,C);if(N<=E[0][0])return E[0][1].evaluate(m,C);if(N>=E[E.length-1][0])return E[E.length-1][1].evaluate(m,C);let R=0;for(;++R<E.length&&!(N<E[R][0]););
const V=w.interpolationRatio(this.interpolation,N,E[R-1][0],E[R][0]);N=E[R-1][1].evaluate(m,C);const T=E[R][1].evaluate(m,C);if("interpolate"===this.operator){if("array"===this.type.kind&&Array.isArray(N)&&Array.isArray(T))return N.map((Y,ea)=>t.interpolate(Y,T[ea],V));if("color"===this.type.kind&&N instanceof y&&T instanceof y)return N=new y(N),m=new y(T),new y([t.interpolate(N.r,m.r,V),t.interpolate(N.g,m.g,V),t.interpolate(N.b,m.b,V),t.interpolate(N.a,m.a,V)]);if("number"===this.type.kind&&"number"===
typeof N&&"number"===typeof T)return t.interpolate(N,T,V);throw Error(`"${this.operator}" cannot interpolate type ${e.typeToString(this.type)}`);}if("interpolate-hcl"===this.operator)return m=k.toLCH(N),C=k.toLCH(T),E=C.h-m.h,m=k.toRGB({h:m.h+V*(180<E||-180>E?E-360*Math.round(E/360):E),c:t.interpolate(m.c,C.c,V),l:t.interpolate(m.l,C.l,V)}),new y({a:t.interpolate(N.a,T.a,V),...m});if("interpolate-lab"===this.operator)return m=k.toLAB(N),C=k.toLAB(T),m=k.toRGB({l:t.interpolate(m.l,C.l,V),a:t.interpolate(m.a,
C.a,V),b:t.interpolate(m.b,C.b,V)}),new y({a:t.interpolate(N.a,T.a,V),...m});throw Error(`Unexpected operator "${this.operator}"`);};f.interpolationUniformValue=function(m,C){const E=this.stops;if(1===E.length||m>=E[E.length-1][0])return 0;let N=0;for(;++N<E.length&&!(m<E[N][0]););return w.interpolationRatio(this.interpolation,C,E[N-1][0],E[N][0])};f.getInterpolationRange=function(m){const C=this.stops;if(1===C.length)return m=C[0][0],[m,m];var E=C[C.length-1][0];if(m>=E)return[E,E];for(E=0;++E<C.length&&
!(m<C[E][0]););return[C[E-1][0],C[E][0]]};w.interpolationRatio=function(m,C,E,N){let R=0;"linear"===m[0]?R=w.exponentialInterpolationRatio(C,1,E,N):"exponential"===m[0]?R=w.exponentialInterpolationRatio(C,m[1],E,N):"cubic-bezier"===m[0]&&(R=r.unitBezier(m[1],m[2],m[3],m[4])(w.exponentialInterpolationRatio(C,1,E,N),1E-5));0>R?R=0:1<R&&(R=1);return R};w.exponentialInterpolationRatio=function(m,C,E,N){N-=E;if(0===N)return 0;m-=E;return 1===C?m/N:(C**m-1)/(C**N-1)};return w}(),P=function(){function w(f,
m,C){this.type=f;this.input=m;this.stops=C}w.parse=function(f,m){if(5>f.length)throw Error('"step" expects at least 4 arguments');if(1!==f.length%2)throw Error('"step" expects an even number of arguments');const C=c(f[1],m,e.NumberType);let E;const N=[];N.push([-Infinity,c(f[2],m)]);for(let R=3;R<f.length;R+=2){const V=f[R];if("number"!==typeof V)throw Error('"step" requires stop inputs as literal numbers');if(N.length&&N[N.length-1][0]>=V)throw Error('"step" requires strictly ascending stop inputs');
const T=c(f[R+1],m);E||(E=T.type);N.push([V,T])}return new w(E,C,N)};w.prototype.evaluate=function(f,m){const C=this.stops;if(1===C.length)return C[0][1].evaluate(f,m);const E=this.input.evaluate(f,m);let N=0;for(;++N<C.length&&!(E<C[N][0]););return this.stops[N-1][1].evaluate(f,m)};return w}(),Q=function(){function w(f,m){this.type=f;this.output=m}w.parse=function(f,m,C){if(4>f.length)throw Error('"let" expects at least 3 arguments');if(1===f.length%2)throw Error('"let" expects an odd number of arguments');
const E=new d(m);for(let N=1;N<f.length-1;N+=2){const R=f[N];if("string"!==typeof R)throw Error(`"let" requires a string to define variable names - found ${R}`);E.add(R,c(f[N+1],m))}f=c(f[f.length-1],E,C);return new w(f.type,f)};w.prototype.evaluate=function(f,m){return this.output.evaluate(f,m)};return w}(),L=function(){function w(f,m){this.type=f;this.output=m}w.parse=function(f,m,C){if(2!==f.length||"string"!==typeof f[1])throw Error('"var" requires just one literal string argument');m=m.get(f[1]);
if(!m)throw Error(`${f[1]} must be defined before being used in a "var" expression`);return new w(C||e.ValueType,m)};w.prototype.evaluate=function(f,m){return this.output.evaluate(f,m)};return w}(),M=function(){function w(f,m,C){this.type=f;this.index=m;this.array=C}w.parse=function(f,m){if(3!==f.length)throw Error('"at" expects 2 arguments');const C=c(f[1],m,e.NumberType);f=c(f[2],m);return new w(f.type.itemType,C,f)};w.prototype.evaluate=function(f,m){const C=this.index.evaluate(f,m);f=this.array.evaluate(f,
m);if(0>C||C>=f.length)throw Error('"at" index out of bounds');if(C!==Math.floor(C))throw Error('"at" index must be an integer');return f[C]};return w}(),K=function(){function w(f,m){this.key=f;this.obj=m;this.type=e.ValueType}w.parse=function(f,m){let C;switch(f.length){case 2:return C=c(f[1],m),new w(C);case 3:return C=c(f[1],m),f=c(f[2],m),new w(C,f);default:throw Error('"get" expects 1 or 2 arguments');}};w.prototype.evaluate=function(f,m){const C=this.key.evaluate(f,m);return this.obj?this.obj.evaluate(f,
m)[C]:null==f?void 0:f.values[C]};return w}(),S=function(){function w(f,m){this.key=f;this.obj=m;this.type=e.BooleanType}w.parse=function(f,m){let C;switch(f.length){case 2:return C=c(f[1],m),new w(C);case 3:return C=c(f[1],m),f=c(f[2],m),new w(C,f);default:throw Error('"has" expects 1 or 2 arguments');}};w.prototype.evaluate=function(f,m){const C=this.key.evaluate(f,m);return this.obj?(f=this.obj.evaluate(f,m),C in f):!(null==f||!f.values[C])};return w}(),U=function(){function w(f,m){this.key=f;
this.vals=m;this.type=e.BooleanType}w.parse=function(f,m){if(3!==f.length)throw Error('"in" expects 2 arguments');return new w(c(f[1],m),c(f[2],m))};w.prototype.evaluate=function(f,m){const C=this.key.evaluate(f,m);return-1!==this.vals.evaluate(f,m).indexOf(C)};return w}(),W=function(){function w(f,m,C){this.item=f;this.array=m;this.from=C;this.type=e.NumberType}w.parse=function(f,m){if(3>f.length||4<f.length)throw Error('"index-of" expects 3 or 4 arguments');const C=c(f[1],m),E=c(f[2],m);return 4===
f.length?(f=c(f[3],m,e.NumberType),new w(C,E,f)):new w(C,E)};w.prototype.evaluate=function(f,m){const C=this.item.evaluate(f,m),E=this.array.evaluate(f,m);if(this.from){f=this.from.evaluate(f,m);if(f!==Math.floor(f))throw Error('"index-of" index must be an integer');return E.indexOf(C,f)}return E.indexOf(C)};return w}(),aa=function(){function w(f){this.arg=f;this.type=e.NumberType}w.parse=function(f,m){if(2!==f.length)throw Error('"length" expects 2 arguments');f=c(f[1],m);return new w(f)};w.prototype.evaluate=
function(f,m){f=this.arg.evaluate(f,m);if("string"===typeof f||Array.isArray(f))return f.length;throw Error('"length" expects string or array');};return w}(),Z=function(){function w(f,m,C,E){this.type=f;this.array=m;this.from=C;this.to=E}w.parse=function(f,m){if(3>f.length||4<f.length)throw Error('"slice" expects 2 or 3 arguments');const C=c(f[1],m),E=c(f[2],m,e.NumberType);if(E.type!==e.NumberType)throw Error('"slice" index must return a number');if(4===f.length){f=c(f[3],m,e.NumberType);if(f.type!==
e.NumberType)throw Error('"slice" index must return a number');return new w(C.type,C,E,f)}return new w(C.type,C,E)};w.prototype.evaluate=function(f,m){const C=this.array.evaluate(f,m);if(!Array.isArray(C)&&"string"!==typeof C)throw Error('"slice" input must be an array or a string');const E=this.from.evaluate(f,m);if(0>E||E>=C.length)throw Error('"slice" index out of bounds');if(E!==Math.floor(E))throw Error('"slice" index must be an integer');if(this.to){f=this.to.evaluate(f,m);if(0>f||f>=C.length)throw Error('"slice" index out of bounds');
if(f!==Math.floor(f))throw Error('"slice" index must be an integer');return C.slice(E,f)}return C.slice(E)};return w}(),ba=function(){function w(){this.type=e.BooleanType}w.parse=function(f){if(1!==f.length)throw Error('"has-id" expects no arguments');return new w};w.prototype.evaluate=function(f,m){return f&&void 0!==f.id};return w}(),ca=function(){function w(f,m){this.args=f;this.calculate=m;this.type=e.NumberType}w.parse=function(f,m,C){f=f.slice(1).map(E=>c(E,m));return new w(f,C)};w.prototype.evaluate=
function(f,m){let C;this.args&&(C=this.args.map(E=>E.evaluate(f,m)));return this.calculate(C)};return w}(),ka=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){switch(m.length){case 2:return ca.parse(m,C,E=>-E[0]);case 3:return ca.parse(m,C,E=>E[0]-E[1]);default:throw Error('"-" expects 1 or 2 arguments');}};return f}(ca),la=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){return ca.parse(m,
C,E=>{let N=1;for(const R of E)N*=R;return N})};return f}(ca),ma=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){if(3===m.length)return ca.parse(m,C,E=>E[0]/E[1]);throw Error('"/" expects 2 arguments');};return f}(ca),na=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){if(3===m.length)return ca.parse(m,C,E=>E[0]%E[1]);throw Error('"%" expects 2 arguments');};return f}(ca),oa=function(w){function f(){return w.apply(this,
arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){if(3===m.length)return ca.parse(m,C,E=>E[0]**E[1]);throw Error('"^" expects 1 or 2 arguments');};return f}(ca),pa=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(m,C){return ca.parse(m,C,E=>{let N=0;for(const R of E)N+=R;return N})};return f}(ca),X=function(){function w(f,m){this.args=f;this.calculate=m;this.type=e.NumberType}w.parse=function(f,m){const C=f.slice(1).map(E=>c(E,m));return new w(C,
w.ops[f[0]])};w.prototype.evaluate=function(f,m){let C;this.args&&(C=this.args.map(E=>E.evaluate(f,m)));return this.calculate(C)};return w}();X.ops={abs:w=>Math.abs(w[0]),acos:w=>Math.acos(w[0]),asin:w=>Math.asin(w[0]),atan:w=>Math.atan(w[0]),ceil:w=>Math.ceil(w[0]),cos:w=>Math.cos(w[0]),e:()=>Math.E,floor:w=>Math.floor(w[0]),ln:w=>Math.log(w[0]),ln2:()=>Math.LN2,log10:w=>Math.log(w[0])/Math.LN10,log2:w=>Math.log(w[0])/Math.LN2,max:w=>Math.max(...w),min:w=>Math.min(...w),pi:()=>Math.PI,round:w=>Math.round(w[0]),
sin:w=>Math.sin(w[0]),sqrt:w=>Math.sqrt(w[0]),tan:w=>Math.tan(w[0])};let qa=function(){function w(f){this.args=f;this.type=e.StringType}w.parse=function(f,m){return new w(f.slice(1).map(C=>c(C,m)))};w.prototype.evaluate=function(f,m){return this.args.map(C=>C.evaluate(f,m)).join("")};return w}(),ha=function(){function w(f,m){this.arg=f;this.calculate=m;this.type=e.StringType}w.parse=function(f,m){if(2!==f.length)throw Error(`${f[0]} expects 1 argument`);m=c(f[1],m);return new w(m,w.ops[f[0]])};w.prototype.evaluate=
function(f,m){return this.calculate(this.arg.evaluate(f,m))};return w}();ha.ops={downcase:w=>w.toLowerCase(),upcase:w=>w.toUpperCase()};let ra=function(){function w(m){this.args=m;this.type=e.ColorType}w.parse=function(m,C){if(4!==m.length)throw Error('"rgb" expects 3 arguments');m=m.slice(1).map(E=>c(E,C));return new w(m)};var f=w.prototype;f.evaluate=function(m,C){const E=this._validate(this.args[0].evaluate(m,C)),N=this._validate(this.args[1].evaluate(m,C));m=this._validate(this.args[2].evaluate(m,
C));return new y({r:E,g:N,b:m})};f._validate=function(m){if("number"!==typeof m||0>m||255<m)throw Error(`${m}: invalid color component`);return Math.round(m)};return w}(),sa=function(){function w(m){this.args=m;this.type=e.ColorType}w.parse=function(m,C){if(5!==m.length)throw Error('"rgba" expects 4 arguments');m=m.slice(1).map(E=>c(E,C));return new w(m)};var f=w.prototype;f.evaluate=function(m,C){const E=this._validate(this.args[0].evaluate(m,C)),N=this._validate(this.args[1].evaluate(m,C)),R=this._validate(this.args[2].evaluate(m,
C));m=this._validateAlpha(this.args[3].evaluate(m,C));return new y({r:E,g:N,b:R,a:m})};f._validate=function(m){if("number"!==typeof m||0>m||255<m)throw Error(`${m}: invalid color component`);return Math.round(m)};f._validateAlpha=function(m){if("number"!==typeof m||0>m||1<m)throw Error(`${m}: invalid alpha color component`);return m};return w}(),ta=function(){function w(f){this.color=f;this.type=e.arrayType(e.NumberType,4)}w.parse=function(f,m){if(2!==f.length)throw Error('"to-rgba" expects 1 argument');
f=c(f[1],m);return new w(f)};w.prototype.evaluate=function(f,m){return(new y(this.color.evaluate(f,m))).toRgba()};return w}(),fa=function(){function w(f,m){this.type=f;this.args=m}w.parse=function(f,m){var C=f[0];if(2>f.length)throw Error(`${C} expects at least one argument`);let E=1,N;if("array"===C){if(2<f.length){switch(f[1]){case "string":N=e.StringType;break;case "number":N=e.NumberType;break;case "boolean":N=e.BooleanType;break;default:throw Error('"array" type argument must be string, number or boolean');
}E++}else N=e.ValueType;if(3<f.length){var R=f[2];if(null!==R&&("number"!==typeof R||0>R||R!==Math.floor(R)))throw Error('"array" length argument must be a positive integer literal');E++}N=e.arrayType(N,R)}else switch(C){case "string":N=e.StringType;break;case "number":N=e.NumberType;break;case "boolean":N=e.BooleanType;break;case "object":N=e.ObjectType}for(C=[];E<f.length;E++)R=c(f[E],m),C.push(R);return new w(N,C)};w.prototype.evaluate=function(f,m){let C;for(const E of this.args){const N=E.evaluate(f,
m);C=e.getType(N);if(e.matchType(C,this.type))return N}throw Error(`Expected ${e.typeToString(this.type)} but got ${e.typeToString(C)}`);};return w}(),da=function(){function w(f,m){this.type=f;this.args=m}w.parse=function(f,m){var C=f[0];const E=w.types[C];if(E===e.BooleanType||E===e.StringType){if(2!==f.length)throw Error(`${C} expects one argument`);}else if(2>f.length)throw Error(`${C} expects at least one argument`);C=[];for(let N=1;N<f.length;N++){const R=c(f[N],m);C.push(R)}return new w(E,C)};
w.prototype.evaluate=function(f,m){if(this.type===e.BooleanType)return!!this.args[0].evaluate(f,m);if(this.type===e.StringType)return e.valueToString(this.args[0].evaluate(f,m));if(this.type===e.NumberType){for(const E of this.args){var C=Number(E.evaluate(f,m));if(!isNaN(C))return C}return null}if(this.type===e.ColorType){for(C of this.args)try{const E=w.toColor(C.evaluate(f,m));if(E instanceof y)return E}catch{}return null}};w.toBoolean=function(f){return!!f};w.toString=function(f){return e.valueToString(f)};
w.toNumber=function(f){const m=Number(f);if(isNaN(m))throw Error(`"${f}" is not a number`);return m};w.toColor=function(f){if(f instanceof y)return f;if("string"===typeof f){const m=y.fromString(f);if(m)return m;throw Error(`"${f}" is not a color`);}if(Array.isArray(f))return y.fromArray(f);throw Error(`"${f}" is not a color`);};return w}();da.types={"to-boolean":e.BooleanType,"to-color":e.ColorType,"to-number":e.NumberType,"to-string":e.StringType};let ua=function(){function w(f){this.val=f;this.type=
e.getType(f)}w.parse=function(f){if(2!==f.length)throw Error('"literal" expects 1 argument');return new w(f[1])};w.prototype.evaluate=function(f,m){return this.val};return w}(),va=function(){function w(f){this.arg=f;this.type=e.StringType}w.parse=function(f,m){if(2!==f.length)throw Error('"typeof" expects 1 argument');return new w(c(f[1],m))};w.prototype.evaluate=function(f,m){return e.typeToString(e.getType(this.arg.evaluate(f,m)))};return w}();const ia={array:fa,"boolean":fa,collator:null,format:null,
image:null,literal:ua,number:fa,"number-format":null,object:fa,string:fa,"to-boolean":da,"to-color":da,"to-number":da,"to-string":da,"typeof":va,accumulated:null,"feature-state":null,"geometry-type":b,id:a,"line-progress":null,properties:l,at:M,get:K,has:S,"in":U,"index-of":W,length:aa,slice:Z,"!":z,"!\x3d":p,"\x3c":g,"\x3c\x3d":n,"\x3d\x3d":h,"\x3e":x,"\x3e\x3d":D,all:q,any:B,"case":I,coalesce:G,match:J,within:null,interpolate:O,"interpolate-hcl":O,"interpolate-lab":O,step:P,let:Q,"var":L,concat:qa,
downcase:ha,"is-supported-script":null,"resolved-locale":null,upcase:ha,rgb:ra,rgba:sa,"to-rgba":ta,"-":ka,"*":la,"/":ma,"%":na,"^":oa,"+":pa,abs:X,acos:X,asin:X,atan:X,ceil:X,cos:X,e:X,floor:X,ln:X,ln2:X,log10:X,log2:X,max:X,min:X,pi:X,round:X,sin:X,sqrt:X,tan:X,zoom:v,"heatmap-density":null,"has-id":ba,none:H};A.ALL=q;A.ANY=B;A.Add=pa;A.Assert=fa;A.At=M;A.Calculate=X;A.Case=I;A.Coalesce=G;A.Coerce=da;A.Concat=qa;A.Div=ma;A.EQ=h;A.GE=D;A.GT=x;A.GeomType=b;A.Get=K;A.Has=S;A.HasID=ba;A.ID=a;A.In=U;
A.IndexOf=W;A.Interpolate=O;A.LE=n;A.LT=g;A.Length=aa;A.Let=Q;A.Literal=ua;A.Match=J;A.Mod=na;A.Mul=la;A.NE=p;A.NONE=H;A.NOT=z;A.Pow=oa;A.Properties=l;A.Rgb=ra;A.Rgba=sa;A.Slice=Z;A.Step=P;A.String=ha;A.Sub=ka;A.ToRgba=ta;A.TypeOf=va;A.Var=L;A.Zoom=v;A.createExpression=c;A.ops=ia;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/core/colorUtils":function(){define(["exports"],function(A){function F(a,b){const l=[];let v,u;if(a[0].length!==b.length)throw"dimensions do not match";const h=a.length,
p=a[0].length;let g=0;for(v=0;v<h;v++){for(u=g=0;u<p;u++)g+=a[v][u]*b[u];l.push(g)}return l}function y(a){a=[a.r/255,a.g/255,a.b/255].map(b=>.04045>=b?b/12.92:((b+.055)/1.055)**2.4);a=F(c,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}}function k(a){a=F(d,[a.x/100,a.y/100,a.z/100]).map(b=>Math.min(1,Math.max(.0031308>=b?12.92*b:1.055*b**(1/2.4)-.055,0)));return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function r(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(b=>b>(6/29)**3?b**
(1/3):1/3*(29/6)**2*b+4/29);return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function t(a){const b=a.l;a=[(b+16)/116+a.a/500,(b+16)/116,(b+16)/116-a.b/200].map(l=>l>6/29?l**3:3*(6/29)**2*(l-4/29));return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function e(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var b=a.c;var l=a.h;b={l:a.l,a:b*Math.cos(l),b:b*Math.sin(l)};return k(t(b))}if("l"in a&&"a"in a&&"b"in a)return k(t(a));if("x"in a&&"y"in a&&"z"in a)return k(a);if("h"in
a&&"s"in a&&"v"in a){{l=(a.h+360)%360/60;b=a.v/100*255;a=a.s/100*b;const v=a*(1-Math.abs(l%2-1));switch(Math.floor(l)){case 0:l={r:a,g:v,b:0};break;case 1:l={r:v,g:a,b:0};break;case 2:l={r:0,g:a,b:v};break;case 3:l={r:0,g:v,b:a};break;case 4:l={r:v,g:0,b:a};break;case 5:case 6:l={r:a,g:0,b:v};break;default:l={r:0,g:0,b:0}}l.r=Math.round(l.r+b-a);l.g=Math.round(l.g+b-a);l.b=Math.round(l.b+b-a);b=l}return b}return a}const c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],d=[[3.2406,-1.5372,
-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];A.darken=function(a,b){a=r(y(a));a.l*=1-b;return k(t(a))};A.toHSV=function(a){if("h"in a&&"s"in a&&"v"in a)return a;var b=e(a);{a=b.r;const l=b.g,v=b.b;b=Math.max(a,l,v);const u=b-Math.min(a,l,v);a=0===u?0:b===a?(l-v)/u%6:b===l?(v-a)/u+2:(a-l)/u+4;0>a&&(a+=6);a={h:60*a,s:100*(0===u?0:u/b),v:100/255*b}}return a};A.toLAB=function(a){return"l"in a&&"a"in a&&"b"in a?a:r(y(e(a)))};A.toLCH=function(a){if(!("l"in a&&"c"in a&&"h"in a)){{var b=r(y(e(a)));
a=b.l;var l=b.a;const v=b.b;b=Math.sqrt(l*l+v*v);l=Math.atan2(v,l);l=0<l?l:l+2*Math.PI;a={l:a,c:b,h:l}}}return a};A.toRGB=e;A.toXYZ=function(a){return"x"in a&&"y"in a&&"z"in a?a:y(e(a))};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports"],function(A){function F(c,d){c%=d;return 0<=c?c:c+d}const y=Number.POSITIVE_INFINITY,k=Math.PI,r=128/k,t=256/360,e=1/Math.LN2;A.C_256_TO_RAD=k/128;A.C_2PI=2*k;A.C_DEG_TO_256=t;A.C_DEG_TO_RAD=
k/180;A.C_INFINITY=y;A.C_PI=k;A.C_PI_BY_2=k/2;A.C_RAD_TO_256=r;A.C_SQRT2=1.414213562;A.C_SQRT2_INV=1/1.414213562;A.between=function(c,d,a){return c>=d&&c<=a||c>=a&&c<=d};A.degToByte=function(c){return F(c*t,256)};A.interpolate=function(c,d,a){return c*(1-a)+d*a};A.log2=function(c){return Math.log(c)*e};A.positiveMod=F;A.radToByte=function(c){return F(c*r,256)};A.sqr=function(c){return c*c};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports",
"../../../../../Color"],function(A,F){function y(h,p){return{kind:"array",itemType:h,n:p}}function k(h){if("array"===h.kind){const p=k(h.itemType);return"number"===typeof h.n?`array<${p}, ${h.n}>`:"value"===h.itemType.kind?"array":`array<${p}>`}return h.kind}function r(h){if(null===h)return e;if("string"===typeof h)return d;if("boolean"===typeof h)return a;if("number"===typeof h)return c;if(h instanceof F)return b;if(Array.isArray(h)){let p;for(const g of h){const n=r(g);if(!p)p=n;else if(p!==n){p=
v;break}}return y(p||v,h.length)}return"object"===typeof h?l:v}function t(h,p){if("array"===p.kind)return"array"===h.kind&&(0===h.n&&"value"===h.itemType.kind||t(h.itemType,p.itemType))&&("number"!==typeof p.n||p.n===h.n);if("value"===p.kind)for(const g of u)if(t(h,g))return!0;return p.kind===h.kind}const e={kind:"null"},c={kind:"number"},d={kind:"string"},a={kind:"boolean"},b={kind:"color"},l={kind:"object"},v={kind:"value"},u=[e,c,d,a,b,l,y(v)];A.BooleanType=a;A.ColorType=b;A.NullType=e;A.NumberType=
c;A.ObjectType=l;A.StringType=d;A.ValueType=v;A.arrayType=y;A.getType=r;A.matchType=t;A.typeToString=k;A.valueToString=function(h){if(null===h)return"";const p=typeof h;return"string"===p?h:"number"===p||"boolean"===p?String(h):h instanceof F?h.toString():JSON.stringify(h)};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports"],function(A){let F=function(){};F.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:0}};F.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};F.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};F.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},
"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",
default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),
default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,
default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],
default:[0]}};F.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};F.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};F.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,
0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};F.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,
default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}};F.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,
maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",
values:["map","viewport"],default:0}};F.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};
F.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",
values:["map","viewport"],default:0}};A.StyleDefinition=F;Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(A,F,y,k){return function(){function r(e,c){this.isDataDriven=!1;this.interpolator=null;switch(e.type){case "number":var d=!0;break;case "color":d=!0;break;case "array":d="number"===e.value;break;default:d=!1}null==c&&
(c=e.default);if(Array.isArray(c)&&0<c.length&&y.ops[c[0]]){d={number:k.NumberType,color:k.ColorType,string:k.StringType,boolean:k.BooleanType,enum:k.StringType};try{var a="array"===e.type?k.arrayType(d[e.value]||k.ValueType,e.length):d[e.type];const b=y.createExpression(c,null,a);this.getValue=this._buildExpression(b,e);this.isDataDriven=!0;b instanceof y.Interpolate&&b.input instanceof y.Zoom&&(this.interpolator=b)}catch(b){console.log(b.message),this.getValue=this._buildSimple(e.default)}}else{d&&
"interval"===c.type&&(d=!1);if(a=c&&c.stops&&0<c.stops.length)for(const b of c.stops)b[1]=this._validate(b[1],e);if(this.isDataDriven=c?!!c.property:!1)if(void 0!==c.default&&(c.default=this._validate(c.default,e)),a)switch(c.type){case "identity":this.getValue=this._buildIdentity(c,e);break;case "categorical":this.getValue=this._buildCategorical(c,e);break;default:this.getValue=d?this._buildInterpolate(c,e):this._buildInterval(c,e)}else this.getValue=this._buildIdentity(c,e);else a?this.getValue=
d?this._buildZoomInterpolate(c):this._buildZoomInterval(c):(c=this._validate(c,e),this.getValue=this._buildSimple(c))}}var t=r.prototype;t._validate=function(e,c){if("number"===c.type){if(e<c.minimum)return c.minimum;if(e>c.maximum)return c.maximum}else"color"===c.type?e=r._parseColor(e):"enum"===c.type?"string"===typeof e&&(e=c.values.indexOf(e)):"array"===c.type&&"enum"===c.value?e=e.map(d=>"string"===typeof e?c.values.indexOf(d):d):"string"===c.type&&(e=k.valueToString(e));return e};t._buildSimple=
function(e){return()=>e};t._buildExpression=function(e,c){return(d,a)=>{try{const b=e.evaluate(a,d);return void 0===b?c.default:this._validate(b,c)}catch(b){return console.log(b.message),c.default}}};t._buildIdentity=function(e,c){return(d,a)=>{let b;a&&(b=a.values[e.property]);return void 0!==b?this._validate(b,c):void 0!==e.default?e.default:c.default}};t._buildCategorical=function(e,c){return(d,a)=>{let b;a&&(b=a.values[e.property]);b=this._categorical(b,e.stops);return void 0!==b?b:void 0!==e.default?
e.default:c.default}};t._buildInterval=function(e,c){return(d,a)=>{let b;a&&(b=a.values[e.property]);return"number"===typeof b?this._interval(b,e.stops):void 0!==e.default?e.default:c.default}};t._buildInterpolate=function(e,c){return(d,a)=>{let b;a&&(b=a.values[e.property]);return"number"===typeof b?this._interpolate(b,e.stops,e.base||1):void 0!==e.default?e.default:c.default}};t._buildZoomInterpolate=function(e){return c=>this._interpolate(c,e.stops,e.base||1)};t._buildZoomInterval=function(e){return c=>
this._interval(c,e.stops)};t._categorical=function(e,c){const d=c.length;for(let a=0;a<d;a++)if(c[a][0]===e)return c[a][1]};t._interval=function(e,c){const d=c.length;let a=0;for(let b=0;b<d;b++)if(c[b][0]<=e)a=b;else break;return c[a][1]};t._interpolate=function(e,c,d){const a=c.length;for(let v=0;v<a;v++){const u=c[v];if(u[0]<=e)var b=u;else{var l=u;break}}if(b&&l){c=l[0]-b[0];e-=b[0];d=1===d?e/c:(d**e-1)/(d**c-1);if(Array.isArray(b[1])){b=b[1];l=l[1];e=[];for(c=0;c<b.length;c++)e.push(F.interpolate(b[c],
l[c],d));return e}return F.interpolate(b[1],l[1],d)}if(b)return b[1];if(l)return l[1]};r._isEmpty=function(e){for(const c in e)if(e.hasOwnProperty(c))return!1;return!0};r._parseColor=function(e){if(Array.isArray(e))return e;"string"===typeof e&&(e=new A(e));if(e instanceof A){if(!this._isEmpty(e))return A.toUnitRGBA(e)}else return e};return r}()})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(A,F,y,k,r,t,e,c,d,a,b,l,v,u,h,p,g){const n=k.ofType({key:"type",base:u,typeMap:{rect:h,path:g,geometry:p}});A.LayerView2DMixin=x=>{x=function(D){function z(){var B=D.apply(this,arguments)||this;B.clips=new n;B.moving=!1;B.attached=!1;B.lastUpdateId=-1;B.updateRequested=!1;return B}F._inheritsLoose(z,D);var q=z.prototype;q.initialize=function(){var B;this.container||(this.container=new v.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;
this.handles.add([t.init(this,"suspended",H=>{this.container&&(this.container.visible=!H);this.view&&!H&&this.updateRequested&&this.view.requestUpdate()},!0),t.init(this,["layer.opacity","container"],()=>{if(this.container){var H,I;this.container.opacity=null!=(H=null==(I=this.layer)?void 0:I.opacity)?H:1}},!0),t.init(this,["layer.blendMode"],H=>{this.container&&(this.container.blendMode=H)},!0),t.init(this,["layer.effect"],H=>{this.container&&(this.container.effect=H)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(B=this.view)&&B.whenLayerView?this.view.whenLayerView(this.layer).then(H=>{H!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};q.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};q.isVisibleAtScale=
function(B){var H=!0,I=this.layer;const G=I.minScale;I=I.maxScale;if(null!=G&&null!=I){H=!G;let J=!I;!H&&B<=G&&(H=!0);!J&&B>=I&&(J=!0);H=H&&J}return H};q.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};q.processUpdate=function(B){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",B),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(B)))};q.isUpdating=
function(){return!1};q.isRendering=function(){return!1};q.canResume=function(){return D.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};F._createClass(z,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return z}(x);y.__decorate([e.property({type:n,set(D){D=r.referenceSetter(D,this._get("clips"),n);this._set("clips",D)}})],x.prototype,"clips",void 0);y.__decorate([e.property()],x.prototype,"moving",void 0);
y.__decorate([e.property()],x.prototype,"attached",void 0);y.__decorate([e.property()],x.prototype,"container",void 0);y.__decorate([e.property()],x.prototype,"suspended",void 0);y.__decorate([e.property({readOnly:!0})],x.prototype,"updateParameters",void 0);y.__decorate([e.property()],x.prototype,"updateRequested",void 0);y.__decorate([e.property()],x.prototype,"updating",null);y.__decorate([e.property()],x.prototype,"view",void 0);return x=y.__decorate([l.subclass("esri.views.2d.layers.LayerView2D")],
x)};Object.defineProperty(A,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),function(A,F,y,k,r,t,e,c,d){y=function(a){function b(){return a.apply(this,arguments)||
this}A._inheritsLoose(b,a);return b}(y.JSONSupport);return y=F.__decorate([d.subclass("esri.views.layers.support.ClipArea")],y)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(A,F,y,k,r,t,
e,c,d){var a;k=a=function(b){function l(){var v=b.apply(this,arguments)||this;v.type="rect";v.left=null;v.right=null;v.top=null;v.bottom=null;return v}A._inheritsLoose(l,b);l.prototype.clone=function(){return new a({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};A._createClass(l,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return l}(d);F.__decorate([y.property({type:[Number,String],json:{write:!0}})],k.prototype,"left",void 0);F.__decorate([y.property({type:[Number,
String],json:{write:!0}})],k.prototype,"right",void 0);F.__decorate([y.property({type:[Number,String],json:{write:!0}})],k.prototype,"top",void 0);F.__decorate([y.property({type:[Number,String],json:{write:!0}})],k.prototype,"bottom",void 0);F.__decorate([y.property({readOnly:!0})],k.prototype,"version",null);return k=a=F.__decorate([c.subclass("esri.views.layers.support.ClipRect")],k)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(A,F,y,k,r,t,e,c,d,a,b,l,v,u){var h;y={base:a,key:"type",typeMap:{extent:v,polygon:u}};l=h=function(p){function g(){var n=p.apply(this,arguments)||this;n.type="geometry";n.geometry=null;return n}A._inheritsLoose(g,p);g.prototype.clone=function(){return new h({geometry:this.geometry.clone()})};A._createClass(g,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return g}(l);F.__decorate([k.property({types:y,json:{read:b.fromJSON,write:!0}})],l.prototype,"geometry",void 0);
F.__decorate([k.property({readOnly:!0})],l.prototype,"version",null);return l=h=F.__decorate([d.subclass("esri.views.layers.support.Geometry")],l)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(A,
F,y,k,r,t,e,c,d){k=function(a){function b(){var l=a.apply(this,arguments)||this;l.type="path";l.path=[];return l}A._inheritsLoose(b,a);A._createClass(b,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return b}(d);F.__decorate([y.property({type:[[[Number]]],json:{write:!0}})],k.prototype,"path",void 0);F.__decorate([y.property({readOnly:!0})],k.prototype,"version",null);return k=F.__decorate([c.subclass("esri.views.layers.support.Path")],k)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../chunks/_rollupPluginBabelHelpers",
"../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(A,F,y,k){return function(r){function t(){var c=r.apply(this,arguments)||this;c._fullCacheLodInfos=null;c._levelByScale={};return c}A._inheritsLoose(t,r);var e=t.prototype;e.getTileParentId=function(c){c=k.pool.acquire(c);const d=0===c.level?null:k.getId(c.level-1,c.row>>1,c.col>>1,c.world);k.pool.release(c);return d};e.getTileCoverage=function(c,d,a){c=r.prototype.getTileCoverage.call(this,c,d,a);if(!c)return c;const b=1<<c.lodInfo.level;
c.spans=c.spans.filter(l=>0<=l.row&&l.row<b);return c};e.scaleToLevel=function(c){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[c])return this._levelByScale[c];{var d=this._fullCacheLodInfos;if(c>d[0].scale)return d[0].level;let a;for(let b=0;b<d.length-1;b++)if(a=d[b+1],c>a.scale)return d=d[b],d.level+(d.scale-c)/(d.scale-a.scale);return d[d.length-1].level}};e._initializeFullCacheLODs=function(c){c=0===c[0].level?c.map(d=>({level:d.level,resolution:d.resolution,
scale:d.scale})):F.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(d=>({level:d.level,resolution:d.resolution,scale:d.scale}));for(let d=0;d<c.length;d++)this._levelByScale[c[d].scale]=c[d].level;this._fullCacheLodInfos=c};return t}(y)})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/support/aaBoundingRect ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/style/StyleRepository ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(A,
F,y,k,r,t,e,c,d,a,b,l,v,u,h,p,g,n,x,D,z,q,B,H,I){function G(O){if(c.isNone(O))return 0;switch(O.type){case "partial":return Object.keys(O.diff).length;case "complete":return Math.max(Object.keys(O.oldValue).length,Object.keys(O.newValue).length);case "collection":return Object.keys(O.added).length+Object.keys(O.changed).length+Object.keys(O.removed).length}}const J=e.getLogger("esri.views.2d.layers.VectorTileLayerView2D");e=function(O){function P(){var L=O.apply(this,arguments)||this;L._styleChanges=
[];L._handles=new r;L._fetchQueue=null;L._parseQueue=null;L._isTileHandlerReady=!1;L.fading=!1;return L}A._inheritsLoose(P,O);var Q=P.prototype;Q.initialize=function(){const L=this.layer.tileInfo;if((L&&L.spatialReference).equals(this.view.spatialReference)){var {style:M,spriteUrl:K,glyphsUrl:S}=this.layer.currentStyleInfo;this._styleRepository=new z(M,{spriteUrl:K,glyphsUrl:S});this._tileInfoView=new B(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new D.VectorTileContainer(this._tileInfoView);
this._tileHandler=new g.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1);this.container.addChild(this._vectorTileContainer);this.handles.add([this._vectorTileContainer.on("fade-start",()=>{this.fading=!0;this.notifyChange("updating");this.requestUpdate()}),this._vectorTileContainer.on("fade-complete",()=>{this.fading=!1;this.notifyChange("updating");this.requestUpdate()})])}else this.addResolvingPromise(Promise.reject(new k("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",
{layer:this.layer})))};Q.destroy=function(){var L;this._stop();this.container.removeAllChildren();this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null);null==(L=this._tileHandler)?void 0:L.destroy();this._tileHandler=null};Q.hitTest=function(){var L=A._asyncToGenerator(function*(M,K){if(this.suspended||!this._tileHandlerPromise)return null;yield this._tileHandlerPromise;M=yield this._vectorTileContainer.hitTest(M,K);if(!M||0===M.length)return null;M=M[0]-
1;var S=this._styleRepository;K=S.getStyleLayerByUID(M);if(!K)return null;S=S.getStyleLayerIndex(K.id);M=new y({attributes:{layerId:S,layerName:K.id,layerUID:M}});M.layer=this.layer;M.sourceLayer=this.layer;return M});return function(M,K){return L.apply(this,arguments)}}();Q.update=function(L){this._tileHandlerPromise&&this._isTileHandlerReady&&(L.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=L.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=
this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=L.state,this._parseQueue.state=L.state,this._tileManager.update(L)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))};Q.attach=function(){this._start();this._handles.add([this.layer.on("paint-change",L=>{if(L.isDataDriven)this._styleChanges.push({type:0,data:L}),this.notifyChange("updating"),this.requestUpdate();else{const K=this._styleRepository;var M=K.getLayerById(L.layer);
M&&(M=3===M.type,K.setPaintProperties(L.layer,L.paint),M&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())}}),this.layer.on("layout-change",L=>{const M=this._styleRepository,K=M.getLayerById(L.layer);if(K){var S=h.diff(K.layout,L.layout);c.isNone(S)||(h.hasDiff(S,"visibility")&&1===G(S)?(M.setLayoutProperties(L.layer,L.layout),3===K.type&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender()):(this._styleChanges.push({type:1,
data:L}),this.notifyChange("updating"),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",L=>{const M=this._styleRepository,K=M.getLayerById(L.layer);K&&(M.setStyleLayerVisibility(L.layer,L.visibility),3===K.type&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())}),this.layer.on("style-layer-change",L=>{this._styleChanges.push({type:2,data:L});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("delete-style-layer",L=>{this._styleChanges.push({type:3,
data:L});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle())])};Q.detach=function(){this._stop();this._handles.removeAll()};Q.moveStart=function(){this.requestUpdate()};Q.viewChange=function(){this.requestUpdate()};Q.moveEnd=function(){this.requestUpdate()};Q.canResume=function(){let L=O.prototype.canResume.call(this);var M=this.layer;if(L&&M.currentStyleInfo){const K=this.view.scale;(M=M.currentStyleInfo)&&M.layerDefinition&&(M=M.layerDefinition,
M.minScale&&M.minScale<K&&(L=!1),M.maxScale&&M.maxScale>K&&(L=!1))}return L};Q.isUpdating=function(){const L=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||0<L.length&&0<L.filter(M=>M.invalidating).length||this.fading};Q.acquireTile=function(L){const M=this._createVectorTile(L);this._tileHandlerPromise.then(()=>{this._fetchQueue.push(M.key).then(K=>this._parseQueue.push({key:M.key,data:K})).then(K=>
{M.once("attach",()=>this.requestUpdate());K&&(M.setData(K.tileData),this.requestUpdate(),this.notifyChange("updating"))}).catch(K=>{this.notifyChange("updating");d.isAbortError(K)||J.error(K)})});return M};Q.releaseTile=function(L){L=L.key.id;this._fetchQueue.abort(L);this._parseQueue.abort(L);this.requestUpdate()};Q._start=function(){this._stop();this._tileManager=new n.TileManager({acquireTile:K=>this.acquireTile(K),releaseTile:K=>this.releaseTile(K),tileInfoView:this._tileInfoView},this._vectorTileContainer);
if(this.layer.currentStyleInfo){var L=new AbortController,M=this._tileHandler.start({signal:L.signal}).then(()=>{this._fetchQueue=new H({tileInfoView:this._tileInfoView,process:(K,S)=>this._getTileData(K,S),concurrency:15});this._parseQueue=new H({tileInfoView:this._tileInfoView,process:(K,S)=>this._parseTileData(K,S),concurrency:8});this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(K=>{this._vectorTileContainer.setStyleResources(K,this._tileHandler.glyphMosaic,
this._styleRepository);this.requestUpdate()});this._tileHandlerAbortController=L;this._tileHandlerPromise=M}};Q._stop=function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var L=this._tileHandlerAbortController;L&&L.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileManager&&(this._tileManager.destroy(),this._tileManager=
null);this._vectorTileContainer.removeAllChildren()}};Q._getTileData=function(){var L=A._asyncToGenerator(function*(M,K){M=yield this._tileHandler.fetchTileData(M,K);this.notifyChange("updating");return M});return function(M,K){return L.apply(this,arguments)}}();Q._parseTileData=function(){var L=A._asyncToGenerator(function*(M,K){return this._tileHandler.parseTileData(M,K)});return function(M,K){return L.apply(this,arguments)}}();Q._applyStyleChanges=function(){var L=A._asyncToGenerator(function*(){this._isTileHandlerReady=
!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var M=this._styleChanges;try{yield this._tileHandler.updateStyle(M)}catch(Z){J.error("error applying vector-tiles style update",Z.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0}const K=this._styleRepository,S=[];M.forEach(Z=>{3===Z.type&&(Z=K.getLayerById(Z.data.layer))&&S.push(Z.uid)});const U=[];let W;M.forEach(Z=>{const ba=
Z.data;switch(Z.type){case 0:K.setPaintProperties(ba.layer,ba.paint);W=ba.layer;break;case 1:K.setLayoutProperties(ba.layer,ba.layout);W=ba.layer;break;case 3:K.deleteStyleLayer(ba.layer);return;case 2:K.setStyleLayer(ba.layer,ba.index),W=ba.layer.id}(Z=K.getLayerById(W))&&U.push(Z.uid)});M=this._vectorTileContainer.children;if(0<S.length){this._vectorTileContainer.deleteStyleLayers(S);for(var aa of M)aa.deleteLayerData(S)}this._fetchQueue.resume();this._parseQueue.resume();if(0<U.length){aa=[];for(const Z of M)M=
this._fetchQueue.push(Z.key).then(ba=>this._parseQueue.push({key:Z.key,data:ba,styleLayerUIDs:U})).then(ba=>Z.setData(ba.tileData)),aa.push(M);yield Promise.all(aa)}this._styleChanges=[];this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()});return function(){return L.apply(this,arguments)}}();Q._loadStyle=function(){var L=A._asyncToGenerator(function*(){const {style:M,spriteUrl:K,glyphsUrl:S}=this.layer.currentStyleInfo;var U=t.clone(M);this._isTileHandlerReady=!1;this._fetchQueue.pause();
this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this.notifyChange("updating");this._styleRepository=new z(U,{spriteUrl:K,glyphsUrl:S});this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=d.createAbortController();const {signal:W}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,U),yield this._tileHandlerPromise}catch(aa){if(!d.isAbortError(aa))throw aa;
}W.aborted||(U=yield this._tileHandler.spriteMosaic,this._vectorTileContainer.setStyleResources(U,this._tileHandler.glyphMosaic,this._styleRepository));this._fetchQueue.resume();this._parseQueue.resume();this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()});return function(){return L.apply(this,arguments)}}();Q._createVectorTile=function(L){const M=this._tileInfoView.getTileBounds(p.create(),L);return new x.VectorTile(L,this._styleRepository,M,[512,512])};return P}(q.LayerView2DMixin(I));
F.__decorate([a.property()],e.prototype,"_fetchQueue",void 0);F.__decorate([a.property()],e.prototype,"_parseQueue",void 0);F.__decorate([a.property()],e.prototype,"_isTileHandlerReady",void 0);F.__decorate([a.property()],e.prototype,"suspended",void 0);F.__decorate([a.property()],e.prototype,"fading",void 0);F.__decorate([a.property()],e.prototype,"updating",void 0);return e=F.__decorate([u.subclass("esri.views.2d.layers.VectorTileLayerView2D")],e)});