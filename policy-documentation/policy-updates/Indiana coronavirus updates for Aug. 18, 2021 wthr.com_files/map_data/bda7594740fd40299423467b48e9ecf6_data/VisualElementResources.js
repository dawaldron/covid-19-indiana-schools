// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/watchUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/WebGLLayer".split(" "),function(h,l,e,m,n,p){let r=function(){function f(a){this.resourceFactory=a;this._resources=null;this._visible=!0;this._attached=!1}var c=f.prototype;c.destroy=function(){this._destroyResources()};c.recreate=function(){this.attached&&this._createResources()};c.recreateGeometry=function(){if(this.resourceFactory.recreateGeometry){var a=
this.resourceFactory.view._stage;if(!e.isNone(this._resources)&&a){var b=this._resources.object;this._resources.external.forEach(d=>{2===d.type&&a.remove(d)});b.removeAllGeometries();b=this.resourceFactory.recreateGeometry(this._resources.external,b,this._resources.layer);a.addMany(b)}}else this.recreate()};c._createOrDestroyResources=function(){this._attached?this._resources||this._createResources():this._destroyResources()};c._createResources=function(){this._destroyResources();const a=this.resourceFactory.view._stage;
if(a){var b=new p.WebGLLayer({isPickable:!1,updatePolicy:1});a.add(b);var d=new n.Object3D({castShadow:!1}),k=this.resourceFactory.createResources(d,b);k.forEach(g=>a.add(g));a.add(d);b.add(d);this._syncVisible();var q=this.resourceFactory.cameraChanged?m.init(this.resourceFactory.view.state,"camera",g=>this.resourceFactory.cameraChanged(g)):null;this._resources={layer:b,object:d,external:k,cameraHandle:q}}};c._destroyResources=function(){if(!e.isNone(this._resources)){var a=this.resourceFactory.view._stage;
null==a?void 0:a.remove(this._resources.object);null==a?void 0:a.remove(this._resources.layer);this._resources.external.forEach(b=>{null==a?void 0:a.remove(b);"dispose"in b&&b.dispose()});this._resources.object.dispose();this._resources.cameraHandle&&this._resources.cameraHandle.remove();this._resources=null}};c._syncVisible=function(){e.isNone(this._resources)||this._resources.object.setVisible(this._visible)};l._createClass(f,[{key:"object",get:function(){return e.isSome(this._resources)?this._resources.object:
null}},{key:"resources",get:function(){return e.isSome(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this._syncVisible())}},{key:"attached",get:function(){return this._attached},set:function(a){a!==this._attached&&(this._attached=a,this._createOrDestroyResources())}}]);return f}();h.VisualElementResources=r;Object.defineProperty(h,"__esModule",{value:!0})});