// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ./ArcadePortal ./Attachment ./Dictionary ./Feature ./FunctionWrapper ./ImmutablePathArray ./ImmutablePointArray ../chunks/languageUtils ./treeAnalysis ./featureset/support/shared ./functions/array ./functions/date ./functions/geomasync ./functions/geometry ./functions/maths ./functions/stats ./functions/string ../core/promiseUtils ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../geometry/SpatialReference".split(" "),
function(w,da,ea,x,y,E,R,fa,g,p,ha,H,ia,ja,ka,la,ma,na,l,oa,S,pa,qa,ra,sa,ta){function q(b){return b instanceof Error?l.reject(b):l.reject(Error(b))}function T(b){return l.resolve(b)}function I(b,a){const c=[];for(let d=0;d<a.arguments.length;d++)c.push(n(b,a.arguments[d]));return l.all(c)}function v(b,a,c){return l.create((d,e)=>{I(b,a).then(f=>{try{d(c(b,a,f))}catch(h){e(h)}},e)})}function C(b,a,c){try{return I(b,a).then(d=>{try{const e=c(b,a,d);return e&&"function"===typeof e.then?e:l.resolve(e)}catch(e){return q(e)}})}catch(d){return q(d)}}
function n(b,a,c){try{if(a.breakpoint&&!0!==c)return a.breakpoint().then(()=>n(b,a,!0));switch(a.type){case "VariableDeclarator":return ua(b,a);case "VariableDeclaration":return U(b,a,0);case "BlockStatement":try{var d=V(b,a,0)}catch(e){d=q(e)}return d;case "FunctionDeclaration":return va(b,a);case "ReturnStatement":return wa(b,a);case "IfStatement":return xa(b,a);case "ExpressionStatement":return ya(b,a);case "UpdateExpression":return za(b,a);case "AssignmentExpression":return Aa(b,a);case "ForStatement":return Ba(b,
a);case "ForInStatement":return Ca(b,a);case "BreakStatement":return l.resolve(g.breakResult);case "EmptyStatement":return l.resolve(g.voidOperation);case "ContinueStatement":return l.resolve(g.continueResult);case "TemplateElement":return l.resolve(a.value?a.value.cooked:"");case "TemplateLiteral":return Da(b,a);case "Identifier":return J(b,a);case "MemberExpression":return Ea(b,a);case "Literal":return T(a.value);case "CallExpression":return Fa(b,a);case "UnaryExpression":return Ga(b,a);case "BinaryExpression":return Ha(b,
a);case "LogicalExpression":return Ia(b,a);case "ConditionalExpression":return q(p.nodeErrorMessage(a,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":return Ja(b,a);case "ObjectExpression":return Ka(b,a);case "Property":return La(b,a);default:return q(p.nodeErrorMessage(a,"RUNTIME","UNREOGNISED"))}}catch(e){return q(e)}}function Ka(b,a){try{const c=[];for(let d=0;d<a.properties.length;d++)c.push(n(b,a.properties[d]));return l.all(c).then(d=>l.create(e=>{var f={};for(let h=0;h<d.length;h++){const k=
d[h];if(g.isFunctionParameter(k.value))throw Error("Illegal Argument");if(!1===g.isString(k.key))throw Error("Illegal Argument");f[k.key.toString()]=k.value===g.voidOperation?null:k.value}f=new x(f);f.immutable=!1;e(f)}))}catch(c){return q(c)}}function La(b,a){try{return n(b,a.value).then(c=>l.create(d=>{"Identifier"===a.key.type?d({key:a.key.name,value:c}):n(b,a.key).then(e=>{d({key:e,value:c})})}))}catch(c){return l.reject(c)}}function W(b,a,c){try{return n(b,a.body).then(d=>{try{return c.lastAction=
d,c.lastAction===g.breakResult||c.lastAction instanceof g.ReturnResult?(c.testResult=!1,l.resolve(c)):null!==a.update?n(b,a.update).then(()=>l.resolve(c)):l.resolve(c)}catch(e){return l.reject(e)}})}catch(d){return l.reject(d)}}function Ma(b,a,c){try{return null!==a.test?n(b,a.test).then(d=>{try{if(!0===b.abortSignal.aborted)return l.reject(Error("Cancelled"));c.testResult=d;return!1===c.testResult?l.resolve(c):!0!==c.testResult?l.reject(Error(p.nodeErrorMessage(a,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):
W(b,a,c)}catch(e){return l.reject(e)}}):W(b,a,c)}catch(d){return l.reject(d)}}function F(b,a,c,d,e,f){try{Ma(b,a,c).then(()=>{try{!0===c.testResult?(f++,100<f?(f=0,setTimeout(()=>{F(b,a,c,d,e,f)},0)):F(b,a,c,d,e,f)):c.lastAction instanceof g.ReturnResult?d(c.lastAction):d(g.voidOperation)}catch(h){e(h)}},h=>{e(h)})}catch(h){e(h)}}function Ba(b,a){try{return null!==a.init?n(b,a.init).then(()=>l.create((c,d)=>{F(b,a,{testResult:!0,lastAction:g.voidOperation},e=>{c(e)},e=>{d(e)},0)})):l.create((c,d)=>
{F(b,a,{testResult:!0,lastAction:g.voidOperation},e=>{c(e)},e=>{d(e)},0)})}catch(c){return l.reject(c)}}function K(b,a,c,d,e,f,h,k,m,r){try{d<=f?k(g.voidOperation):(e.value="k"===h?c[f]:f,n(b,a.body).then(u=>{try{u instanceof g.ReturnResult?k(u):u===g.breakResult?k(g.voidOperation):(r++,100<r?(r=0,setTimeout(()=>{K(b,a,c,d,e,f+1,h,k,m,r)},0)):K(b,a,c,d,e,f+1,h,k,m,r))}catch(L){m(L)}},u=>{m(u)}))}catch(u){m(u)}}function M(b,a,c,d,e,f,h,k,m){try{c.length()<=e?h(g.voidOperation):(d.value="k"===f?c.get(e):
e,n(b,a.body).then(r=>{r instanceof g.ReturnResult?h(r):r===g.breakResult?h(g.voidOperation):(m++,100<m?(m=0,setTimeout(()=>{M(b,a,c,d,e+1,f,h,k,m)},0)):M(b,a,c,d,e+1,f,h,k,m))},r=>{k(r)}))}catch(r){k(r)}}function N(b,a,c,d,e,f){try{void 0===f&&(f="i"),0===c.length?d.resolve(g.voidOperation):K(b,a,c,c.length,e,0,f,h=>{d.resolve(h)},h=>{d.reject(h)},0)}catch(h){d.reject(h)}}function Na(b,a,c,d,e,f){try{void 0===f&&(f="i"),0===c.length?d.resolve(g.voidOperation):M(b,a,c,e,0,f,h=>{d.resolve(h)},h=>{d.reject(h)},
0)}catch(h){d.reject(h)}}function Oa(b,a,c,d,e){try{const f=c.keys();N(b,a,f,d,e,"k")}catch(f){d.reject(f)}}function O(b,a,c,d,e,f,h,k){try{b.next().then(m=>{try{if(null===m)f(g.voidOperation);else{const r=y.createFromGraphicLikeObject(m.geometry,m.attributes,d);r._underlyingGraphic=m;e.value=r;n(a,c.body).then(u=>{try{u===g.breakResult?f(g.voidOperation):u instanceof g.ReturnResult?f(u):(k++,100<k?(k=0,setTimeout(()=>{O(b,a,c,d,e,f,h,k)},0)):O(b,a,c,d,e,f,h,k))}catch(L){h(L)}},u=>{h(u)})}}catch(r){h(r)}},
m=>{h(m)})}catch(m){h(m)}}function Ca(b,a){return l.create((c,d)=>{n(b,a.right).then(e=>{try{let f=null;f="VariableDeclaration"===a.left.type?n(b,a.left):l.resolve();f.then(()=>{try{let k="";if("VariableDeclaration"===a.left.type){var h=a.left.declarations[0].id;"Identifier"===h.type&&(k=h.name)}else"Identifier"===a.left.type&&(k=a.left.name);if(!k)throw Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDVARIABLE"));k=k.toLowerCase();h=null;null!==b.localScope&&void 0!==b.localScope[k]&&(h=b.localScope[k]);
null===h&&void 0!==b.globalScope[k]&&(h=b.globalScope[k]);null===h?d(Error(p.nodeErrorMessage(a,"RUNTIME","VARIABLENOTDECLARED"))):g.isArray(e)||g.isString(e)?N(b,a,e,{reject:d,resolve:c},h):g.isImmutableArray(e)?Na(b,a,e,{reject:d,resolve:c},h):e instanceof x||e instanceof y?Oa(b,a,e,{reject:d,resolve:c},h):g.isFeatureSet(e)?O(e.iterator(b.abortSignal),b,a,e,h,m=>{c(m)},m=>{d(m)},0):N(b,a,[],{reject:d,resolve:c},h)}catch(k){d(k)}},d)}catch(f){d(f)}},d)})}function za(b,a){try{const d=a.argument;if("MemberExpression"===
d.type){var c=null;return n(b,d.object).then(e=>{let f=null;c=e;!0===d.computed?f=n(b,d.property):"Identifier"===d.property.type&&(f=l.resolve(d.property.name));return f}).then(e=>l.create(f=>{const h=c;let k;if(g.isArray(h))if(g.isNumber(e)){0>e&&(e=h.length+e);if(0>e||e>=h.length)throw Error("Assignment outside of array bounds");k=g.toNumber(h[e]);h[e]="++"===a.operator?k+1:k-1}else throw Error("Invalid Parameter");else if(h instanceof x){if(!1===g.isString(e))throw Error("Dictionary accessor must be a string");
if(!0===h.hasField(e))k=g.toNumber(h.field(e)),h.setField(e,"++"===a.operator?k+1:k-1);else throw Error("Invalid Parameter");}else if(h instanceof y){if(!1===g.isString(e))throw Error("Feature accessor must be a string");if(!0===h.hasField(e))k=g.toNumber(h.field(e)),h.setField(e,"++"===a.operator?k+1:k-1);else throw Error("Invalid Parameter");}else{if(g.isImmutableArray(h))throw Error("Array is Immutable");throw Error("Invalid Parameter");}!1===a.prefix?f(k):f("++"===a.operator?k+1:k-1)}))}return l.create((e,
f)=>{const h="Identifier"===a.argument.type?a.argument.name.toLowerCase():"";if(!h)throw Error("Invalid identifier");null!==b.localScope&&void 0!==b.localScope[h]?(f=g.toNumber(b.localScope[h].value),b.localScope[h]={value:"++"===a.operator?f+1:f-1,valueset:!0,node:a},!1===a.prefix?e(f):e("++"===a.operator?f+1:f-1)):void 0!==b.globalScope[h]?(f=g.toNumber(b.globalScope[h].value),b.globalScope[h]={value:"++"===a.operator?f+1:f-1,valueset:!0,node:a},!1===a.prefix?e(f):e("++"===a.operator?f+1:f-1)):
f(Error("Variable not recognised"))})}catch(d){return l.reject(d)}}function A(b,a,c,d){switch(a){case "\x3d":return b===g.voidOperation?null:b;case "/\x3d":return g.toNumber(c)/g.toNumber(b);case "*\x3d":return g.toNumber(c)*g.toNumber(b);case "-\x3d":return g.toNumber(c)-g.toNumber(b);case "+\x3d":return g.isString(c)||g.isString(b)?g.toString(c)+g.toString(b):g.toNumber(c)+g.toNumber(b);case "%\x3d":return g.toNumber(c)%g.toNumber(b);default:throw Error(p.nodeErrorMessage(d,"RUNTIME","OPERATORNOTRECOGNISED"));
}}function Aa(b,a){return l.create((c,d)=>{const e=a.left;if("MemberExpression"===e.type)n(b,a.right).then(f=>{try{n(b,e.object).then(h=>{try{let k=null;if(!0===e.computed)k=n(b,e.property);else if("Identifier"===e.property.type)k=l.resolve(e.property.name);else throw Error("Expected computed or identifier for assignemnt target");k.then(m=>{try{if(g.isArray(h))if(g.isNumber(m)){0>m&&(m=h.length+m);if(0>m||m>h.length)throw Error("Assignment outside of array bounds");if(m===h.length&&"\x3d"!==a.operator)throw Error("Invalid Parameter");
h[m]=A(f,a.operator,h[m],a)}else throw Error("Invalid Parameter");else if(h instanceof x){if(!1===g.isString(m))throw Error("Dictionary accessor must be a string");if(!0===h.hasField(m))h.setField(m,A(f,a.operator,h.field(m),a));else{if("\x3d"!==a.operator)throw Error("Invalid Parameter");h.setField(m,A(f,a.operator,null,a))}}else if(h instanceof y){if(!1===g.isString(m))throw Error("Feature accessor must be a string");if(!0===h.hasField(m))h.setField(m,A(f,a.operator,h.field(m),a));else{if("\x3d"!==
a.operator)throw Error("Invalid Parameter");h.setField(m,A(f,a.operator,null,a))}}else{if(g.isImmutableArray(h))throw Error("Array is Immutable");throw Error("Invalid Parameter");}c(g.voidOperation)}catch(r){d(r)}},d)}catch(k){d(k)}},d)}catch(h){d(h)}},d);else{const f=e.name.toLowerCase();null!==b.localScope&&void 0!==b.localScope[f]?n(b,a.right).then(h=>{try{b.localScope[f]={value:A(h,a.operator,b.localScope[f].value,a),valueset:!0,node:a.right},c(g.voidOperation)}catch(k){d(k)}},d):void 0!==b.globalScope[f]?
n(b,a.right).then(h=>{try{b.globalScope[f]={value:A(h,a.operator,b.globalScope[f].value,a),valueset:!0,node:a.right},c(g.voidOperation)}catch(k){d(k)}},d):d(Error("Cannot assign undeclared variable"))}})}function ya(b,a){try{return"AssignmentExpression"===a.expression.type?n(b,a.expression):n(b,a.expression).then(c=>l.create(d=>{c===g.voidOperation?d(g.voidOperation):d(new g.ImplicitResult(c))}))}catch(c){return l.reject(c)}}function xa(b,a){return l.create((c,d)=>{"AssignmentExpression"===a.test.type||
"UpdateExpression"===a.test.type?d(Error(p.nodeErrorMessage(a.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):n(b,a.test).then(e=>{try{!0===e?n(b,a.consequent).then(c,d):!1===e?null!==a.alternate?n(b,a.alternate).then(c,d):c(g.voidOperation):d(Error(p.nodeErrorMessage(a.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))}catch(f){d(f)}},d)})}function V(b,a,c){try{return c>=a.body.length?l.resolve(g.voidOperation):l.create((d,e)=>{n(b,a.body[c]).then(f=>{try{f instanceof g.ReturnResult||
f===g.breakResult||f===g.continueResult?d(f):c===a.body.length-1?d(f):V(b,a,c+1).then(d,e)}catch(h){e(h)}},e)})}catch(d){return q(d)}}function wa(b,a){return l.create((c,d)=>{null===a.argument?c(new g.ReturnResult(g.voidOperation)):n(b,a.argument).then(e=>{try{c(new g.ReturnResult(e))}catch(f){d(f)}},d)})}function va(b,a){try{const c=a.id.name.toLowerCase();b.globalScope[c]={valueset:!0,node:null,value:new E(a,b)};return l.resolve(g.voidOperation)}catch(c){return q(c)}}function U(b,a,c){return l.create((d,
e)=>{c>=a.declarations.length?d(g.voidOperation):n(b,a.declarations[c]).then(()=>{c===a.declarations.length-1?d(g.voidOperation):U(b,a,c+1).then(()=>{d(g.voidOperation)},e)},e)})}function ua(b,a){try{let c=null;c=null===a.init?l.resolve(null):n(b,a.init);return null!==b.localScope?c.then(d=>l.create(e=>{d===g.voidOperation&&(d=null);if("Identifier"!==a.id.type)throw Error("Can only assign a regular variable");const f=a.id.name.toLowerCase();b.localScope[f]={value:d,valueset:!0,node:a.init};e(g.voidOperation)})):
c.then(d=>l.create(e=>{if("Identifier"!==a.id.type)throw Error("Can only assign a regular variable");const f=a.id.name.toLowerCase();d===g.voidOperation&&(d=null);b.globalScope[f]={value:d,valueset:!0,node:a.init};e(g.voidOperation)}))}catch(c){return q(c)}}function X(b,a,c,d){a=a.toLowerCase();switch(a){case "hasz":return b=b.hasZ,void 0===b?!1:b;case "hasm":return b=b.hasM,void 0===b?!1:b;case "spatialreference":return a=b.spatialReference._arcadeCacheId,void 0===a&&(c=!0,Object.freeze&&Object.isFrozen(b.spatialReference)&&
(c=!1),c&&(z++,a=b.spatialReference._arcadeCacheId=z)),b=new x({wkt:b.spatialReference.wkt,wkid:b.spatialReference.wkid}),void 0!==a&&(b._arcadeCacheId="SPREF"+a.toString()),b}switch(b.type){case "extent":switch(a){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return b=b[a],void 0!==b?b:null;case "type":return"Extent"}break;case "polygon":switch(a){case "rings":return a=b.cache._arcadeCacheId,void 0===a&&(z++,a=z,b.cache._arcadeCacheId=a),new R(b.rings,
b.spatialReference,!0===b.hasZ,!0===b.hasM,a);case "type":return"Polygon"}break;case "point":switch(a){case "x":case "y":case "z":case "m":return void 0!==b[a]?b[a]:null;case "type":return"Point"}break;case "polyline":switch(a){case "paths":return a=b.cache._arcadeCacheId,void 0===a&&(z++,a=z,b.cache._arcadeCacheId=a),new R(b.paths,b.spatialReference,!0===b.hasZ,!0===b.hasM,a);case "type":return"Polyline"}break;case "multipoint":switch(a){case "points":return a=b.cache._arcadeCacheId,void 0===a&&
(z++,a=z,b.cache._arcadeCacheId=a),new fa(b.points,b.spatialReference,!0===b.hasZ,!0===b.hasM,a,1);case "type":return"Multipoint"}}throw Error(p.nodeErrorMessage(d,"RUNTIME","PROPERTYNOTFOUND"));}function Ea(b,a){try{return n(b,a.object).then(c=>{try{return null===c?l.reject(Error(p.nodeErrorMessage(a,"RUNTIME","NOTFOUND"))):!1===a.computed?"Identifier"===a.property.type?c instanceof x||c instanceof y?l.resolve(c.field(a.property.name)):c instanceof S?l.resolve(X(c,a.property.name,b,a)):l.reject(Error(p.nodeErrorMessage(a,
"RUNTIME","INVALIDTYPE"))):l.reject(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE"))):n(b,a.property).then(d=>l.create((e,f)=>{if(c instanceof x||c instanceof y)g.isString(d)?e(c.field(d)):f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else if(c instanceof S)g.isString(d)?e(X(c,d,b,a)):f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else if(g.isArray(c))if(g.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw Error(p.nodeErrorMessage(a,"RUNTIME",
"OUTOFBOUNDS"));e(c[d])}else f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else if(g.isImmutableArray(c))if(g.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length()+d);if(d>=c.length()||0>d)throw Error(p.nodeErrorMessage(a,"RUNTIME","OUTOFBOUNDS"));e(c.get(d))}else f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else if(g.isString(c))if(g.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw Error(p.nodeErrorMessage(a,"RUNTIME","OUTOFBOUNDS"));
e(c[d])}else f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")))}))}catch(d){return q(d)}})}catch(c){return q(c)}}function Ga(b,a){try{return n(b,a.argument).then(c=>l.create((d,e)=>{g.isBoolean(c)?"!"===a.operator?d(!c):"-"===a.operator?d(-1*g.toNumber(c)):"+"===a.operator?d(1*g.toNumber(c)):"~"===a.operator?d(~g.toNumber(c)):e(Error(p.nodeErrorMessage(a,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))):"-"===a.operator?d(-1*g.toNumber(c)):
"+"===a.operator?d(1*g.toNumber(c)):"~"===a.operator?d(~g.toNumber(c)):e(Error(p.nodeErrorMessage(a,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))}))}catch(c){return q(c)}}function Ja(b,a){try{const c=[];for(let d=0;d<a.elements.length;d++)c.push(n(b,a.elements[d]));return l.all(c).then(d=>l.create((e,f)=>{for(let h=0;h<d.length;h++){if(g.isFunctionParameter(d[h])){f(Error(p.nodeErrorMessage(a,"RUNTIME","FUNCTIONCONTEXTILLEGAL")));return}d[h]===g.voidOperation&&(d[h]=null)}e(d)}))}catch(c){return q(c)}}
function Ha(b,a){try{return l.all([n(b,a.left),n(b,a.right)]).then(c=>l.create((d,e)=>{const f=c[0],h=c[1];switch(a.operator){case "|":case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":case "^":case "\x26":d(g.binaryOperator(g.toNumber(f),g.toNumber(h),a.operator));case "\x3d\x3d":d(g.equalityTest(f,h));break;case "!\x3d":d(!g.equalityTest(f,h));break;case "\x3c":d(g.greaterThanLessThan(f,h,a.operator));break;case "\x3e":d(g.greaterThanLessThan(f,h,a.operator));break;case "\x3c\x3d":d(g.greaterThanLessThan(f,
h,a.operator));break;case "\x3e\x3d":d(g.greaterThanLessThan(f,h,a.operator));break;case "+":g.isString(f)||g.isString(h)?d(g.toString(f)+g.toString(h)):d(g.toNumber(f)+g.toNumber(h));break;case "-":d(g.toNumber(f)-g.toNumber(h));break;case "*":d(g.toNumber(f)*g.toNumber(h));break;case "/":d(g.toNumber(f)/g.toNumber(h));break;case "%":d(g.toNumber(f)%g.toNumber(h));break;default:e(Error(p.nodeErrorMessage(a,"RUNTIME","OPERATORNOTRECOGNISED")))}}))}catch(c){return q(c)}}function Ia(b,a){return l.create((c,
d)=>{"AssignmentExpression"===a.left.type||"UpdateExpression"===a.left.type?d(Error(p.nodeErrorMessage(a.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):"AssignmentExpression"===a.right.type||"UpdateExpression"===a.right.type?d(Error(p.nodeErrorMessage(a.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):n(b,a.left).then(e=>{try{if(g.isBoolean(e))switch(a.operator){case "||":!0===e?c(e):n(b,a.right).then(f=>{try{if(g.isBoolean(f))c(f);else throw Error(p.nodeErrorMessage(a,"RUNTIME","ONLYORORAND"));
}catch(h){d(h)}},d);break;case "\x26\x26":!1===e?c(e):n(b,a.right).then(f=>{try{if(g.isBoolean(f))c(f);else throw Error(p.nodeErrorMessage(a,"RUNTIME","ONLYORORAND"));}catch(h){d(h)}},d);break;default:throw Error(p.nodeErrorMessage(a,"RUNTIME","ONLYORORAND"));}else throw Error(p.nodeErrorMessage(a,"RUNTIME","ONLYBOOLEAN"));}catch(f){d(f)}},d)})}function J(b,a){return l.create((c,d)=>{const e=a.name.toLowerCase();if(null!==b.localScope&&void 0!==b.localScope[e]){const f=b.localScope[e];!0===f.valueset?
c(f.value):null!==f.d?f.d.then(c,d):(f.d=n(b,f.node),f.d.then(h=>{try{f.value=h,f.valueset=!0,c(h)}catch(k){d(k)}},d))}else if(void 0!==b.globalScope[e]){const f=b.globalScope[e];!0===f.valueset?c(f.value):null!==f.d?f.d.then(c,d):(f.d=n(b,f.node),f.d.then(h=>{try{f.value=h,f.valueset=!0,c(h)}catch(k){d(k)}},d))}else d(Error(p.nodeErrorMessage(a,"RUNTIME","VARIABLENOTFOUND")))})}function Fa(b,a){try{if("Identifier"!==a.callee.type)return q(p.nodeErrorMessage(a,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==
b.localScope&&void 0!==b.localScope[a.callee.name.toLowerCase()]){const c=b.localScope[a.callee.name.toLowerCase()];return c.value instanceof g.NativeFunction?c.value.fn(b,a):c.value instanceof E?Y(b,a,c.value.definition):q(p.nodeErrorMessage(a,"RUNTIME","NOTAFUNCTION"))}if(void 0!==b.globalScope[a.callee.name.toLowerCase()]){const c=b.globalScope[a.callee.name.toLowerCase()];return c.value instanceof g.NativeFunction?c.value.fn(b,a):c.value instanceof E?Y(b,a,c.value.definition):q(p.nodeErrorMessage(a,
"RUNTIME","NOTAFUNCTION"))}return q(p.nodeErrorMessage(a,"RUNTIME","NOTFOUND"))}catch(c){return q(c)}}function Da(b,a){return l.create(c=>{const d=[];ha.reduceArrayWithPromises(a.expressions,(e,f,h,k)=>n(b,f).then(m=>{d[h]=g.toString(m)})).then(()=>{let e="",f=0;for(const h of a.quasis)e+=h.value?h.value.cooked:"",!1===h.tail&&(e+=d[f]?d[f]:"",f++);c(e)})})}function Z(b){return null===b?"":g.isArray(b)||g.isImmutableArray(b)?"Array":g.isDate(b)?"Date":g.isString(b)?"String":g.isBoolean(b)?"Boolean":
g.isNumber(b)?"Number":b instanceof ea?"Attachment":b instanceof da?"Portal":b instanceof x?"Dictionary":b instanceof y?"Feature":b instanceof qa?"Point":b instanceof ra?"Polygon":b instanceof sa?"Polyline":b instanceof pa?"Multipoint":b instanceof oa?"Extent":g.isFunctionParameter(b)?"Function":g.isFeatureSet(b)?"FeatureSet":g.isFeatureSetCollection(b)?"FeatureSetCollection":b===g.voidOperation?"":"number"===typeof b&&isNaN(b)?"Number":"Unrecognised Type"}function aa(b,a,c,d){return l.create((e,
f)=>{n(b,a.arguments[c]).then(h=>{try{if(g.equalityTest(h,d))n(b,a.arguments[c+1]).then(e,f);else{{const k=a.arguments.length-c;1===k?n(b,a.arguments[c]).then(e,f):(2===k&&e(null),3===k?n(b,a.arguments[c+2]).then(e,f):aa(b,a,c+2,d).then(e,f))}}}catch(k){f(k)}},f)})}function ba(b,a,c,d){return l.create((e,f)=>{!0===d?n(b,a.arguments[c+1]).then(e,f):3===a.arguments.length-c?n(b,a.arguments[c+2]).then(e,f):n(b,a.arguments[c+2]).then(h=>{try{!1===g.isBoolean(h)?f(Error("WHEN needs boolean test conditions")):
ba(b,a,c+2,h).then(e,f)}catch(k){f(k)}})})}function P(b,a){try{const c=b.length,d=Math.floor(c/2);return 0===c?l.resolve([]):1===c?l.resolve([b[0]]):l.create((e,f)=>{const h=[P(b.slice(0,d),a),P(b.slice(d,c),a)];l.all(h).then(k=>{try{G(k[0],k[1],a,[]).then(e,f)}catch(m){f(m)}},f)})}catch(c){return q(c)}}function G(b,a,c,d){return l.create((e,f)=>{0<b.length||0<a.length?0<b.length&&0<a.length?c(b[0],a[0]).then(h=>{try{isNaN(h)&&(h=1),0>=h?(d.push(b[0]),b=b.slice(1)):(d.push(a[0]),a=a.slice(1)),G(b,
a,c,d).then(e,f)}catch(k){f(k)}},f):0<b.length?(d.push(b[0]),b=b.slice(1),G(b,a,c,d).then(e,f)):0<a.length&&(d.push(a[0]),a=a.slice(1),G(b,a,c,d).then(e,f)):e(d)})}function B(b,a){const c=b.length,d=Math.floor(c/2);a||(a=function(e,f){return e<f?-1:e===f?0:1});return 0===c?[]:1===c?[b[0]]:Pa(B(b.slice(0,d),a),B(b.slice(d,c),a),a)}function Pa(b,a,c){const d=[];for(;0<b.length||0<a.length;)if(0<b.length&&0<a.length){let e=c(b[0],a[0]);isNaN(e)&&(e=1);0>=e?(d.push(b[0]),b=b.slice(1)):(d.push(a[0]),a=
a.slice(1))}else 0<b.length?(d.push(b[0]),b=b.slice(1)):0<a.length&&(d.push(a[0]),a=a.slice(1));return d}function ca(b,a,c){try{const d=b.body;if(c.length!==b.params.length)return q(Error("Invalid Parameter calls to function."));for(let e=0;e<c.length;e++){const f=b.params[e];"Identifier"===f.type&&(a.localScope[f.name.toLowerCase()]={d:null,value:c[e],valueset:!0,node:null})}return n(a,d).then(e=>l.create((f,h)=>{e instanceof g.ReturnResult?f(e.value):e===g.breakResult?h(Error("Cannot Break from a Function")):
e===g.continueResult?h(Error("Cannot Continue from a Function")):e instanceof g.ImplicitResult?f(e.value):f(e)}))}catch(d){return l.reject(d)}}function Y(b,a,c){return C(b,a,function(d,e,f){d={spatialReference:b.spatialReference,services:b.services,console:b.console,lrucache:b.lrucache,interceptor:b.interceptor,localScope:{},abortSignal:b.abortSignal,globalScope:b.globalScope,depthCounter:b.depthCounter+1};if(64<d.depthCounter)throw Error("Exceeded maximum function depth");return ca(c,d,f)})}function Q(b){return function(){const a=
{abortSignal:b.context.abortSignal,spatialReference:b.context.spatialReference,console:b.context.console,lrucache:b.context.lrucache,interceptor:b.context.interceptor,services:b.context.services,localScope:{},globalScope:b.context.globalScope,depthCounter:b.context.depthCounter+1};if(64<a.depthCounter)throw Error("Exceeded maximum function depth");return ca(b.definition,a,arguments)}}function Qa(b,a){const c=new D;if(void 0===b||null===b)b={};if(void 0===a||null===a)a={};const d=new x({newline:"\n",
tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});d.immutable=!1;c.textformatting={value:d,valueset:!0,node:null};for(const e in a)c[e]={value:new g.NativeFunction(a[e]),native:!0,valueset:!0,node:null};for(const e in b)c[e]=b[e]&&"esri.Graphic"===b[e].declaredClass?{value:y.createFromGraphic(b[e]),valueset:!0,node:null}:{value:b[e],valueset:!0,node:null};return c}function Ra(b){console.log(b)}let z=0;const t={};H.registerFunctions(t,v);ia.registerFunctions(t,v);na.registerFunctions(t,
v);la.registerFunctions(t,v);ka.registerFunctions(t,v);ma.registerFunctions(t,v);ja.registerFunctions({functions:t,compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:v,standardFunctionAsync:C});t.typeof=function(b,a){return v(b,a,function(c,d,e){g.pcCheck(e,1,1);c=Z(e[0]);if("Unrecognised Type"===c)throw Error("Unrecognised Type");return c})};t.iif=function(b,a){return l.create((c,d)=>{g.pcCheck(null===a.arguments?
[]:a.arguments,3,3);n(b,a.arguments[0]).then(e=>{try{!1===g.isBoolean(e)?d(Error("IF Function must have a boolean test condition")):l.all([n(b,a.arguments[1]),n(b,a.arguments[2])]).then(f=>{e?c(f[0]):c(f[1])},d)}catch(f){d(f)}},d)})};t.decode=function(b,a){return l.create((c,d)=>{2>a.arguments.length?d(Error("Missing Parameters")):2===a.arguments.length?n(b,a.arguments[1]).then(c,d):0===(a.arguments.length-1)%2?d(Error("Must have a default value result.")):n(b,a.arguments[0]).then(e=>{try{aa(b,a,
1,e).then(c,d)}catch(f){d(f)}},d)})};t.when=function(b,a){try{return 3>a.arguments.length?q("Missing Parameters"):0===a.arguments.length%2?q("Must have a default value result."):n(b,a.arguments[0]).then(c=>l.create((d,e)=>{!1===g.isBoolean(c)?e(Error("WHEN needs boolean test conditions")):ba(b,a,0,c).then(d,e)}))}catch(c){return q(c)}};t.sort=function(b,a){return C(b,a,function(c,d,e){g.pcCheck(e,1,2);c=e[0];g.isImmutableArray(c)&&(c=c.toArray());if(!1===g.isArray(c))return q(Error("Illegal Argument"));
if(1<e.length){if(!1===g.isFunctionParameter(e[1]))return q(Error("Illegal Argument"));var f=c;e=Q(e[1]);return P(f,e)}e=c;if(0===e.length)return l.resolve([]);c={};for(d=0;d<e.length;d++){var h=Z(e[d]);""!==h&&(c[h]=!0)}if(!0===c.Array||!0===c.Dictionary||!0===c.Feature||!0===c.Point||!0===c.Polygon||!0===c.Polyline||!0===c.Multipoint||!0===c.Extent||!0===c.Function)return l.resolve(e.slice(0));d=0;h="";for(f in c)d++,h=f;1<d||"String"===h?e=B(e,function(k,m){if(null===k||void 0===k||k===g.voidOperation)return null===
m||void 0===m||m===g.voidOperation?0:1;if(null===m||void 0===m||m===g.voidOperation)return-1;k=g.toString(k);m=g.toString(m);return k<m?-1:k===m?0:1}):"Number"===h?e=B(e,function(k,m){return k-m}):"Boolean"===h?e=B(e,function(k,m){return k===m?0:m?-1:1}):"Date"===h&&(e=B(e,function(k,m){return m-k}));return l.resolve(e)})};H={failDefferred:q,resolveDeffered:T,fixSpatialReference:g.fixSpatialReference,parseArguments:I,standardFunction:v,standardFunctionAsync:C,evaluateIdentifier:J,arcadeCustomFunction:Q};
for(const b in t)t[b]={value:new g.NativeFunction(t[b]),valueset:!0,node:null};const D=function(){};D.prototype=t;D.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};D.prototype.pi={value:Math.PI,valueset:!0,node:null};w.executeScript=function(b,a){let c=a.spatialReference;if(null===c||void 0===c)c=new ta({wkid:102100});const d=Qa(a.vars,a.customfunctions);return n({spatialReference:c,services:a.services,abortSignal:void 0===a.abortSignal||null===a.abortSignal?{aborted:!1}:
a.abortSignal,globalScope:d,console:a.console?a.console:Ra,lrucache:a.lrucache,interceptor:a.interceptor,localScope:null,depthCounter:1},b.body[0].body).then(e=>l.create((f,h)=>{e instanceof g.ReturnResult&&(e=e.value);e instanceof g.ImplicitResult&&(e=e.value);e===g.voidOperation&&(e=null);e===g.breakResult?h(Error("Cannot return BREAK")):e===g.continueResult?h(Error("Cannot return CONTINUE")):e instanceof g.NativeFunction?h(Error("Cannot return FUNCTION")):e instanceof E?h(Error("Cannot return FUNCTION")):
f(e)}))};w.extend=function(b){const a={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:v,standardFunctionAsync:C,failDefferred:q,evaluateIdentifier:J,arcadeCustomFunctionHandler:Q};for(let c=0;c<b.length;c++)b[c].registerFunctions(a);for(const c in a.functions)t[c]={value:new g.NativeFunction(a.functions[c]),valueset:!0,node:null},D.prototype[c]=t[c];for(b=0;b<a.signatures.length;b++)p.addFunctionDeclaration(a.signatures[b],"async")};w.extractFieldLiterals=function(b,a){return p.findFieldLiterals(b)};
w.findFunctionCalls=function(b){return p.findFunctionCalls(b)};w.functionHelper=H;w.referencesFunction=function(b,a){return p.referencesFunction(b,a)};w.referencesMember=function(b,a){return p.referencesMember(b,a)};w.validateScript=function(b,a){return p.validateScript(b,a,"full")};Object.defineProperty(w,"__esModule",{value:!0})});