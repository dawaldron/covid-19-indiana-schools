// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../core/global","../../core/mathUtils"],function(h,G,H){function D(a,b,c,d,e){a=new Uint32Array(a*a);b="buffer"in b?b:new Float64Array(b);c="buffer"in c?new Uint32Array(c.buffer):new Uint32Array((new Uint8Array(c)).buffer);e=c.length/(e-d);for(let f=0;f<b.length;f++)a[f]=c[H.clamp(Math.floor((b[f]-d)*e),0,c.length-1)];return a.buffer}function z(a){const b=Math.round(3*a),c=2*a*a,d=new Float64Array(2*b+1);for(let e=0;e<=d.length;e++)d[e]=Math.exp(-((e-b)**2)/c)/Math.sqrt(2*Math.PI)*
(a/2);return d}function E(a,b){return"function"===typeof a?a:a?"string"===typeof b?c=>-1*+c[a]:c=>+c[a]+b:()=>1}function F(a,b){return null!=a?"string"===typeof b?c=>-1*+c.readAttribute(a):c=>+c.readAttribute(a)+b:c=>1}const I=(()=>{if(!("document"in G))return()=>null;const a=document.createElement("canvas"),b=a.getContext("2d");a.height=512;a.width=1;return c=>{b.clearRect(0,0,1,a.height);const d=b.createLinearGradient(0,0,0,a.height);for(const {ratio:e,color:f}of c.colorStops)d.addColorStop(Math.max(e,
.001),`rgba(${f[0]}, ${f[1]}, ${f[2]}, ${f[3]})`);b.fillStyle=d;b.fillRect(0,0,1,a.height);return b.getImageData(0,0,1,a.height).data}})();h.calculateHeatmapIntensityInfo=function(a,b,c,d){const {blurRadius:e,fieldOffset:f,field:u}=b;b=new Float64Array(c*d);const v=z(e),k=Math.round(3*e);let m=Number.NEGATIVE_INFINITY;const A=E(u,f);for(const {geometry:l,attributes:g}of a){a=l.x-k;const n=l.y-k,B=Math.max(0,a);var p=Math.max(0,n);const x=Math.min(d,l.y+k),y=Math.min(c,l.x+k),C=+A(g);for(let q=p;q<
x;q++){const r=v[q-n];for(let t=B;t<y;t++)p=b[q*c+t]+=r*v[t-a]*C,p>m&&(m=p)}}return{matrix:b.buffer,max:m}};h.calculateHeatmapIntensityInfoReaders=function(a,b,c,d){const {blurRadius:e,fieldOffset:f,field:u}=b;b=new Float64Array(c*d);const v=z(e),k=Math.round(3*e);let m=Number.NEGATIVE_INFINITY;const A=F(u,f),p=new Set;for(const B of a)for(a=B.getCursor();a.next();){var l=a.getObjectId();if(p.has(l))continue;p.add(l);var g=a.readLegacyPointGeometry();if(-128>g.x||g.x>=c+128||-128>g.y||g.y>d+128)continue;
l=+A(a);const x=Math.round(g.x)-k,y=Math.round(g.y)-k,C=Math.max(0,x);var n=Math.max(0,y);const q=Math.min(d,Math.round(g.y)+k);g=Math.min(c,Math.round(g.x)+k);for(let r=n;r<q;r++){const t=v[r-y];for(let w=C;w<g;w++)n=b[r*c+w]+=t*v[w-x]*l,n>m&&(m=n)}}return{matrix:b.buffer,max:m}};h.createHeatmapImageData=D;h.createKernel=z;h.createValueFunction=E;h.createValueFunctionCursor=F;h.drawHeatmap=function(a,b,c,d,e,f){a.canvas.width=a.canvas.height=b;a.clearRect(0,0,b,b);const u=a.getImageData(0,0,b,b);
c&&d&&u.data.set(new Uint8ClampedArray(D(b,c,d,e,f)));a.putImageData(u,0,0)};h.generateGradient=I;Object.defineProperty(h,"__esModule",{value:!0})});