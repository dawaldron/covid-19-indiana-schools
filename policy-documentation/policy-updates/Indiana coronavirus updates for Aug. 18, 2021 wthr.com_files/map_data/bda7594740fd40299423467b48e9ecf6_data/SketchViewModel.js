// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/has ../../core/Error ../../core/Evented ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../geometry/projectionEllipsoid ../../geometry/support/coordsUtils ../../layers/GraphicsLayer ../../views/DOMContainer ../../views/3d/interactive/editingTools/isSupportedGraphicUtils ../../views/3d/interactive/editingTools/moveGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/reshapeGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/transformGraphic/isSupportedGraphic ../../views/draw/Draw ../../views/draw/DrawAction ../../views/draw/support/createUtilsAsync ../../views/draw/support/layerUtils ../../views/input/InputManager ../../views/interactive/keybindings ../../views/interactive/snapping/SnappingManager ../../views/interactive/snapping/SnappingOptions ../../views/support/screenUtils ./support/OperationHandle ../../geometry/Point ../../symbols/SimpleMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/CIMSymbol ../../symbols/SimpleLineSymbol".split(" "),
function(G,z,x,w,E,K,fa,wa,ha,ia,Y,ja,r,M,N,I,A,xa,ya,ka,la,Z,ma,na,V,oa,O,pa,qa,ra,P,aa,y,t,sa,ba,W,J,Q,L,X,ta,ca){function R(D){return Object.freeze({__proto__:null,"default":D})}function S(D,F){da("undo",D.history.undo,D.history.redo,F)}function T(D,F){da("redo",D.history.redo,D.history.undo,F)}function da(D,F,q,d){const a=F.pop().updates,b=[];d.forEach((c,e)=>{e=a[e];null!=e&&("geometry"in e&&r.isSome(e.geometry)&&(b.push({geometry:c.geometry}),c.geometry=e.geometry),"symbol"in e&&r.isSome(e.symbol)&&
(b.push({symbol:c.symbol}),c.symbol=e.symbol),"undo"in e&&(b.push(e),e[D](c)))});q.push({updates:b})}function H(D){return{updates:D.map(F=>({geometry:F.geometry}))}}function C(D){return"requireError"in D&&"aborted"===D.requireError}const ua=ja.getLogger("esri.widgets.Sketch.SketchViewModel"),ea={defaultZ:0},U={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,
toggleToolOnClick:!0,enableZ:!0,tool:"transform"};w=function(D){function F(d){d=D.call(this,d)||this;d._activeFillGraphic=null;d._activeLineGraphic=null;d._centerIndicatorGraphic=null;d._centerSymbol=new L({style:"cross",size:6,color:[255,255,255]});d._defaultSegmentOffset=48;d._numUpdating=0;d._handles=new Y;d._internalGraphicsLayer=new ma({listMode:"hide",internal:!0,title:"SVM Internal"});d._lineGraphic=null;d._operationHandle=null;d._vertexGraphics=[];d._viewHandles=new Y;d._doUnnormalization=
!1;d.activeFillSymbol=new X({style:"solid",color:[150,150,150,.2],outline:{color:[50,50,50],width:0}});d.activeLineSymbol=new ta({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",
joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}});d.activeVertexSymbol=new L({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});d.allowDeleteKey=!0;d.layer=null;d.pointSymbol=new L({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}});d.polygonSymbol=new X({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}});d.polylineSymbol=new ca({color:[130,130,130,1],width:2});d._snappingManager=null;d.updateGraphics=new fa;d.updateOnGraphicClick=
!0;d.updatePointSymbol=new L({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}});d.updatePolygonSymbol=new X({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}});d.updatePolylineSymbol=new ca({color:[12,207,255],width:2});d.vertexSymbol=new L({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}});d._moduleLoaderAbortController=null;d._viewReadyAbortController=null;d._originalAutoOpenEnabled=null;d.defaultCreateOptions=ea;d.defaultUpdateOptions=
U;d.snappingOptions=new ba;return d}z._inheritsLoose(F,D);var q=F.prototype;q.initialize=function(){this._handles.add([I.watch(this,"layer",()=>{this.cancel();this._internalGraphicsLayer.elevationInfo=r.isSome(this.layer)?this.layer.elevationInfo:null}),I.on(this,"view.map.layers","change",d=>{d.removed.includes(this.layer)&&this.cancel()}),I.on(this,"layer.graphics","change",d=>{if(r.isSome(this._operationHandle))for(const a of d.removed)this.updateGraphics.includes(a)&&(1<this.updateGraphics.length?
this._operationHandle.removeFromSelection(a):this._operationHandle.cancel())}),I.init(this,"layer.elevationInfo",()=>{this.cancel();this._internalGraphicsLayer.elevationInfo=r.isSome(this.layer)?this.layer.elevationInfo:null},!0),I.init(this,"view",d=>{r.destroyMaybe(this._snappingManager);d&&(this._snappingManager=new sa.SnappingManager({view:d,options:this.snappingOptions}),"3d"===d.type&&(new Promise(function(a,b){G(["../../views/3d/interactive/editingTools"],a,b)}),new Promise(function(a,b){G(["../../views/3d/layers/GraphicsLayerView3D"],
function(c){a(R(c))},b)})))},!0)])};q.destroy=function(){this.cancel();this._handles=r.destroyMaybe(this._handles);this._viewHandles=r.destroyMaybe(this._viewHandles);this._removeDefaultLayer();r.destroyMaybe(this._draw);r.destroyMaybe(this._snappingManager);this._set("view",null);this.emit("destroy")};q.cancel=function(){this._moduleLoaderAbortController=r.abortMaybe(this._moduleLoaderAbortController);this._viewReadyAbortController=r.abortMaybe(this._viewReadyAbortController);this._operationHandle&&
this._operationHandle.cancel()};q.complete=function(){this._operationHandle&&this._operationHandle.complete()};q.delete=function(){const {state:d,updateGraphics:a}=this;if("active"===d&&a.length){const {activeTool:b,layer:c}=this,e=a.toArray();c.removeMany(e);this.cancel();this._emitDeleteEvent({graphics:e,tool:b})}};q.create=function(){var d=z._asyncToGenerator(function*(a,b){yield this._waitViewReady();if("disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),
this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),M.createAbortError();this.cancel();this.view.activeTool=null;if(a){var c=yield this._setupCreateOperation(a,b);r.isNone(c)||this.destroyed||(b=null,"2d"===this.view.type&&(b=this.view.map.layers.findIndex(e=>e.id===ra.SNAPPING_GRAPHICS_LAYER_ID),b=-1<b?b:null),aa.addUniqueLayer(this.view,this._internalGraphicsLayer,b),c.on("complete",()=>{if(c===this._operationHandle){const e=this.createGraphic,h=
this._operationHandle.cancelled;this._operationHandle.destroy();this._operationHandle=null;this._set("createGraphic",null);this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer);c.cancelled||null==e||this.layer.add(e);this.emit("create",{graphic:e,state:h?"cancel":"complete",tool:a,toolEventInfo:null,type:"create"})}}),this._operationHandle=c,this.view.ready&&na.isDOMContainer(this.view)&&this.view.focus())}else this._logError("sketch:missing-parameter","Missing parameter 'tool'.")});
return function(a,b){return d.apply(this,arguments)}}();q.update=function(){var d=z._asyncToGenerator(function*(a,b){yield this._waitViewReady();const {layer:c,view:e,state:h}=this;if("disabled"===h)throw e||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),c||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),M.createAbortError();this.cancel();this.view.activeTool=null;const n=Array.isArray(a)?a:[a];null!=a&&n&&n.length?
n.some(g=>g.layer!==c?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):r.isNone(g.geometry)?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):"2d"!==e.type||e.spatialReference.equals(g.geometry.spatialReference)?!1:(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with a spatial reference different from the supplied IMapView."),
!0))||(a=yield this._setupUpdateOperation(n,b),this.destroyed||r.isNone(a)||C(a)||(aa.addUniqueLayer(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(a,b),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:a.tool,toolEventInfo:null,type:"update"}))):this._logError("sketch:missing-parameter","Missing parameter 'graphics'.")});return function(a,b){return d.apply(this,arguments)}}();q.undo=function(){this.canUndo()&&this._operationHandle.undo()};q.redo=function(){this.canRedo()&&
this._operationHandle.redo()};q.canUndo=function(){return!(!this._operationHandle||!this._operationHandle.canUndo())};q.canRedo=function(){return!(!this._operationHandle||!this._operationHandle.canRedo())};q.toggleUpdateTool=function(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()};q._getFirstHit=function(){var d=z._asyncToGenerator(function*(a){const b=[];switch(this.view.type){case "2d":var c=yield this.view.hitTest(a);if(0<c.results.length&&(c=c.results[0],
c.graphic)){var e,h;const n=c.graphic;"vector-tile"!==(null==(e=n.layer)?void 0:e.type)&&"imagery"!==(null==(h=n.layer)?void 0:h.type)&&b.push(c)}break;case "3d":{const n=[this.view.map.ground];this.view.map.allLayers.forEach(g=>{"integrated-mesh"===g.type&&n.push(g)});e=yield this.view.hitTest(a,{exclude:n});0<e.results.length&&(h=e.results[0],(!e.ground.mapPoint||1>this.view.map.ground.opacity||e.ground.distance-h.distance>-Math.min(3*e.ground.distance,"global"===this.view.viewingMode?la.getReferenceEllipsoid(this.view.renderCoordsHelper.spatialReference).radius/
this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&b.push(h))}}return{screenPoint:a,results:b}});return function(a){return d.apply(this,arguments)}}();q._generateViewHandles=function(d){var a=this;return[d.on("immediate-click",function(){var b=z._asyncToGenerator(function*(c){var e="active"===a.state&&"create"===a._operationHandle.type;if("disabled"!==a.state&&!e&&a.updateOnGraphicClick){a._beginAsyncOperation();var h=(yield c.async(()=>a._getFirstHit(W.createScreenPointFromEvent(c)))).results;
e=null;if(h.length)for(const n of h){if(n.graphic){h=n.graphic;if(a.updateGraphics.includes(h)||h.layer===a.layer){c.stopPropagation();e=h;break}"2d"!==d.type||a._isComponentGraphic(h)||"active"!==a.state||a.cancel()}}else"active"===a.state&&a.cancel();r.isSome(e)&&!a.updateGraphics.includes(e)&&(yield a.update([e],{...a.defaultUpdateOptions,reshapeOptions:{...a.defaultUpdateOptions.reshapeOptions}}));a._endAsyncOperation()}});return function(c){return b.apply(this,arguments)}}(),y.ViewEventPriorities.WIDGET)]};
q._setupCreateOperation=function(){var d=z._asyncToGenerator(function*(a,b){if(!a)return null;b={hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...b};let c;if("2d"===this.view.type)switch(a){case "point":c=this._setupCreatePointOperation(a,b);break;case "multipoint":c=yield this._setupCreateMultipointOperation(a,b);break;case "polygon":c=yield this._setupCreatePolyOperation(a,b);break;case "polyline":c=yield this._setupCreatePolyOperation(a,b);break;case "rectangle":c=yield this._setupCreateRectangleOperation(a,
b);break;case "circle":c=yield this._setupCreateCircleOperation(a,b)}else{a=yield this._setupCreate3DOperation(a,this.view,b);if(r.isNone(a)||C(a))return null;c=a}return c});return function(a,b){return d.apply(this,arguments)}}();q._setupCreate3DOperation=function(){var d=z._asyncToGenerator(function*(a,b,c){if("multipoint"===a)return null;this._removeCreateOperationGraphics();const e="rectangle"!==a,h="rectangle"!==a;this.snappingOptions.enabledToggled=!1;const n=yield this._requireModule(new Promise(function(f,
p){G(["../../views/3d/interactive/editingTools"],f,p)}));if(C(n))return n;if(this.destroyed)return null;const g=new n.module.DrawGraphicTool({view:b,mode:"rectangle"===a||"circle"===a?"hybrid":"click",...c,elevationInfo:this.layer.elevationInfo,geometryType:a,createGraphicSymbol:this._getGraphicSymbolFromTool(a),snapToScene:r.isSome(this.layer.elevationInfo)?"absolute-height"===this.layer.elevationInfo.mode:!0,snappingManager:this._snappingManager,forceUniformSize:h,centered:e});this.view.tools.add(g);
let m=null;this.view.activeTool=g;const k=[this.view.on("key-down",f=>{if(f.key===t.SKETCH_KEYS.pan)f.stopPropagation(),f.repeat||(g.enabled=!1);else if(f.key===t.SKETCH_KEYS.complete)f.stopPropagation(),g.completeCreateOperation();else if(f.key!==t.SKETCH_KEYS.vertexAdd||f.repeat)f.key===t.SKETCH_KEYS.undo?(f.stopPropagation(),l.undo()):f.key===t.SKETCH_KEYS.redo?(f.stopPropagation(),l.redo()):f.key!==t.SKETCH_KEYS.snappingToggle||"rectangle"===a||"circle"===a||f.repeat?f.key!==t.SKETCH_KEYS.constraint||
"rectangle"!==a&&"circle"!==a||f.repeat?f.key!==t.SKETCH_KEYS.center||f.repeat||(g.centered=!e,f.stopPropagation()):(g.forceUniformSize=!h,f.stopPropagation()):(this.snappingOptions.enabledToggled=!0,f.stopPropagation());else{const p=g.drawOperation.geometryType;if("polyline"===p||"polygon"===p)f.stopPropagation(),g.drawOperation.commitStagedVertex()}},y.ViewEventPriorities.WIDGET),this.view.on("key-up",f=>{f.key===t.SKETCH_KEYS.pan?g.enabled=!0:f.key===t.SKETCH_KEYS.snappingToggle&&"rectangle"!==
a&&"circle"!==a?(this.snappingOptions.enabledToggled=!1,f.stopPropagation()):f.key!==t.SKETCH_KEYS.constraint||"rectangle"!==a&&"circle"!==a?f.key===t.SKETCH_KEYS.center&&(g.centered=e,f.stopPropagation()):(g.forceUniformSize=h,f.stopPropagation())},y.ViewEventPriorities.WIDGET),g.on("vertex-add",f=>{m=r.isNone(m)?"start":"active";switch(f.operation){case "apply":this.emit("create",{graphic:r.unwrap(g.createGraphic),state:m,tool:this.activeTool,toolEventInfo:f,type:"create"});break;case "undo":this._emitUndoEvent({graphics:[r.unwrap(g.createGraphic)],
tool:a});break;case "redo":this._emitRedoEvent({graphics:[r.unwrap(g.createGraphic)],tool:a})}}),g.on("cursor-update",f=>{0<g.drawOperation.numCommittedVertices&&this.emit("create",{graphic:r.unwrap(g.createGraphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:f.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),g.on("vertex-remove",f=>{switch(f.operation){case "apply":this.emit("create",{graphic:r.unwrap(g.createGraphic),state:"active",tool:this.activeTool,toolEventInfo:f,
type:"create"});break;case "undo":this._emitUndoEvent({graphics:[r.unwrap(g.createGraphic)],tool:a});break;case "redo":this._emitRedoEvent({graphics:[r.unwrap(g.createGraphic)],tool:a})}}),g.on("complete",f=>{this._removeCreateOperationGraphics();this._set("createGraphic",r.unwrap(f.graphic));m="complete";f.aborted?l&&l.cancel():l&&l.complete()})],l=new J.OperationHandle({activeComponent:g,tool:a,type:"update",onEnd:()=>{var f;k.forEach(p=>p.remove());k.length=0;null==(f=this.view.tools)?void 0:f.remove(g);
g.destroy()},undo:()=>{g.canUndo&&g.undo()},redo:()=>{g.canRedo&&g.redo()},canUndo:()=>g.canUndo,canRedo:()=>g.canRedo});return l});return function(a,b,c){return d.apply(this,arguments)}}();q._getGraphicSymbolFromTool=function(d){switch(d){case "point":return this.pointSymbol;case "polyline":return this.polylineSymbol;case "circle":case "rectangle":case "polygon":return this.polygonSymbol;default:return null}};q._setupCreatePointOperation=function(d,a){a=this._draw.create(d,{elevationInfo:this.layer.elevationInfo,
hasZ:a.hasZ,defaultZ:a.defaultZ,snappingManager:this._snappingManager,interactiveUndoDisabled:!0});const b=[a.on("cursor-update",h=>{r.isSome(h.vertexIndex)?this._displayCrosshairCursor():this._displayDefaultCursor()}),a.on("draw-complete",h=>{h=this.createPointFromVertex(h.vertices[0]);h=new E(h,this.pointSymbol);this._set("createGraphic",h);e&&e.complete()})],c=[this.view.on("key-down",h=>{h.key===t.SKETCH_KEYS.cancel&&(e&&e.cancel(),h.stopPropagation())},y.ViewEventPriorities.WIDGET)],e=this._operationHandleForCreateAction(a,
[...b,...c],d);return e};q._setupCreateMultipointOperation=function(){var d=z._asyncToGenerator(function*(a,b){const c=yield P.loadCreateUtils();b=this._draw.create(a,{...b,elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0});let e=null;const h=[],n=this._operationHandleForCreateAction(b,h,a);h.push(b.on("vertex-add",g=>{const {type:m,vertexIndex:k,vertices:l}=g,f=l[k];e=g;this._drawMultipointGraphic(c,l,!0);this.emit("create",{graphic:this.createGraphic,
state:1===l.length?"start":"active",tool:a,toolEventInfo:{added:f,vertices:[{coordinates:f,componentIndex:0,vertexIndex:k}],type:m},type:"create"})}),b.on("vertex-remove",g=>{const {type:m,vertexIndex:k,vertices:l}=g,f=l[k];e=g;this._drawMultipointGraphic(c,l,!0);this.emit("create",{graphic:this.createGraphic,state:"active",tool:a,toolEventInfo:{removed:f,vertices:[{coordinates:f,componentIndex:0,vertexIndex:k}],type:m},type:"create"})}),b.on("vertex-update",g=>{const {type:m,vertexIndex:k,vertices:l}=
g,f=l[k];e=g;this._drawMultipointGraphic(c,l,!0);this.emit("create",{graphic:this.createGraphic,state:"active",tool:a,toolEventInfo:{type:m,updated:f,vertices:[{coordinates:f,componentIndex:0,vertexIndex:k}]},type:"create"})}),b.on("cursor-update",g=>{e=g}),b.on("draw-complete",g=>{g=g.vertices.slice(0);(g=c.createMultipoint(g,this.view.spatialReference))&&this.createGraphic&&(this.createGraphic.geometry=g);n&&n.complete()}),b.on("undo",g=>{g=g.vertices;const m=e&&"cursor-update"!==e.type;this._resetCreateOperationGraphics();
g.length&&this._drawMultipointGraphic(c,g,m)}),b.on("redo",g=>{g=g.vertices;const m=e&&"cursor-update"!==e.type;this._resetCreateOperationGraphics();g.length&&this._drawMultipointGraphic(c,g,m)}));h.push(this.view.on("pointer-move",()=>this._displayCrosshairCursor(),y.ViewEventPriorities.WIDGET),this.view.on("key-down",g=>this._getCommonUpdateOperationKeyDownHandlers(n,g),y.ViewEventPriorities.WIDGET));return n});return function(a,b){return d.apply(this,arguments)}}();q._setupCreatePolyOperation=
function(){var d=z._asyncToGenerator(function*(a,b){const c=yield P.loadCreateUtils();b={...b,elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0};let e=null;"polyline"===a?e=this._draw.create(a,b):"polygon"===a&&(e=this._draw.create(a,b));let h=null;b=[e.on("vertex-add",m=>{const {type:k,vertexIndex:l,vertices:f}=m,p=f[l];this._snapLastPolygonVertexToFirst(a,f);h=m;this._drawVertexGraphics(c,a,f,{userClicked:!0});this.emit("create",{graphic:this.createGraphic,
state:1===f.length?"start":"active",tool:a,toolEventInfo:{added:p,vertices:[{coordinates:p,componentIndex:0,vertexIndex:l}],type:k},type:"create"})}),e.on("vertex-remove",m=>{const {type:k,vertexIndex:l,vertices:f}=m,p=f[l];this._snapLastPolygonVertexToFirst(a,f);h=m;this._drawVertexGraphics(c,a,f,{userClicked:!0});this.emit("create",{graphic:this.createGraphic,state:"active",tool:a,toolEventInfo:{removed:p,vertices:[{coordinates:p,componentIndex:0,vertexIndex:l}],type:k},type:"create"})}),e.on("vertex-update",
m=>{const {type:k,vertexIndex:l,vertices:f}=m,p=f[l];this._snapLastPolygonVertexToFirst(a,f);h=m;this._drawVertexGraphics(c,a,f,{userClicked:!0});this.emit("create",{graphic:this.createGraphic,state:"active",tool:a,toolEventInfo:{type:k,updated:p,vertices:[{coordinates:p,componentIndex:0,vertexIndex:l}]},type:"create"})}),e.on("cursor-update",m=>{const {type:k,vertices:l}=m;m.mapPoint&&(this._snapLastPolygonVertexToFirst(a,l),h=m,this._drawVertexGraphics(c,a,l,{userClicked:!1}),1<l.length&&this.emit("create",
{graphic:this.createGraphic,state:"active",tool:a,toolEventInfo:{coordinates:l[l.length-1],type:k},type:"create"}))}),e.on("draw-complete",m=>{m=m.vertices.slice(0);let k=null;"polyline"===a?k=c.createPolyline([m],this.view.spatialReference,this._doUnnormalization):"polygon"===a&&(k=c.createPolygon([m],this.view.spatialReference,this._doUnnormalization,!0));k&&(this.createGraphic.geometry=k);g&&g.complete()}),e.on("undo",m=>{m=m.vertices;const k=h&&"cursor-update"!==h.type;this._resetCreateOperationGraphics();
this._snapLastPolygonVertexToFirst(a,m);m.length&&this._drawVertexGraphics(c,a,m,{userClicked:k})}),e.on("redo",m=>{m=m.vertices;const k=h&&"cursor-update"!==h.type;this._resetCreateOperationGraphics();this._snapLastPolygonVertexToFirst(a,m);m.length&&this._drawVertexGraphics(c,a,m,{userClicked:k})})];const n=[this.view.on("pointer-move",m=>{r.isSome(e.getCoordsFromScreenPoint(N.createScreenPoint(m.x,m.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()},y.ViewEventPriorities.WIDGET),
this.view.on("key-down",m=>{m.key!==t.SKETCH_KEYS.snappingToggle||m.repeat?m.key===t.SKETCH_KEYS.undo&&g&&g.canUndo()?(m.stopPropagation(),g.undo()):m.key===t.SKETCH_KEYS.redo&&g&&g.canRedo()?(m.stopPropagation(),g.redo()):m.key===t.SKETCH_KEYS.cancel&&g&&g.cancel():(this.snappingOptions.enabledToggled=!0,m.stopPropagation())},y.ViewEventPriorities.WIDGET),this.view.on("key-up",m=>{m.key===t.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,m.stopPropagation())},y.ViewEventPriorities.WIDGET)];
if("polygon"===a){const m=(f,p,u)=>{if(!f||!f.layer||!f.visible)return!1;f=this.view.toScreen(f.geometry);return this._isWithinScreenDistance(f,p,u)},k=f=>{if(!(2>=this._vertexGraphics.length))return m(this._vertexGraphics[0],f,this._getVertexIntersectDistance())};let l=!1;n.push(this.view.on("pointer-move",()=>{l=!1},y.ViewEventPriorities.WIDGET),this.view.on("pointer-down",f=>{k(f)?(l=!0,f.stopPropagation()):this._vertexGraphics.some(p=>m(p,f,this._getVertexIntersectDistance()))&&f.stopPropagation()},
y.ViewEventPriorities.WIDGET),this.view.on("pointer-up",f=>{l&&(f.stopPropagation(),e.complete())}))}const g=this._operationHandleForCreateAction(e,[...b,...n],a);return g});return function(a,b){return d.apply(this,arguments)}}();q._setupCreateCircleOperation=function(){var d=z._asyncToGenerator(function*(a,b){const c=yield P.loadCreateUtils(),e=this._draw.create(a,{...b,elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0});let h=!1,n=!0;b=[e.on("vertex-add",
k=>{const {type:l,vertexIndex:f,vertices:p}=k;k=p[f];this._drawSegmentGraphic(c,a,p,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem);this.emit("create",{graphic:this.createGraphic,state:1===p.length?"start":"active",tool:a,toolEventInfo:{added:k,vertices:[{coordinates:k,componentIndex:0,vertexIndex:f}],type:l},type:"create"})}),e.on("cursor-update",k=>{const {type:l,vertices:f}=k;this._drawSegmentGraphic(c,a,f,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem);2===f.length&&
this.emit("create",{graphic:this.createGraphic,state:"active",tool:a,toolEventInfo:{coordinates:f[f.length-1],type:l},type:"create"})}),e.on("draw-complete",k=>{k=k.vertices.slice(0);1===k.length?(k.push(e.viewAlignedCoordinateSystem.makeMapPoint(k[0][0]+this._defaultSegmentOffset*this.view.resolution,k[0][1])),k=c.createCircle(k,e.viewAlignedCoordinateSystem,!0,this.view.resolution)):k=h?c.createEllipse(k,e.viewAlignedCoordinateSystem,n):c.createCircle(k,e.viewAlignedCoordinateSystem,n,this.view.resolution);
this.createGraphic?this.createGraphic.geometry=k:(this._removeCreateGraphic(),this._set("createGraphic",new E(k,this.polygonSymbol)));m&&m.complete()})];const g=[this.view.on("pointer-move",k=>{r.isSome(e.getCoordsFromScreenPoint(N.createScreenPoint(k.x,k.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()},y.ViewEventPriorities.WIDGET),this.view.on("key-down",k=>{k.key===t.SKETCH_KEYS.constraint?h||(h=!0,this._drawSegmentGraphic(c,a,e.vertices,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem)):
k.key===t.SKETCH_KEYS.center?n&&(n=!1,this._drawSegmentGraphic(c,a,e.vertices,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem)):k.key===t.SKETCH_KEYS.cancel&&m&&m.cancel()},y.ViewEventPriorities.WIDGET),this.view.on("key-up",k=>{k.key===t.SKETCH_KEYS.constraint?(h=!1,this._drawSegmentGraphic(c,a,e.vertices,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem)):k.key===t.SKETCH_KEYS.center&&(n=!0,this._drawSegmentGraphic(c,a,e.vertices,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem))},
y.ViewEventPriorities.WIDGET)],m=this._operationHandleForCreateAction(e,[...b,...g],a);return m});return function(a,b){return d.apply(this,arguments)}}();q._setupCreateRectangleOperation=function(){var d=z._asyncToGenerator(function*(a,b){const c=yield P.loadCreateUtils(),e=this._draw.create(a,{...b,elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0});let h=!1,n=!1;b=[e.on("vertex-add",k=>{const {type:l,vertexIndex:f,vertices:p}=k;k=p[f];this._drawSegmentGraphic(c,
a,p,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem);this.emit("create",{graphic:this.createGraphic,state:1===p.length?"start":"active",tool:a,toolEventInfo:{added:k,vertices:[{coordinates:k,componentIndex:0,vertexIndex:f}],type:l},type:"create"})}),e.on("cursor-update",k=>{const {type:l,vertices:f}=k;this._drawSegmentGraphic(c,a,f,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem);2===f.length&&this.emit("create",{graphic:this.createGraphic,state:"active",tool:a,toolEventInfo:{coordinates:f[f.length-
1],type:l},type:"create"})}),e.on("draw-complete",k=>{k=k.vertices.slice(0);let l=null;1===k.length&&(n=h=!1);l=h?c.createSquare(k,e.viewAlignedCoordinateSystem,n):c.createRectangle(k,e.viewAlignedCoordinateSystem,n);this.createGraphic?this.createGraphic.geometry=l:(this._removeCreateGraphic(),this._set("createGraphic",new E(l,this.polygonSymbol)));m&&m.complete()})];const g=[this.view.on("pointer-move",k=>{r.isSome(e.getCoordsFromScreenPoint(N.createScreenPoint(k.x,k.y)))?this._displayCrosshairCursor():
this._displayDefaultCursor()},y.ViewEventPriorities.WIDGET),this.view.on("key-down",k=>{k.key===t.SKETCH_KEYS.constraint?h||(h=!0,this._drawSegmentGraphic(c,a,e.vertices,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem)):k.key===t.SKETCH_KEYS.center?n||(n=!0,this._drawSegmentGraphic(c,a,e.vertices,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem)):k.key===t.SKETCH_KEYS.cancel&&m&&m.cancel()},y.ViewEventPriorities.WIDGET),this.view.on("key-up",k=>{k.key===t.SKETCH_KEYS.constraint?
(h=!1,this._drawSegmentGraphic(c,a,e.vertices,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem)):k.key===t.SKETCH_KEYS.center&&(n=!1,this._drawSegmentGraphic(c,a,e.vertices,{centered:n,constrainToggle:h},e.viewAlignedCoordinateSystem))},y.ViewEventPriorities.WIDGET)],m=this._operationHandleForCreateAction(e,[...b,...g],a);return m});return function(a,b){return d.apply(this,arguments)}}();q._setupUpdateOperation=function(){var d=z._asyncToGenerator(function*(a,b){const {layer:c,view:e}=
this;b={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...b,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...null==b?void 0:b.reshapeOptions}};var h=b.tool;for(var n of a)c.remove(n),c.add(n);if("3d"===e.type){if(0===a.length)return null;switch(h){case "move":return this._setupMove3DOperation(a,b,e,h);case "reshape":if(1<a.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;h=O.isSupportedGraphic(a[0]);if(0===
h)return this._setupReshape3DOperation(a[0],b,e);this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${V.isSupportedGraphicResultMessage(h)}).`);return null;case "transform":return this._setupGraphicTransform3DOperation(a,b,e)}}switch(h){case "move":return this._setupMoveOperation(a,b,e);case "reshape":if(1<a.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;n=O.isSupportedGraphic(a[0]);if(0===
n)return this._setupTransformOrReshapeOperation(a,h,b,e);this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${V.isSupportedGraphicResultMessage(n)}).`);return null;case "transform":return this._setupTransformOrReshapeOperation(a,1===a.length&&"point"===r.get(a[0].geometry,"type")?"reshape":h,b,e)}});return function(a,b){return d.apply(this,arguments)}}();q._setupMove3DOperation=function(){var d=z._asyncToGenerator(function*(a,b,c,e,h=!1){var n=this;for(var g of a){const f=
oa.isSupportedGraphic(g);if(0!==f)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${V.isSupportedGraphicResultMessage(f)}).`),null}g=yield this._requireModule(new Promise(function(f,p){G(["../../views/3d/interactive/editingTools"],f,p)}));if(C(g))return g;const m=new g.module.GraphicMoveTool({view:c,enableZ:b.enableZ,snappingManager:this._snappingManager});this.view.tools.add(m);m.graphics.addMany(a);h||this.updateGraphics.addMany(a);const k=[],l=new J.OperationHandle({activeComponent:m,
tool:e,type:"update",onEnd:()=>{var f;k.forEach(p=>p.remove());k.length=0;null==(f=this.view.tools)?void 0:f.remove(m);m.destroyed||m.destroy()},undo:()=>{S(l,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:e})},redo:()=>{T(l,this.updateGraphics.toArray());this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:e})},addToSelection:f=>{this.updateGraphics.push(f);m.graphics.push(f);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",
aborted:!1,tool:this.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:f=>{const p=this.updateGraphics.indexOf(f);l.history.undo.forEach(u=>u.updates.splice(p,1));l.history.redo.forEach(u=>u.updates.splice(p,1));this.updateGraphics.remove(f);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[f],type:"selection-change"},type:"update"});0===this.updateGraphics.length?
l.complete():m.graphics.remove(f)},toggleTool:function(){var f=z._asyncToGenerator(function*(){if(1===n.updateGraphics.length&&!1!==b.toggleToolOnClick&&"transform"===e){var p=n.updateGraphics.getItemAt(0);0===O.isSupportedGraphic(p)&&(p=yield n._setupReshape3DOperation(p,b,c,!0),C(p)||(l.onEnd(),l.destroy(),n._setUpdateOperationHandle(p,b)))}});return function(){return f.apply(this,arguments)}}()});k.push(...this._getHandlesForComponent(l,b),this.view.on("immediate-click",f=>this._getCommonUpdateOperationClickHandlers(l,
f,b),y.ViewEventPriorities.WIDGET),c.on("key-down",f=>{this._getCommonUpdateOperationKeyDownHandlers(l,f);f.key===t.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,f.stopPropagation())},y.ViewEventPriorities.WIDGET),c.on("key-up",f=>{f.key===t.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,f.stopPropagation())},y.ViewEventPriorities.WIDGET));return l});return function(a,b,c,e){return d.apply(this,arguments)}}();q._setupGraphicTransform3DOperation=function(d,
a,b,c=!1){if(1===d.length&&0===pa.isSupportedGraphic(d[0])){const e=d[0],h=e.geometry;if(r.isSome(h)&&("point"===h.type||"mesh"===h.type))return this._setupPointTransform3DOperation(e,a,b);if(r.isSome(h)&&("polygon"===h.type||"polyline"===h.type))return this._setupPolyTransform3DOperation(e,a,b,c)}return this._setupMove3DOperation(d,a,b,"transform",c)};q._setupPointTransform3DOperation=function(){var d=z._asyncToGenerator(function*(a,b,c){var e=this;const {enableRotation:h,enableScaling:n,enableZ:g}=
b,m=yield this._requireModule(new Promise(function(p,u){G(["../../views/3d/interactive/editingTools"],p,u)}));if(C(m))return m;const k=new m.module.GraphicTransformTool({graphic:a,view:c,enableRotation:h,enableScaling:n,enableZ:g,snappingManager:this._snappingManager});this.view.tools.add(k);this.updateGraphics.add(a);const l=[],f=new J.OperationHandle({activeComponent:k,tool:"transform",type:"update",onEnd:()=>{var p;l.forEach(u=>u.remove());l.length=0;null==(p=this.view.tools)?void 0:p.remove(k);
k.destroyed||k.destroy()},undo:()=>{S(f,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},redo:()=>{T(f,this.updateGraphics.toArray());this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},addToSelection:function(){var p=z._asyncToGenerator(function*(u){e.updateGraphics.add(u);e.emit("update",{graphics:e.updateGraphics.toArray(),state:"active",aborted:!1,tool:e.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},
type:"update"});u=yield e._setupMove3DOperation(e.updateGraphics.toArray(),b,c,"transform",!0);C(u)||(f.onEnd(),f.destroy(),e._setUpdateOperationHandle(u,b))});return function(u){return p.apply(this,arguments)}}(),removeFromSelection:p=>{this.updateGraphics.remove(p);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"});f.complete()},toggleTool:()=>{}});l.push(...this._getHandlesForComponent(f,
b),this.view.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(f,p,b),y.ViewEventPriorities.WIDGET),c.on("key-down",p=>{this._getCommonUpdateOperationKeyDownHandlers(f,p);p.key===t.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,p.stopPropagation())},y.ViewEventPriorities.WIDGET),c.on("key-up",p=>{p.key===t.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,p.stopPropagation())},y.ViewEventPriorities.WIDGET));return f});return function(a,b,c){return d.apply(this,
arguments)}}();q._setupPolyTransform3DOperation=function(){var d=z._asyncToGenerator(function*(a,b,c,e=!1){var h=this;const {enableRotation:n,enableScaling:g,enableZ:m,preserveAspectRatio:k}=b,l=yield this._requireModule(new Promise(function(v,B){G(["../../views/3d/interactive/editingTools"],v,B)}));if(C(l))return l;const f=new l.module.ExtentTransformTool({graphic:a,view:c,enableRotation:n,enableScaling:g,enableZ:m,preserveAspectRatio:k});this.view.tools.add(f);e||this.updateGraphics.add(a);const p=
[],u=new J.OperationHandle({activeComponent:f,tool:"transform",type:"update",onEnd:()=>{var v;p.forEach(B=>B.remove());p.length=0;null==(v=this.view.tools)?void 0:v.remove(f);f.destroyed||f.destroy()},canUndo:()=>f.canUndo,undo:()=>{f.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},canRedo:()=>f.canRedo,redo:()=>{f.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},addToSelection:function(){var v=z._asyncToGenerator(function*(B){h.updateGraphics.add(B);
h.emit("update",{graphics:h.updateGraphics.toArray(),state:"active",aborted:!1,tool:h.activeTool,toolEventInfo:{added:[B],removed:[],type:"selection-change"},type:"update"});B=yield h._setupMove3DOperation(h.updateGraphics.toArray(),b,c,"transform",!0);C(B)||(u.onEnd(),u.destroy(),h._setUpdateOperationHandle(B,b))});return function(B){return v.apply(this,arguments)}}(),removeFromSelection:v=>{this.updateGraphics.remove(v);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,
tool:this.activeTool,toolEventInfo:{added:[],removed:[v],type:"selection-change"},type:"update"});u.complete()},toggleTool:function(){var v=z._asyncToGenerator(function*(){if(1===h.updateGraphics.length&&!1!==b.toggleToolOnClick){var B=h.updateGraphics.getItemAt(0);0===O.isSupportedGraphic(B)&&(B=yield h._setupReshape3DOperation(B,b,c,!0),C(B)||(u.onEnd(),u.destroy(),h._setUpdateOperationHandle(B,b)))}});return function(){return v.apply(this,arguments)}}()});p.push(...this._getHandlesForComponent(u,
b),this.view.on("immediate-click",v=>this._getCommonUpdateOperationClickHandlers(u,v,b),y.ViewEventPriorities.WIDGET),this.view.on("key-down",v=>this._getCommonUpdateOperationKeyDownHandlers(u,v),y.ViewEventPriorities.WIDGET),this.view.on("key-down",v=>{v.key!==t.SKETCH_KEYS.constraint||v.repeat||(f.preserveAspectRatio=!f.preserveAspectRatio,v.stopPropagation())},y.ViewEventPriorities.WIDGET),this.view.on("key-up",v=>{v.key===t.SKETCH_KEYS.constraint&&(f.preserveAspectRatio=!f.preserveAspectRatio,
v.stopPropagation())},y.ViewEventPriorities.WIDGET));return u});return function(a,b,c){return d.apply(this,arguments)}}();q._setupMoveOperation=function(){var d=z._asyncToGenerator(function*(a,b,c){this.updateGraphics.addMany(a);const e=yield this._getGraphicMover(a,b,c);if(C(e))return e;const h=new J.OperationHandle({activeComponent:e,tool:"move",type:"update",onEnd:()=>{var k;this._displayDefaultCursor();m.forEach(l=>l.remove());g.forEach(l=>l.remove());m=[];g=[];e.destroy();null==(k=this._internalGraphicsLayer)?
void 0:k.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const k=this.updateGraphics.toArray();S(h,k);h.refreshComponent();this._emitUndoEvent({graphics:k,tool:"move"})},redo:()=>{const k=this.updateGraphics.toArray();T(h,k);h.refreshComponent();this._emitRedoEvent({graphics:k,tool:"move"})},addToSelection:k=>{this.updateGraphics.push(k);e.graphics=this.updateGraphics.toArray();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[k],
removed:[],type:"selection-change"},type:"update"})},removeFromSelection:k=>{const l=this.updateGraphics.indexOf(k);h.history.undo.forEach(p=>p.updates.splice(l,1));h.history.redo.forEach(p=>p.updates.splice(l,1));this.updateGraphics.remove(k);const f=this.updateGraphics.toArray();this.emit("update",{graphics:f,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[k],type:"selection-change"},type:"update"});0===this.updateGraphics.length?h.complete():e.graphics=f}});let n=
!1,g=[c.on("immediate-click",k=>this._getCommonUpdateOperationClickHandlers(h,k,b),y.ViewEventPriorities.WIDGET),c.on("key-down",k=>{this._getCommonUpdateOperationKeyDownHandlers(h,k);k.key!==t.SKETCH_KEYS.constraint||k.repeat||(n=!0,e.enableMoveAllGraphics=!e.enableMoveAllGraphics)},y.ViewEventPriorities.WIDGET),c.on("key-up",k=>{k.key===t.SKETCH_KEYS.constraint&&n&&(n=!1,e.enableMoveAllGraphics=!e.enableMoveAllGraphics)},y.ViewEventPriorities.WIDGET)],m=this._getHandlesForComponent(h,b);return h});
return function(a,b,c){return d.apply(this,arguments)}}();q._setupReshape3DOperation=function(){var d=z._asyncToGenerator(function*(a,b,c,e=!1){var h=this;const n=yield this._requireModule(new Promise(function(l,f){G(["../../views/3d/interactive/editingTools"],l,f)}));if(C(n))return n;this.snappingOptions.enabledToggled=!1;const g=new n.module.GraphicReshapeTool({view:c,graphic:a,enableZVertex:b.enableZ&&"move"===b.reshapeOptions.vertexOperation,enableZShape:b.enableZ&&"move"===b.reshapeOptions.shapeOperation,
enableMoveGraphic:"move"===b.reshapeOptions.shapeOperation||"move-xy"===b.reshapeOptions.shapeOperation,enableMidpoints:"split"===b.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===b.reshapeOptions.edgeOperation,snappingManager:this._snappingManager});c.tools.add(g);e||this.updateGraphics.add(a);const m=[],k=new J.OperationHandle({activeComponent:g,tool:"reshape",type:"update",onEnd:()=>{var l;m.forEach(f=>f.remove());m.length=0;null==(l=this.view.tools)?void 0:l.remove(g);g.destroyed||g.destroy()},
canUndo:()=>g.canUndo,undo:()=>{g.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"reshape"})},canRedo:()=>g.canRedo,redo:()=>{g.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"reshape"})},addToSelection:function(){var l=z._asyncToGenerator(function*(f){h.updateGraphics.add(f);h.emit("update",{graphics:h.updateGraphics.toArray(),state:"active",aborted:!1,tool:h.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"});
f=yield h._setupMove3DOperation(h.updateGraphics.toArray(),b,c,"transform",!0);C(f)||(k.onEnd(),k.destroy(),h._setUpdateOperationHandle(f,b))});return function(f){return l.apply(this,arguments)}}(),removeFromSelection:l=>{this.updateGraphics.remove(l);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"});k.complete()},toggleTool:function(){var l=z._asyncToGenerator(function*(){if(!1!==
b.toggleToolOnClick){var f=yield h._setupGraphicTransform3DOperation(h.updateGraphics.toArray(),b,c,!0);C(f)||(k.onEnd(),k.destroy(),h._setUpdateOperationHandle(f,b))}});return function(){return l.apply(this,arguments)}}()});m.push(...this._getHandlesForComponent(k,b),c.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(k,l,b),y.ViewEventPriorities.WIDGET),c.on("key-down",l=>{this._getCommonUpdateOperationKeyDownHandlers(k,l);l.key===t.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=
!0,l.stopPropagation())},y.ViewEventPriorities.WIDGET),c.on("key-up",l=>{l.key===t.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,l.stopPropagation())},y.ViewEventPriorities.WIDGET));return k});return function(a,b,c){return d.apply(this,arguments)}}();q._setupTransformOrReshapeOperation=function(){var d=z._asyncToGenerator(function*(a,b,c,e){var h=this;const {multipleSelectionEnabled:n}=c;this.updateGraphics.addMany(a);a="transform"===b?yield this._getBox(a,c,e):yield this._getReshape(a,
c,e);if(C(a))return a;const g=new J.OperationHandle({activeComponent:a,type:"update",onEnd:()=>{k.forEach(l=>l.remove());m.forEach(l=>l.remove());k=[];m=[];g.activeComponent&&!g.activeComponent.destroyed&&g.activeComponent.destroy();this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{S(g,this.updateGraphics.toArray());g.refreshComponent();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:g.tool})},redo:()=>{T(g,this.updateGraphics.toArray());g.refreshComponent();
this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:g.tool})},addToSelection:function(){var l=z._asyncToGenerator(function*(f){var p=g.activeComponent;if("reshape"===p.type){p=[...h.updateGraphics,f];h.updateGraphics.removeAll();p=yield h._setupMoveOperation(p,c,e);if(C(p))return;g.onEnd();g.destroy();h._setUpdateOperationHandle(p,c)}else h.updateGraphics.add(f),p.graphics=h.updateGraphics.toArray(),p.refresh(),g.resetHistory();h.emit("update",{graphics:h.updateGraphics.toArray(),state:"active",
aborted:!1,tool:h.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"})});return function(f){return l.apply(this,arguments)}}(),removeFromSelection:function(){var l=z._asyncToGenerator(function*(f){const p=h.updateGraphics.indexOf(f);g.history.undo.forEach(v=>v.updates.splice(p,1));g.history.redo.forEach(v=>v.updates.splice(p,1));h.updateGraphics.remove(f);const u=h.updateGraphics.toArray();0===u.length?g.complete():1===u.length&&r.isSome(u[0].geometry)&&"point"===
u[0].geometry.type?g.toggleTool():g.activeComponent.graphics=u;h.emit("update",{graphics:u,state:"active",aborted:!1,tool:h.activeTool,toolEventInfo:{added:[],removed:[f],type:"selection-change"},type:"update"})});return function(f){return l.apply(this,arguments)}}(),toggleTool:function(){var l=z._asyncToGenerator(function*(){if(!(1<h.updateGraphics.length)){var f=h.updateGraphics.getItemAt(0);if(!r.isSome(f.geometry)||!("transform"===g.tool&&"extent"===f.geometry.type||"reshape"===g.tool&&"point"===
f.geometry.type)){var p=null;"transform"===g.tool?p=yield h._getReshape([f],c,e):"reshape"===g.tool&&(p=yield h._getBox([f],c,e));C(p)||(g.activeComponent.destroy(),g.activeComponent=p,g.activeComponent&&(k.forEach(u=>u.remove()),k=h._getHandlesForComponent(g,c)))}}});return function(){return l.apply(this,arguments)}}()});let m=[e.on("immediate-click",function(){var l=z._asyncToGenerator(function*(f){var p;const u=yield f.async(()=>h._getFirstHit(W.createScreenPointFromEvent(f)));null!=(p=u.results)&&
p.length?u.results.some(v=>{if(v.graphic){var B;v=v.graphic;if(null!=(B=f.native)&&B.shiftKey&&n)return f.stopPropagation(),g.addToSelection(v),!0;if(v.layer===h.layer)return g.complete(),!0}return!1}):g.complete()});return function(f){return l.apply(this,arguments)}}(),y.ViewEventPriorities.WIDGET),e.on("key-down",l=>{this._getCommonUpdateOperationKeyDownHandlers(g,l);l.key!==t.SKETCH_KEYS.snappingToggle||l.repeat||(this.snappingOptions.enabledToggled=!0,l.stopPropagation());l.key===t.SKETCH_KEYS.constraint&&
!l.repeat&&g&&(l=g.activeComponent)&&"box"===l.type&&(l.preserveAspectRatio=!l.preserveAspectRatio)},y.ViewEventPriorities.WIDGET),e.on("key-up",l=>{var f;l.key===t.SKETCH_KEYS.snappingToggle&&"reshape"===(null==g?void 0:null==(f=g.activeComponent)?void 0:f.type)&&(this.snappingOptions.enabledToggled=!1,l.stopPropagation());l.key===t.SKETCH_KEYS.constraint&&g&&(l=g.activeComponent)&&"box"===l.type&&(l.preserveAspectRatio=!l.preserveAspectRatio)},y.ViewEventPriorities.WIDGET)],k=this._getHandlesForComponent(g,
c);return g});return function(a,b,c,e){return d.apply(this,arguments)}}();q._getGraphicMover=function(){var d=z._asyncToGenerator(function*(a,b,c){({enableMoveAllGraphics:b}=b);const e=yield this._requireModule(new Promise(function(h,n){G(["../../views/draw/support/GraphicMover"],function(g){h(R(g))},n)}));return C(e)?e:new e.module.default({enableMoveAllGraphics:b,graphics:a,view:c,callbacks:{onGraphicMoveStart:({dx:h,dy:n,graphic:g})=>{this._displayGrabbingCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),
state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:h,dy:n,mover:g,type:"move-start"},type:"update"})},onGraphicMove:({dx:h,dy:n,graphic:g})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:h,dy:n,mover:g,type:"move"},type:"update"}),onGraphicMoveStop:({dx:h,dy:n,graphic:g})=>{this._displayPointerCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{dx:h,dy:n,mover:g,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})});return function(a,b,c){return d.apply(this,arguments)}}();q._getBox=function(){var d=z._asyncToGenerator(function*(a,b,c){const {enableRotation:e,enableScaling:h,preserveAspectRatio:n}=b;b=yield this._requireModule(new Promise(function(g,m){G(["../../views/draw/support/Box"],function(k){g(R(k))},m)}));return C(b)?b:new b.module.default({graphics:a,
enableRotation:e,enableScaling:h,preserveAspectRatio:n,layer:this._internalGraphicsLayer,view:c,callbacks:{onMoveStart:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onMove:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onMoveStop:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",
aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onScaleStart:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onScale:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onScaleStop:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{...g},type:"update"}),onRotateStart:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onRotate:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onRotateStop:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"})}})});
return function(a,b,c){return d.apply(this,arguments)}}();q._getReshape=function(){var d=z._asyncToGenerator(function*(a,b,c){var e,h;const n="split"===(null==(e=b.reshapeOptions)?void 0:e.edgeOperation);b="move"===(null==(h=b.reshapeOptions)?void 0:h.shapeOperation);h=yield this._requireModule(new Promise(function(g,m){G(["../../views/draw/support/Reshape"],function(k){g(R(k))},m)}));return C(h)?h:new h.module.default({enableMidpoints:n,enableMovement:b,graphic:a[0],layer:this._internalGraphicsLayer,
snappingManager:this._snappingManager,view:c,callbacks:{onReshapeStart:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onReshape:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onReshapeStop:({mover:g,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{mover:g,type:m},type:"update"}),onMoveStart:({dx:g,dy:m,mover:k,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:g,dy:m,mover:k,type:l},type:"update"}),onMove:({dx:g,dy:m,mover:k,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:g,dy:m,mover:k,type:l},type:"update"}),onMoveStop:({dx:g,dy:m,mover:k,type:l})=>this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:g,dy:m,mover:k,type:l},type:"update"}),onVertexAdd:({added:g,type:m,vertices:k})=>{g=g.map(l=>Z.geometryToCoordinates(l.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:g,vertices:k,type:m},type:"update"})},onVertexRemove:({removed:g,type:m,vertices:k})=>{g=g.map(l=>Z.geometryToCoordinates(l.geometry));this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:g,vertices:k,type:m},type:"update"})}}})});return function(a,b,c){return d.apply(this,arguments)}}();q._getHandlesForComponent=function(d,a){const b=d.activeComponent;switch(b.type){case "graphic-mover":return[b.on("graphic-click",({graphic:c,viewEvent:e})=>{var h;null!=(h=e.native)&&h.shiftKey&&(e.stopPropagation(),d.removeFromSelection(c))}),b.on("graphic-move-start",c=>d.addToHistory(H(c.allGraphics)))];
case "box":return[b.on("graphic-click",c=>this._onTransformOrReshape2DGraphicClick(d,a,c)),b.on("move-start",c=>d.addToHistory(H(c.graphics))),b.on("rotate-start",c=>d.addToHistory(H(c.graphics))),b.on("scale-start",c=>d.addToHistory(H(c.graphics)))];case "reshape":return[b.on("graphic-click",c=>this._onTransformOrReshape2DGraphicClick(d,a,c)),b.on("move-start",c=>d.addToHistory(H([c.mover]))),b.on("reshape-start",c=>d.addToHistory(H([c.graphic]))),b.on("vertex-add",c=>d.addToHistory(H([c.oldGraphic]))),
b.on("vertex-remove",c=>d.addToHistory(H([c.oldGraphic])))];case "move-3d":return[b.on("graphic-move-start",c=>{d.addToHistory(H(c.allGraphics));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<c.allGraphics.length?c.allGraphics[0]:null,type:"move-start"},type:"update"})}),b.on("graphic-move",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:c.dx,
dy:c.dy,mover:0<c.allGraphics.length?c.allGraphics[0]:null,type:"move"},type:"update"})}),b.on("graphic-move-stop",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<c.allGraphics.length?c.allGraphics[0]:null,type:"move-stop"},type:"update"})}),b.on("immediate-click",c=>{c.shiftKey?this._toggleSelection([c.graphic],d,a):d.toggleTool()})];case "transform-3d":return[b.on("record-undo",({record:c})=>{d.addToHistory({updates:[c]})}),
b.on("graphic-translate-start",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,dx:c.dxScreen,dy:c.dyScreen,type:"move-start"},type:"update"})}),b.on("graphic-translate-stop",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,dx:c.dxScreen,dy:c.dyScreen,type:"move-stop"},type:"update"})}),b.on("graphic-rotate-start",c=>
{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,angle:c.angle,type:"rotate-start"},type:"update"})}),b.on("graphic-rotate-stop",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,angle:c.angle,type:"rotate-stop"},type:"update"})}),b.on("graphic-scale-start",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),
state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,xScale:c.xScale,yScale:c.yScale,type:"scale-start"},type:"update"})}),b.on("graphic-scale-stop",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,xScale:c.xScale,yScale:c.yScale,type:"scale-stop"},type:"update"})}),b.on("graphic-translate",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{mover:c.graphic,dx:c.dxScreen,dy:c.dyScreen,type:"move"},type:"update"})}),b.on("graphic-rotate",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,angle:c.angle,type:"rotate"},type:"update"})}),b.on("graphic-scale",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,xScale:c.xScale,yScale:c.yScale,type:"scale"},
type:"update"})}),b.on("immediate-click",c=>{c.shiftKey?this._toggleSelection([c.graphic],d,a):d.toggleTool()})];case "reshape-3d":return[b.on("reshape",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:c,type:"update"})}),b.on("move",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:c,type:"update"})}),b.on("vertex-add",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),
state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:c,type:"update"})}),b.on("vertex-remove",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:c,type:"update"})}),b.on("immediate-click",c=>{c.shiftKey?this._toggleSelection([c.graphic],d,a):d.toggleTool()})];case "draw":case "draw-3d":return null}};q._onTransformOrReshape2DGraphicClick=function(d,a,b){var c;const {graphic:e,viewEvent:h}=b;if(null!=(c=h.native)&&c.shiftKey)return h.stopPropagation(),
d.removeFromSelection(e);if(a.toggleToolOnClick)return h.stopPropagation(),d.toggleTool()};q._setUpdateOperationHandle=function(d,a){this._operationHandle=d;const b=this.view.map;this._disablePopup(a);d.on("complete",()=>{if(d===this._operationHandle){const c=this.updateGraphics.toArray(),e=this._operationHandle.tool;this._operationHandle.destroy();this._operationHandle=null;this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray());this.updateGraphics.removeAll();b&&b.remove(this._internalGraphicsLayer);
this._restorePopup(a);this.emit("update",{graphics:c,state:"complete",aborted:d.cancelled,tool:e,toolEventInfo:null,type:"update"})}})};q._getCommonUpdateOperationClickHandlers=function(){var d=z._asyncToGenerator(function*(a,b,c){const e=W.createScreenPointFromEvent(b),h=(yield b.async(()=>this._getFirstHit(e))).results;h.length?b.native.shiftKey&&this._toggleSelection(h.map(n=>n.graphic),a,c)?b.stopPropagation():h.some(n=>n.graphic&&this.updateGraphics.includes(n.graphic))?b.stopPropagation():a.complete():
a.complete()});return function(a,b,c){return d.apply(this,arguments)}}();q._toggleSelection=function(d,a,b){const c=!!b.multipleSelectionEnabled;return d.some(e=>null==e?!1:c&&e.layer===this.layer?(this.updateGraphics.includes(e)?a.removeFromSelection(e):a.addToSelection(e),!0):!1)};q._getCommonUpdateOperationKeyDownHandlers=function(d,a){if(d){var b=a.key;b===t.SKETCH_KEYS.undo&&d.canUndo()?(a.stopPropagation(),d.undo()):b===t.SKETCH_KEYS.redo&&d.canRedo()?(a.stopPropagation(),d.redo()):b===t.SKETCH_KEYS.cancel?
(a.stopPropagation(),d.cancel()):this.allowDeleteKey&&t.SKETCH_KEYS.delete.includes(b)&&this._onDeleteKey(a)}};q._onDeleteKey=function(d){if(this._operationHandle&&"update"===this._operationHandle.type){var a=this.activeComponent,b=this.updateGraphics.toArray();r.isNone(a)||"reshape-3d"===a.type||"reshape"===a.type&&(1!==b.length||"point"!==r.get(b[0].geometry,"type"))||(d.stopPropagation(),this.delete())}};q._drawMultipointGraphic=function(d,a,b){var c=null;!b&&1<a.length?(c=a.slice(0),c.pop(),c=
d.createMultipoint(c,this.view.spatialReference)):c=d.createMultipoint(a,this.view.spatialReference);this.createGraphic?this.createGraphic.geometry=c:this._set("createGraphic",new E(c,this.pointSymbol));b&&1===a.length&&this._internalGraphicsLayer.add(this.createGraphic)};q._drawVertexGraphics=function(d,a,b,c){if(b.length){var {_doUnnormalization:e,activeLineSymbol:h,activeVertexSymbol:n,polygonSymbol:g,polylineSymbol:m,vertexSymbol:k,view:{spatialReference:l}}=this,f=!(!c||!c.userClicked),p="polygon"===
a;c=p?g:m;if(1===b.length){this._removeLineGraphic();this._removeActiveLineGraphic();var u=this.createPointFromVertex(b[0]);b=p?d.createPolygon([b],l,e,!0):d.createPolyline([b],l,e);this._vertexGraphics.length?this._vertexGraphics[0].geometry=u:this._vertexGraphics.push(new E(u,n));this.createGraphic?this.createGraphic.set({geometry:b,symbol:c}):this._set("createGraphic",new E(b,c));f&&this._internalGraphicsLayer.add(this._vertexGraphics[0])}else if(2===b.length){var v=this.createPointFromVertex(b[1]);
u=d.createPolyline([b],l,e);d=p?d.createPolygon([b],l,e,!0):d.createPolyline([b],l,e);this._vertexGraphics.length||(b=this.createPointFromVertex(b[0]),b=new E(b,k),this._vertexGraphics.push(b));1===this._vertexGraphics.length?(b=this._vertexGraphics[0],v=new E(v,k),this._removeLineGraphic(),this._removeActiveFillGraphic(),this._vertexGraphics.push(v),this._internalGraphicsLayer.remove(b),this._internalGraphicsLayer.add(b)):this._vertexGraphics[1].geometry=v;this._showActiveLineGraphic(u);b=this._vertexGraphics[0];
f&&(this._activeLineGraphic.symbol=m,b.symbol=k,this._internalGraphicsLayer.add(this._vertexGraphics[1]));this.createGraphic?this.createGraphic.set({geometry:d,symbol:c}):this._set("createGraphic",new E(d,c));this._internalGraphicsLayer.remove(b);this._internalGraphicsLayer.add(b)}else if(2<b.length){v=p?d.createPolygon([b],l,e,!0):d.createPolyline([b],l,e);"polygon"===a&&this._showFillGraphic(v);p=b.map(va=>va.slice());a=p.pop();const B=[p[p.length-1],a];a=d.createPolyline([p],l,e);d=d.createPolyline([B],
l,e);this._showLineGraphic(a);this._showActiveLineGraphic(d);for(d=0;d<p.length;d++)(a=this._vertexGraphics[d])?a.symbol=f||d!==this._vertexGraphics.length-1?k:n:(a=this.createPointFromVertex(b[d]),this._showVertexGraphic(a));f?(this._activeLineGraphic.symbol=m,f=this.createPointFromVertex(b[b.length-1]),this._showVertexGraphic(f)):this._activeLineGraphic.symbol=h;this.createGraphic?this.createGraphic.set({geometry:v,symbol:c}):(this._removeCreateGraphic(),this._set("createGraphic",new E(v,c)));for(u of this._vertexGraphics)this._internalGraphicsLayer.remove(u),
this._internalGraphicsLayer.add(u)}}};q._drawSegmentGraphic=function(d,a,b,c,e){if(b.length){var h=!(null==c||!c.centered);c=!(null==c||!c.constrainToggle);var n;1===b.length?this._removeCenterIndicatorGraphic():("rectangle"===a?n=c?d.createSquare(b,e,h):d.createRectangle(b,e,h):"circle"===a&&(n=c?d.createEllipse(b,e,h):d.createCircle(b,e,h,this.view.resolution)),r.isSome(n)&&n.extent&&n.extent.center&&this._showCenterIndicatorGraphic(n.extent.center));n?this.createGraphic?this.createGraphic.geometry=
n:(this._removeCreateGraphic(),this._set("createGraphic",new E(n,this.polygonSymbol)),this._internalGraphicsLayer.add(this.createGraphic)):this._removeCreateGraphic()}};q._showCenterIndicatorGraphic=function(d){this._centerIndicatorGraphic?this._centerIndicatorGraphic.geometry=d:(this._centerIndicatorGraphic=new E(d,this._centerSymbol),this._internalGraphicsLayer.add(this._centerIndicatorGraphic))};q._removeCenterIndicatorGraphic=function(){this._centerIndicatorGraphic&&(this._internalGraphicsLayer.remove(this._centerIndicatorGraphic),
this._centerIndicatorGraphic.destroy(),this._centerIndicatorGraphic=null)};q._showActiveLineGraphic=function(d){this._activeLineGraphic?(this._activeLineGraphic.set({geometry:d,symbol:this.activeLineSymbol}),this._internalGraphicsLayer.remove(this._activeLineGraphic)):this._activeLineGraphic=new E(d,this.activeLineSymbol);this._internalGraphicsLayer.add(this._activeLineGraphic)};q._showFillGraphic=function(d){this._activeFillGraphic?(this._activeFillGraphic.set({geometry:d,symbol:this.activeFillSymbol}),
this._internalGraphicsLayer.remove(this._activeFillGraphic)):this._activeFillGraphic=new E(d,this.activeFillSymbol);this._internalGraphicsLayer.add(this._activeFillGraphic)};q._showLineGraphic=function(d){this._lineGraphic?(this._lineGraphic.set({geometry:d,symbol:this.polylineSymbol}),this._internalGraphicsLayer.remove(this._lineGraphic)):this._lineGraphic=new E(d,this.polylineSymbol);this._internalGraphicsLayer.add(this._lineGraphic)};q._showVertexGraphic=function(d,a){d=new E(d,a?this.activeVertexSymbol:
this.vertexSymbol);this._vertexGraphics.push(d);this._internalGraphicsLayer.add(d)};q._resetCreateOperationGraphics=function(){this._removeActiveFillGraphic();this._removeLineGraphic();this._removeActiveLineGraphic();this._removeVertexGraphics()};q._removeCreateGraphic=function(){this.createGraphic&&(this._internalGraphicsLayer.remove(this.createGraphic),this._set("createGraphic",null))};q._removeCreateOperationGraphics=function(){this._removeCenterIndicatorGraphic();this._removeActiveLineGraphic();
this._removeActiveFillGraphic();this._removeLineGraphic();this._removeVertexGraphics()};q._removeActiveLineGraphic=function(){this._activeLineGraphic&&(this._internalGraphicsLayer.remove(this._activeLineGraphic),this._activeLineGraphic.destroy(),this._activeLineGraphic=null)};q._removeActiveFillGraphic=function(){this._activeFillGraphic&&(this._internalGraphicsLayer.remove(this._activeFillGraphic),this._activeFillGraphic.destroy(),this._activeFillGraphic=null)};q._removeLineGraphic=function(){this._lineGraphic&&
(this._internalGraphicsLayer.remove(this._lineGraphic),this._lineGraphic.destroy(),this._lineGraphic=null)};q._removeVertexGraphics=function(){this._vertexGraphics.length&&(this._internalGraphicsLayer.removeMany(this._vertexGraphics),this._vertexGraphics.forEach(d=>d.destroy()),this._vertexGraphics=[])};q._removeDefaultLayer=function(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer.destroy(),this._internalGraphicsLayer=
null)};q._operationHandleForCreateAction=function(d,a,b){return new J.OperationHandle({activeComponent:this._draw,tool:b,type:"create",onEnd:()=>{a.forEach(c=>c.remove());a.length=0;this._removeCreateOperationGraphics();this._internalGraphicsLayer&&this._internalGraphicsLayer.remove(this.createGraphic);this._displayDefaultCursor()},undo:()=>{d.undo();this._emitUndoEvent({graphics:[this.createGraphic],tool:b})},redo:()=>{d.redo();this._emitRedoEvent({graphics:[this.createGraphic],tool:b})},canUndo:()=>
d&&d.canUndo(),canRedo:()=>d&&d.canRedo()})};q._isComponentGraphic=function(d){const {activeComponent:a}=this;return!d||r.isNone(a)?!1:d.attributes&&d.attributes.esriSketchTool?!0:("box"===a.type||"reshape"===a.type)&&a.isUIGraphic(d)};q._snapLastPolygonVertexToFirst=function(d,a){if(!("polygon"!==d&&2>=a.length)){d=a[0];a=a[a.length-1];var b=this.view.toScreen(new Q(d[0],d[1],this.view.spatialReference)),c=this.view.toScreen(new Q(a[0],a[1],this.view.spatialReference));this._isWithinScreenDistance(b,
c,this._getVertexIntersectDistance())&&(a[0]=d[0],a[1]=d[1])}};q._getVertexIntersectDistance=function(){return this.vertexSymbol&&"simple-marker"===this.vertexSymbol.type?N.pt2px(this.vertexSymbol.size)/2+3:3};q._isWithinScreenDistance=function(d,a,b){const c=d.x-a.x;d=d.y-a.y;return Math.sqrt(c*c+d*d)<=b};q._displayPointerCursor=function(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")};q._displayGrabbingCursor=function(){this.view&&this.view.container&&
"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")};q._displayCrosshairCursor=function(){this.view&&this.view.container&&"crosshair"!==this.view.cursor&&(this.view.cursor="crosshair")};q._displayDefaultCursor=function(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)};q._logError=function(d,a,b){ua.error(new ha(d,a,b))};q._requireModule=function(){var d=z._asyncToGenerator(function*(a){const b=new AbortController;this._moduleLoaderAbortController=b;a=yield a;
return this._moduleLoaderAbortController!==b||b.signal.aborted?{requireError:"aborted"}:{module:a}});return function(a){return d.apply(this,arguments)}}();q._emitUndoEvent=function(d){this.emit("undo",{...d,type:"undo"})};q._emitRedoEvent=function(d){this.emit("redo",{...d,type:"redo"})};q._emitDeleteEvent=function(d){this.emit("delete",{...d,type:"delete"})};q.createPointFromVertex=function(d){return 2<d.length?new Q(d[0],d[1],d[2],this.view.spatialReference):new Q(d[0],d[1],this.view.spatialReference)};
q.test=function(){return{operationHandle:this._operationHandle,defaultUpdateOptions:U}};q.wait=function(){return I.whenNotOnce(this,"updating")};q._beginAsyncOperation=function(){this._numUpdating+=1;this.notifyChange("updating")};q._endAsyncOperation=function(){--this._numUpdating;this.notifyChange("updating")};q._disablePopupEnabled=function(d){var a;return"3d"!==(null==(a=this.view)?void 0:a.type)||this.updateOnGraphicClick||r.isSome(d)&&d.toggleToolOnClick};q._disablePopup=function(d){this._disablePopupEnabled(d)&&
(d=this.view.popup)&&r.isNone(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=d.autoOpenEnabled,d.autoOpenEnabled=!1)};q._restorePopup=function(d){this._disablePopupEnabled(d)&&(d=this.view.popup)&&r.isSome(this._originalAutoOpenEnabled)&&(d.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)};q._waitViewReady=function(){var d=z._asyncToGenerator(function*(){this.view&&(r.abortMaybe(this._viewReadyAbortController),this._viewReadyAbortController=M.createAbortController(),
yield M.whenOrAbort(I.whenOnce(this.view,"ready"),this._viewReadyAbortController.signal))});return function(){return d.apply(this,arguments)}}();z._createClass(F,[{key:"_defaultUpdateTool",get:function(){return"3d"===this.view.type?"move":"transform"}},{key:"_draw",get:function(){return"ready"===this.state||"active"===this.state?new qa({view:this.view}):null}},{key:"updating",get:function(){return 0<this._numUpdating}},{key:"activeTool",get:function(){return this._operationHandle&&this._operationHandle.tool?
this._operationHandle.tool:null}},{key:"activeComponent",get:function(){return this._operationHandle?this._operationHandle.activeComponent:null}},{key:"createGraphic",get:function(){return this.view&&"3d"===this.view.type&&r.isSome(this.activeComponent)&&"draw-3d"===this.activeComponent.type?r.unwrap(this.activeComponent.createGraphic):this._get("createGraphic")}},{key:"defaultCreateOptions",set:function(d){this._set("defaultCreateOptions",{...ea,...d})}},{key:"defaultUpdateOptions",set:function(d){this._set("defaultUpdateOptions",
{...U,...d,reshapeOptions:{...U.reshapeOptions,...null==d?void 0:d.reshapeOptions}})}},{key:"snappingOptions",set:function(d){r.isSome(this._snappingManager)&&(this._snappingManager.options=d);this._set("snappingOptions",d)}},{key:"state",get:function(){var d;const a=!(null==(d=this.view)||!d.ready||!this.layer);d=this._operationHandle;return a&&d?"active":a?"ready":"disabled"}},{key:"view",get:function(){return this._get("view")},set:function(d){const a=this._get("view");if(a){const {container:b,
map:c}=a;b&&(a.cursor=null);c&&c.remove(this._internalGraphicsLayer);this._viewHandles.removeAll();this.cancel()}this._doUnnormalization=null!=d&&"3d"===d.type&&"global"===d.viewingMode;this._handles.remove("view-ready");d&&this._handles.add(I.when(d,"ready",b=>{this._viewHandles.removeAll();b&&this._viewHandles.add(this._generateViewHandles(d))},!0),"view-ready");this._set("view",d)}}]);return F}(ia.EventedAccessor);x.__decorate([A.property({readOnly:!0})],w.prototype,"_draw",null);x.__decorate([A.property()],
w.prototype,"updating",null);x.__decorate([A.property()],w.prototype,"_operationHandle",void 0);x.__decorate([A.property({readOnly:!0})],w.prototype,"activeTool",null);x.__decorate([A.property()],w.prototype,"activeFillSymbol",void 0);x.__decorate([A.property()],w.prototype,"activeLineSymbol",void 0);x.__decorate([A.property()],w.prototype,"activeVertexSymbol",void 0);x.__decorate([A.property()],w.prototype,"allowDeleteKey",void 0);x.__decorate([A.property({readOnly:!0})],w.prototype,"createGraphic",
null);x.__decorate([A.property()],w.prototype,"defaultCreateOptions",null);x.__decorate([A.property()],w.prototype,"defaultUpdateOptions",null);x.__decorate([A.property()],w.prototype,"layer",void 0);x.__decorate([A.property({types:K.symbolTypes})],w.prototype,"pointSymbol",void 0);x.__decorate([A.property({types:K.symbolTypes})],w.prototype,"polygonSymbol",void 0);x.__decorate([A.property({types:K.symbolTypes})],w.prototype,"polylineSymbol",void 0);x.__decorate([A.property({type:ba,nonNullable:!0})],
w.prototype,"snappingOptions",null);x.__decorate([A.property()],w.prototype,"_snappingManager",void 0);x.__decorate([A.property({readOnly:!0})],w.prototype,"state",null);x.__decorate([A.property({readOnly:!0})],w.prototype,"updateGraphics",void 0);x.__decorate([A.property()],w.prototype,"updateOnGraphicClick",void 0);x.__decorate([A.property({types:K.symbolTypes})],w.prototype,"updatePointSymbol",void 0);x.__decorate([A.property({types:K.symbolTypes})],w.prototype,"updatePolygonSymbol",void 0);x.__decorate([A.property({types:K.symbolTypes})],
w.prototype,"updatePolylineSymbol",void 0);x.__decorate([A.property({types:K.symbolTypes})],w.prototype,"vertexSymbol",void 0);x.__decorate([A.property({value:null})],w.prototype,"view",null);x.__decorate([A.property()],w.prototype,"cancel",null);x.__decorate([A.property()],w.prototype,"complete",null);x.__decorate([A.property()],w.prototype,"delete",null);x.__decorate([A.property()],w.prototype,"create",null);x.__decorate([A.property()],w.prototype,"update",null);x.__decorate([A.property()],w.prototype,
"undo",null);x.__decorate([A.property()],w.prototype,"redo",null);x.__decorate([A.property()],w.prototype,"canUndo",null);x.__decorate([A.property()],w.prototype,"canRedo",null);x.__decorate([A.property()],w.prototype,"toggleUpdateTool",null);return w=x.__decorate([ka.subclass("esri.widgets.Sketch.SketchViewModel")],w)});