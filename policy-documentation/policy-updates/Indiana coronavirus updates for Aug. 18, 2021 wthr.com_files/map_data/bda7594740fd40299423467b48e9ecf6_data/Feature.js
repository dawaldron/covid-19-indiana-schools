// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("./Dictionary ./ImmutableArray ../chunks/languageUtils ../geometry/Geometry ../geometry/Point ../geometry/support/jsonUtils ./featureset/support/shared ../layers/graphics/featureConversionUtils ../core/maybe".split(" "),function(p,l,h,q,t,m,r,u,n){return function(){function g(){this.declaredClass="esri.arcade.Feature";this._layer=this.attributes=this._geometry=this._optimizedGeomDefinition=null;this.immutable=this._datesfixed=!0;this._datefields=null;this.immutable=!0}g.createFromGraphic=function(a){const b=
new g;b._geometry=n.isSome(a.geometry)?a.geometry:null;b.attributes=void 0===a.attributes?{}:null===a.attributes?{}:a.attributes;a._sourceLayer?(b._layer=a._sourceLayer,b._datesfixed=!1):a._layer?(b._layer=a._layer,b._datesfixed=!1):a.layer&&"fields"in a.layer?(b._layer=a.layer,b._datesfixed=!1):a.sourceLayer&&"fields"in a.sourceLayer&&(b._layer=a.sourceLayer,b._datesfixed=!1);return b};g.createFromArcadeFeature=function(a){const b=new g;b._datesfixed=a._datesfixed;b.attributes=a.attributes;b._geometry=
a._geometry;b._optimizedGeomDefinition=a._optimizedGeomDefinition;a._layer&&(b._layer=a._layer);return b};g.createFromOptimisedFeature=function(a,b,c){const d=new g;d._geometry=a.geometry?{geometry:a.geometry}:null;d._optimizedGeomDefinition=c;d.attributes=a.attributes||{};d._layer=b;d._datesfixed=!1;return d};g.createFromArcadeDictionary=function(a){const b=new g;b.attributes=a.field("attributes");null!==b.attributes?b.attributes instanceof p?(b.attributes=b.attributes.attributes,null===b.attributes&&
(b.attributes={})):b.attributes={}:b.attributes={};b._geometry=a.field("geometry");null!==b._geometry&&(b._geometry instanceof p?b._geometry=g.parseGeometryFromDictionary(b._geometry):b._geometry instanceof q||(b._geometry=null));return b};g.createFromGraphicLikeObject=function(a,b,c=null){const d=new g;null===b&&(b={});d.attributes=b;d._geometry=n.isSome(a)?a:null;d._layer=c;d._layer&&(d._datesfixed=!1);d._adapter=null;return d};var k=g.prototype;k.repurposeFromGraphicLikeObject=function(a,b,c=null){null===
b&&(b={});this.attributes=b;this._geometry=a?a:null;this._datesfixed=(this._layer=c)?!1:!0};k.repurposeFromAdapter=function(a,b=null){this._adapter=a;this._layer=b};k.castToText=function(){if(this._adapter)return this._adapter.castToText();let a="";!1===this._datesfixed&&this._fixDates();for(const b in this.attributes){""!==a&&(a+=",");const c=this.attributes[b];null==c?a+=JSON.stringify(b)+":null":h.isBoolean(c)||h.isNumber(c)||h.isString(c)?a+=JSON.stringify(b)+":"+JSON.stringify(c):c instanceof
q?a+=JSON.stringify(b)+":"+h.toStringExplicit(c):c instanceof l?a+=JSON.stringify(b)+":"+h.toStringExplicit(c):c instanceof Array?a+=JSON.stringify(b)+":"+h.toStringExplicit(c):c instanceof Date?a+=JSON.stringify(b)+":"+JSON.stringify(c):null!==c&&"object"===typeof c&&void 0!==c.castToText&&(a+=JSON.stringify(b)+":"+c.castToText())}return'{"geometry":'+(null===this.geometry()?"null":h.toStringExplicit(this.geometry()))+',"attributes":{'+a+"}}"};k._fixDates=function(){if(null!==this._datefields)0<
this._datefields.length&&this._fixDateFields(this._datefields);else{var a=[];for(let b=0;b<this._layer.fields.length;b++){const c=this._layer.fields[b];"date"!==c.type&&"esriFieldTypeDate"!==c.type||a.push(c.name)}this._datefields=a;0<a.length&&this._fixDateFields(a)}this._datesfixed=!0};k._fixDateFields=function(a){this.attributes={...this.attributes};for(let b=0;b<a.length;b++){let c=this.attributes[a[b]];if(null!==c)if(void 0===c)for(const d in this.attributes){if(d.toLowerCase()===a[b].toLowerCase()){c=
this.attributes[d];null===c||c instanceof Date||(this.attributes[d]=new Date(c));break}}else c instanceof Date||(this.attributes[a[b]]=new Date(c))}};k.geometry=function(){if(this._adapter)return this._adapter.geometry();if(null===this._geometry||this._geometry instanceof q)return this._geometry;this._optimizedGeomDefinition?(this._geometry=n.unwrap(m.fromJSON(u.convertToGeometry(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM))),
this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=n.unwrap(m.fromJSON(this._geometry));return this._geometry};k.field=function(a){if(this._adapter)return this._adapter.field(a);!1===this._datesfixed&&this._fixDates();var b=this.attributes[a];if(void 0!==b)return b;b=a.toLowerCase();for(const c in this.attributes)if(c.toLowerCase()===b)return this.attributes[c];if(this._hasFieldDefinition(b))return null;throw Error("Field not Found : "+a);};k._hasFieldDefinition=
function(a){if(null===this._layer)return!1;for(let b=0;b<this._layer.fields.length;b++)if(this._layer.fields[b].name.toLowerCase()===a)return!0;return!1};k._field=function(a){if(this._adapter){var b;return null!=(b=this._adapter.field(a))?b:null}!1===this._datesfixed&&this._fixDates();b=a.toLowerCase();a=this.attributes[a];if(void 0!==a)return a;for(const c in this.attributes)if(c.toLowerCase()===b)return this.attributes[c];return null};k.setField=function(a,b){if(this.immutable)throw Error("Feature is Immutable");
if(!1===h.isSimpleType(b))throw Error("Illegal Value Assignment to Feature");if(this._adapter)this._adapter.setField(a,b);else{var c=a.toLowerCase();if(void 0===this.attributes[a])for(const d in this.attributes)if(d.toLowerCase()===c){this.attributes[d]=b;return}this.attributes[a]=b}};k.hasField=function(a){if(this._adapter)return this._adapter.hasField(a);const b=a.toLowerCase();if(void 0!==this.attributes[a])return!0;for(const c in this.attributes)if(c.toLowerCase()===b)return!0;return this._hasFieldDefinition(b)?
!0:!1};k.keys=function(){if(this._adapter)return this._adapter.keys();let a=[];const b={};for(var c in this.attributes)a.push(c),b[c.toLowerCase()]=1;if(null!==this._layer)for(c=0;c<this._layer.fields.length;c++){const d=this._layer.fields[c];1!==b[d.name.toLowerCase()]&&a.push(d.name)}return a=a.sort()};g.parseGeometryFromDictionary=function(a){a=g.convertDictionaryToJson(a,!0);void 0!==a.hasm&&(a.hasM=a.hasm,delete a.hasm);void 0!==a.hasz&&(a.hasZ=a.hasz,delete a.hasz);void 0!==a.spatialreference&&
(a.spatialReference=a.spatialreference,delete a.spatialreference);void 0!==a.rings&&(a.rings=this.fixPathArrays(a.rings,!0===a.hasZ,!0===a.hasZ));void 0!==a.paths&&(a.paths=this.fixPathArrays(a.paths,!0===a.hasZ,!0===a.hasM));void 0!==a.points&&(a.points=this.fixPointArrays(a.points,!0===a.hasZ,!0===a.hasM));return m.fromJSON(a)};g.fixPathArrays=function(a,b,c){const d=[];if(a instanceof Array)for(var f=0;f<a.length;f++)d.push(this.fixPointArrays(a[f],b,c));else if(a instanceof l)for(f=0;f<a.length();f++)d.push(this.fixPointArrays(a.get(f),
b,c));return d};g.fixPointArrays=function(a,b,c){const d=[];if(a instanceof Array)for(var f=0;f<a.length;f++){var e=a[f];e instanceof t?b&&c?d.push([e.x,e.y,e.z,e.m]):b?d.push([e.x,e.y,e.z]):c?d.push([e.x,e.y,e.m]):d.push([e.x,e.y]):e instanceof l?d.push(e.toArray()):d.push(e)}else if(a instanceof l)for(f=0;f<a.length();f++)e=a.get(f),e instanceof t?b&&c?d.push([e.x,e.y,e.z,e.m]):b?d.push([e.x,e.y,e.z]):c?d.push([e.x,e.y,e.m]):d.push([e.x,e.y]):e instanceof l?d.push(e.toArray()):d.push(e);return d};
g.convertDictionaryToJson=function(a,b=!1){const c={};for(const d in a.attributes){let f=a.attributes[d];f instanceof p&&(f=g.convertDictionaryToJson(f));b?c[d.toLowerCase()]=f:c[d]=f}return c};g.parseAttributesFromDictionary=function(a){const b={};for(const c in a.attributes){const d=a.attributes[c];if(h.isSimpleType(d))b[c]=d;else throw Error("Illegal Argument");}return b};g.fromJson=function(a){let b=null;null!==a.geometry&&void 0!==a.geometry&&(b=m.fromJSON(a.geometry));const c={};if(null!==a.attributes&&
void 0!==a.attributes)for(const d in a.attributes){const f=a.attributes[d];if(null===f)c[d]=f;else if(h.isString(f)||h.isNumber(f)||h.isBoolean(f)||h.isDate(f))c[d]=f;else throw Error("Illegal Argument");}return g.createFromGraphicLikeObject(b,c,null)};k.fullDomain=function(a,b){return null!==this._layer&&this._layer.fields?h.getDomain(a,this._layer,this,b):null};k.subtypes=function(){return null!==this._layer&&this._layer.fields?this._layer.typeIdField?{subtypeField:this._layer.typeIdField,subtypes:this._layer.types?
this._layer.types.map(a=>({name:a.name,code:a.id})):[]}:null:null};k.domainValueLookup=function(a,b,c){if(null===this._layer||!this._layer.fields)return null;c=h.getDomain(a,this._layer,this,c);if(void 0===b)try{b=this.field(a)}catch(d){return null}return h.getDomainValue(c,b)};k.gdbVersion=function(){if(null===this._layer)return"";const a=this._layer.gdbVersion;return void 0===a?"":""===a&&this._layer.capabilities&&this._layer.capabilities.isVersioned?"SDE.DEFAULT":a};k.domainCodeLookup=function(a,
b,c){if(null===this._layer||!this._layer.fields)return null;if(void 0===b){try{b=this.field(a)}catch(d){return null}return b}a=h.getDomain(a,this._layer,this,c);return h.getDomainCode(a,b)};k.schema=function(){if(null===this._layer||!this._layer.fields)return null;const a=[];for(const b of this._layer.fields)a.push(r.esriFieldToJson(b));return{objectIdField:this._layer.objectIdField,globalIdField:this._layer.globalIdField,geometryType:void 0===r.layerGeometryEsriRestConstants[this._layer.geometryType]?
"":r.layerGeometryEsriRestConstants[this._layer.geometryType],fields:a}};return g}()});