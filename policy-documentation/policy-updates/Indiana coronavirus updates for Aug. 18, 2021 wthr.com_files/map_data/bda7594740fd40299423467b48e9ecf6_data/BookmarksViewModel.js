// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Viewpoint ../../core/Collection ../../core/Error ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../webdoc/support/Thumbnail ../../webmap/Bookmark ../support/GoTo".split(" "),function(m,f,z,c,n,A,B,h,H,I,J,C,D,w,E){const p=B.getLogger("esri.widgets.Bookmarks.BookmarksViewModel"),
x=c.ofType(w),F={width:128,height:128,format:"png"},q={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0};c=function(y){function r(a){a=y.call(this,a)||this;a.activeBookmark=null;return a}m._inheritsLoose(r,y);var k=r.prototype;k.destroy=function(){this.view=null;this._set("activeBookmark",null)};k.createBookmark=function(){var a=m._asyncToGenerator(function*(b){const {view:d,defaultCreateOptions:g}=this;if(!d)return b=new n("create-bookmark:invalid-view","Cannot create a bookmark without a view."),
p.error(b),Promise.reject(b);const {takeScreenshot:l,screenshotSettings:e,captureViewpoint:t,captureRotation:u,captureScale:v}={...g,...b};b=l?yield this._createThumbnail(e):void 0;return new w({...b&&{thumbnail:b},...t&&{viewpoint:this._createViewpoint({view:d,captureScale:v,captureRotation:u})}})});return function(b){return a.apply(this,arguments)}}();k.editBookmark=function(){var a=m._asyncToGenerator(function*(b,d){const {view:g,defaultEditOptions:l}=this;if(!g)return b=new n("edit-bookmark:invalid-view",
"Cannot edit a bookmark without a view."),p.error(b),Promise.reject(b);const {takeScreenshot:e,screenshotSettings:t,captureViewpoint:u,captureRotation:v,captureScale:G}={...l,...d};if(d=e?yield this._createThumbnail(t):void 0)b.thumbnail=d;u&&(b.viewpoint=this._createViewpoint({view:g,captureScale:G,captureRotation:v}));this.emit("bookmark-edit",{bookmark:b});return b});return function(b,d){return a.apply(this,arguments)}}();k.goTo=function(a){var {view:b}=this;if(!b)return a=new n("go-to:invalid-view",
"Cannot go to a bookmark without a view"),p.error(a),Promise.reject(a);b=null==a?void 0:a.viewpoint;if(!b)return a=new n("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:a}),p.error(a),Promise.reject(a);this._set("activeBookmark",a);b=this.callGoTo({target:b});this.emit("bookmark-select",{bookmark:a});b.catch(()=>{}).then(()=>this._set("activeBookmark",null));return b};k._createThumbnail=function(){var a=m._asyncToGenerator(function*(b){b=yield this.view.takeScreenshot({...F,
...b});return new D({url:b.dataUrl})});return function(b){return a.apply(this,arguments)}}();k._createViewpoint=function({view:a,captureRotation:b,captureScale:d}){var g,l;const e=null==(g=a.viewpoint)?void 0:g.clone();return new z({targetGeometry:null==(l=a.extent)?void 0:l.clone(),rotation:b&&(null==e?void 0:e.rotation)||0,scale:d&&(null==e?void 0:e.scale)||0})};m._createClass(r,[{key:"bookmarks",get:function(){return this.get("view.map.bookmarks")||new x},set:function(a){void 0===a?this._clearOverride("bookmarks"):
this._override("bookmarks",a)}},{key:"defaultCreateOptions",get:function(){return q},set:function(a){this._set("defaultCreateOptions",{...q,...a})}},{key:"defaultEditOptions",get:function(){return q},set:function(a){this._set("defaultEditOptions",{...q,...a})}},{key:"state",get:function(){const a=this.get("view");return a&&!a.ready?"loading":"ready"}},{key:"view",get:function(){return this._get("view")},set:function(a){a&&"2d"!==a.type&&p.error(new n("view:invalid-view","SceneView is not supported",
{view:a}));this._set("view",a)}}]);return r}(E.GoToMixin(A.EventedAccessor));f.__decorate([h.property({readOnly:!0})],c.prototype,"activeBookmark",void 0);f.__decorate([h.property({type:x})],c.prototype,"bookmarks",null);f.__decorate([h.property()],c.prototype,"defaultCreateOptions",null);f.__decorate([h.property()],c.prototype,"defaultEditOptions",null);f.__decorate([h.property({readOnly:!0})],c.prototype,"state",null);f.__decorate([h.property({value:null})],c.prototype,"view",null);return c=f.__decorate([C.subclass("esri.widgets.Bookmarks.BookmarksViewModel")],
c)});