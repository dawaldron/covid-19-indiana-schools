// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../layers/graphics/dehydratedFeatureComparison ../../interactive/dragEventPipeline ../../interactive/snapping/SnappingContext ../../support/Scheduler".split(" "),function(n,y,d,z,A,p,B,q){let I=function(){function r(){this.next=new p.EventPipeline}r.prototype.createSnapDragEventPipelineStep=function({predicate:C=()=>!0,cancel:D,snappingManager:e,snappingContext:f,updatingHandles:E}){var F=
this;if(d.isNone(e))return a=>a;let g=null,b=null;const t=()=>{g=d.abortMaybe(g);e.doneSnapping();d.isSome(b)&&b.frameTask.remove();b=null};D.next(a=>{t();return a});this.next=new p.EventPipeline;return a=>{if(!C(a))return a;g=d.abortMaybe(g);if("start"===a.action){const c="3d"===e.view.type?e.view.resourceController.scheduler.registerTask(q.TaskPriority.SNAPPING):q.ImmediateTask;b={context:new B.SnappingContext({geometry:f.geometry,elevationInfo:f.elevationInfo,pointer:f.pointer,vertexHandle:d.isSome(a.info)?
a.info.handle:null,excludeFeature:f.excludeFeature,visualizer:f.visualizer}),originalPos:d.isSome(a.snapOrigin)?f.coordinateHelper.createDehydratedPoint(a.snapOrigin):a.mapStart,frameTask:c}}if(d.isSome(b)){const c=b.context.coordinateHelper.createDehydratedPoint(b.context.coordinateHelper.fromArray([b.originalPos.x,b.originalPos.y,b.originalPos.z]));c.x+=a.mapEnd.x-a.mapStart.x;c.y+=a.mapEnd.y-a.mapStart.y;const u=a.mapStart.x-b.originalPos.x,v=a.mapStart.y-b.originalPos.y,k={...a,action:"udpate"},
G=b.context,l=e.update(c,b.context);a.mapEnd.x=l.x+u;a.mapEnd.y=l.y+v;if("end"!==a.action){const w=b.frameTask;g=z.createTask(function(){var H=y._asyncToGenerator(function*(h){const x=yield w.schedule(()=>e.snap(c,G,h),h);if(x.valid){const m=yield w.schedule(()=>x.apply(),h);A.pointEquals(m,l)||(k.mapEnd.x=m.x+u,k.mapEnd.y=m.y+v,F.next.execute(k))}});return function(h){return H.apply(this,arguments)}}());E.addPromise(g.promise)}}"end"===a.action&&t();return a}};return r}();n.SnappingPipeline=I;Object.defineProperty(n,
"__esModule",{value:!0})});