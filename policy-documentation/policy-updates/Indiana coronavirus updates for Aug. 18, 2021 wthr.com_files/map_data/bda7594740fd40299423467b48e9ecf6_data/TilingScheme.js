// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/TileInfo".split(" "),function(x,q,m,y,z,A,B,v,C,w,r,t){let u=function(){function e(a){var b=e.checkUnsupported(a);if(b)throw b;
this.spatialReference=a.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=B.canProjectToWGS84ComparableLonLat(this.spatialReference)||w.isMars(this.spatialReference)||w.isMoon(this.spatialReference);this.origin=[a.origin.x,a.origin.y];this.pixelSize=a.size[0];this.dpi=a.dpi;var c=a.lods.reduce(function(g,n,l){n.level<g.min&&(g.min=n.level,g.minIndex=l);g.max=Math.max(g.max,n.level);return g},{min:Infinity,minIndex:0,max:-Infinity}),d=a.lods[c.minIndex];const f=2**
d.level;b=d.resolution*f;d=d.scale*f;this.levels=Array(c.max+1);for(c=0;c<this.levels.length;c++)this.levels[c]={resolution:b,scale:d,tileSize:[b*a.size[0],b*a.size[1]]},b/=2,d/=2}var h=e.prototype;h.clone=function(){return new e(this.toTileInfo())};h.toTileInfo=function(){return new t({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((a,b)=>({level:b,scale:a.scale,
resolution:a.resolution}))})};h.getExtent=function(a,b,c,d){var f=this.levels[a];a=f.tileSize[0];f=f.tileSize[1];d[0]=this.origin[0]+c*a;d[2]=d[0]+a;d[3]=this.origin[1]-b*f;d[1]=d[3]-f};h.convertExtentToRadians=function(a,b){this._isWebMercator?(b[0]=r.x2lon(a[0]),b[1]=r.y2lat(a[1]),b[2]=r.x2lon(a[2]),b[3]=r.y2lat(a[3])):this._isGCS&&(b[0]=m.deg2rad(a[0]),b[1]=m.deg2rad(a[1]),b[2]=m.deg2rad(a[2]),b[3]=m.deg2rad(a[3]))};h.getExtentGeometry=function(a,b,c,d=new A){this.getExtent(a,b,c,k);d.spatialReference=
this.spatialReference;d.xmin=k[0];d.ymin=k[1];d.xmax=k[2];d.ymax=k[3];d.zmin=void 0;d.zmax=void 0;return d};h.ensureMaxLod=function(a){if(null==a)return!1;for(var b=!1;this.levels.length<=a;){b=this.levels[this.levels.length-1];const c=b.resolution/2;this.levels.push({resolution:c,scale:b.scale/2,tileSize:[c*this.pixelSize,c*this.pixelSize]});b=!0}return b};h.capMaxLod=function(a){this.levels.length>a+1&&(this.levels.length=a+1)};h.getMaxLod=function(){return this.levels.length-1};h.scaleAtLevel=
function(a){return this.levels[0].scale/2**a};h.levelAtScale=function(a){const b=this.levels[0].scale;return a>=b?0:Math.log(b/a)*Math.LOG2E};h.resolutionAtLevel=function(a){return this.levels[0].resolution/2**a};h.compatibleWith=function(a){if(!(a instanceof e)){if(e.checkUnsupported(a))return!1;a=new e(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize!==this.pixelSize)return!1;const b=Math.min(this.levels.length,a.levels.length)-1,c=this.levels[b].resolution;let d=.5*c;if(!m.floatEqualAbsolute(a.origin[0],
this.origin[0],d)||!m.floatEqualAbsolute(a.origin[1],this.origin[1],d))return!1;d=.5*c/2**b/this.pixelSize*12;return m.floatEqualAbsolute(c,a.levels[b].resolution,d)};h.rootTilesInExtent=function(a,b=null,c=Infinity){const d=this.levels[0].tileSize;if(0===d[0]||0===d[1])return[];e.computeRowColExtent(a,d,this.origin,k);a=k[1];let f=k[3],g=k[0],n=k[2];var l=n-g,p=f-a;l*p>c&&(c=Math.floor(Math.sqrt(c)),p>c&&(a=a+Math.floor(.5*p)-Math.floor(.5*c),f=a+c),l>c&&(g=g+Math.floor(.5*l)-Math.floor(.5*c),n=
g+c));c=[];for(l=a;l<f;l++)for(p=g;p<n;p++)c.push([0,l,p]);y.isSome(b)&&(b[0]=this.origin[0]+g*d[0],b[1]=this.origin[1]-f*d[1],b[2]=this.origin[0]+n*d[0],b[3]=this.origin[1]-a*d[1]);return c};e.computeRowColExtent=function(a,b,c,d){const f=.001*(a[2]-a[0]+(a[3]-a[1]));d[0]=Math.max(0,Math.floor((a[0]+f-c[0])/b[0]));d[2]=Math.max(0,Math.ceil((a[2]-f-c[0])/b[0]));d[1]=Math.max(0,Math.floor((c[1]-a[3]+f)/b[1]));d[3]=Math.max(0,Math.ceil((c[1]-a[1]-f)/b[1]))};e.isPowerOfTwo=function(a){a=a.lods;const b=
a[0].resolution*2**a[0].level;return!a.some(function(c){return!m.floatEqualRelative(c.resolution,b/2**c.level)})};e.hasGapInLevels=function(a){a=a.lods.map(function(b){return b.level});a.sort(function(b,c){return b-c});for(let b=1;b<a.length;b++)if(a[b]!==a[0]+b)return!0;return!1};e.tileSizeSupported=function(a){const b=a.size[1];return b===a.size[0]&&0===(b&b-1)&&128<=b&&512>=b};e.checkUnsupported=function(a){return a?1>a.lods.length?new q("tilingscheme:generic","Tiling scheme must have at least one level"):
e.isPowerOfTwo(a)?e.hasGapInLevels(a)?new q("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):e.tileSizeSupported(a)?null:new q("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new q("tilingscheme:power-of-two","Tiling scheme must be power of two"):new q("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};e.fromExtent=function(a,b){const c=a[2]-a[0],d=a[3]-a[1],f=z.getMetersPerUnitForSR(b),g=
1.2*Math.max(c,d);a=new e(new t({size:[256,256],origin:{x:a[0]-.5*(g-c),y:a[3]+.5*(g-d)},lods:[{level:0,resolution:g/256,scale:1/(256/96*.0254/(g*f))}],spatialReference:b}));a.ensureMaxLod(20);return a};e.makeWebMercatorAuxiliarySphere=function(a){const b=new e(e.WebMercatorAuxiliarySphereTileInfo);b.ensureMaxLod(a);return b};e.makeGCSWithTileSize=function(a,b=256,c=16){const d=256/b;a=new e(new t({size:[b,b],origin:{x:-180,y:90,spatialReference:a},spatialReference:a,lods:[{level:0,resolution:.703125*
d,scale:2.95497598570834E8*d}]}));a.ensureMaxLod(c);return a};x._createClass(e,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return e}();u.WebMercatorAuxiliarySphereTileInfo=new t({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:v.WebMercator},spatialReference:v.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});u.WebMercatorAuxiliarySphere=u.makeWebMercatorAuxiliarySphere(19);const k=
C.create();return u});