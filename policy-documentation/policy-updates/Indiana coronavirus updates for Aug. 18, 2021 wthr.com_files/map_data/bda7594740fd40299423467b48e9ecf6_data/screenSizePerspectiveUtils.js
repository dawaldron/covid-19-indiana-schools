// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],function(k,C,g){function u(b,c,a){const d=a.parameters;a=a.paddingPixelsOverride;n.scale=Math.min(d.divisor/(c-d.offset),1);n.factor=Math.abs(b*b*b);n.minPixelSize=d.minPixelSize;n.paddingPixels=a;return n}function r(b,c){return 0===b?c.minPixelSize:c.minPixelSize*(1+2*c.paddingPixels/b)}function t(b,c){return Math.max(g.lerp(b*c.scale,b,c.factor),r(b,c))}let A=function(){function b(a,d,e,f={camera:{distance:0,
fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},h){this.viewingMode=a;this.description=d;this.ellipsoidRadius=e;this.parameters=f;this._paddingPixelsOverride=h;2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}
var c=b.prototype;c.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.ellipsoidRadius,this.parameters);return!0};c.overridePadding=function(a){return a!==this.paddingPixelsOverride?new b(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,a):this};c.calculateParameters=function(a,d,e){const {scaleStart:f,scaleFallOffRange:h,minPixelSize:m}=this.description,{fovY:l,distance:q}=
a;var p=this.calculateCurvatureDependentParameters(a,d);d=this.coverageCompensation(a,d,p);const {tiltAngle:v,scaleFallOffFactor:w}=p,x=Math.sin(v)*q,y=.5*Math.PI-v-l*(.5-f*d);p=x/Math.cos(y);d=(p-x/Math.cos(y+l*h*d)*w)/(1-w);e.camera.fovY=a.fovY;e.camera.distance=a.distance;e.offset=d;e.divisor=p-d;e.minPixelSize=m;return e};c.calculateCurvatureDependentParametersLocal=function(a,d,e=z){e.tiltAngle=this.description.curvatureDependent.min.tiltAngle;e.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;
return e};c.calculateCurvatureDependentParametersGlobal=function(a,d,e=z){const f=this.description.curvatureDependent;a=1+a.distance/d;a=Math.sqrt(a*a-1);const [h,m]=[f.min.curvature,f.max.curvature];a=g.clamp((a-h)/(m-h),0,1);const [l,q]=[f.min,f.max];e.tiltAngle=g.lerp(l.tiltAngle,q.tiltAngle,a);e.scaleFallOffFactor=g.lerp(l.scaleFallOffFactor,q.scaleFallOffFactor,a);return e};c.surfaceCoverageCompensationLocal=function(a,d,e){return(a.fovY-e.tiltAngle)/a.fovY};c.surfaceCoverageCompensationGlobal=
function(a,d,e){const f=d*d;e=e.tiltAngle+.5*Math.PI;const {fovY:h,distance:m}=a;a=m*m+f-2*Math.cos(e)*m*d;const l=Math.sqrt(a);return(Math.acos(Math.sqrt(a-f)/l)-Math.asin(d/(l/Math.sin(e)))+.5*h)/h};C._createClass(b,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return b}();const B={curvatureDependent:{min:{curvature:g.deg2rad(10),tiltAngle:g.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:g.deg2rad(70),tiltAngle:g.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},n={scale:0,factor:0,minPixelSize:0,paddingPixels:0},z={tiltAngle:0,scaleFallOffFactor:0};k.applyPrecomputedScaleFactor=function(b,c,a=[0,0]){c=Math.min(Math.max(c.scale,r(b[1],c)/b[1]),1);a[0]=b[0]*c;a[1]=b[1]*c;return a};k.applyScaleFactor=t;k.applyScaleFactorVec2=function(b,c,a=[0,0]){const d=Math.min(Math.max(c.scale,r(b[1],c)/b[1]),1);a[0]=g.lerp(b[0]*d,b[0],c.factor);a[1]=g.lerp(b[1]*d,b[1],c.factor);return a};k.getLabelSettings=
function(b,c){const {curvatureDependent:a,scaleStart:d,scaleFallOffRange:e}=B;return new A(b,{curvatureDependent:{min:{curvature:a.min.curvature,tiltAngle:a.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:a.max.curvature,tiltAngle:a.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:d,scaleFallOffRange:e,minPixelSize:14},c)};k.getSettings=function(b,c){return new A(b,B,c)};k.precomputeScaleFactor=function(b,c,a,d){b=u(b,c,a);b.minPixelSize=0;b.paddingPixels=0;b=t(1,b);d.scale=b;d.factor=0;d.minPixelSize=
a.parameters.minPixelSize;d.paddingPixels=a.paddingPixelsOverride};k.scale=function(b,c,a,d){return t(b,u(c,a,d))};Object.defineProperty(k,"__esModule",{value:!0})});