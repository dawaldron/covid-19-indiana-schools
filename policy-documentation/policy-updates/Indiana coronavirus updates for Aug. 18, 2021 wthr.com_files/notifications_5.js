define("notifications",["module","jquery","page","utils","storage","jquery-utils"],function(e,n,t,d,u){"use strict";var f={name:e.id,class:"."+e.id};d.broadcast(f.name,"loaded"),d.createModule(f.name,function(i){const o=this;var c;function s(){i.hide()}function a(t){c.getToken().then(function(e){e?t.success(e):t.needPermission()}).catch(function(){t.error()})}function r(e){o.broadcast("subscribing"),n.ajax({url:"/ajax/notifications/subscribe",type:"POST",data:{token:e},success:function(){o.broadcast("subscriptionSucceeded")},error:function(){o.broadcast("subscriptionFailed")}})}this.$el=i,this.module=f;var t=function(e){window.firebase?(o.broadcast("firebaseDetected"),e(window.firebase,window.firebase.messaging())):window.setTimeout(function(){t(e)},500)};this.init=function(){o.broadcast("init"),document.referrer.includes&&document.referrer.includes("firebase-messaging-sw.js")&&o.broadcast("notificationClicked",{_trackEvent:{event:"notificationClicked",category:"notifications"}}),t(function(e,t){var n;o.broadcast("ready"),n=function(e){o.broadcast("receivedMessage",{message:e})},(c=t).onMessage(function(e){n(e)},function(e){o.broadcast("messageError",{error:e})}),d.listen("toasts","clicked",function(){o.broadcast("notificationClicked",{_trackEvent:{event:"notificationClicked",category:"notifications"}})}),a({success:function(e){o.broadcast("permissionExists"),o.broadcast("gotToken",{token:e}),r(e)},needPermission:function(){var e;o.broadcast("needPermission"),e={yes:function(){var e;s(),o.broadcast("promptAccepted",{_trackEvent:{event:"promptAccepted",category:"notifications"}}),e={accepted:function(){o.broadcast("permissionAccepted",{_trackEvent:{event:"permissionAccepted",category:"notifications"}}),a({success:function(e){o.broadcast("gotToken",{token:e}),r(e)},empty:function(){o.broadcast("tokenFailed")},error:function(){o.broadcast("tokenFailed")}})},denied:function(){o.broadcast("permissionDenied",{_trackEvent:{event:"permissionDenied",category:"notifications"}})}},c.requestPermission().then(e.accepted).catch(e.denied)},no:function(){s(),o.broadcast("promptDenied",{_trackEvent:{event:"promptDenied",category:"notifications"}}),u.set([f.name,"promptDenied"].join("/"),!0,30)},blocked:function(){o.broadcast("previouslyDenied")}},!0===u.get("notifications/promptDenied")?e.blocked():(o.broadcast("showingPrompt"),i.show(),o.getElements("button").withModifier("option","yes").on("click",function(){e.yes()}),o.getElements("button").withModifier("option","no").on("click",function(){e.no()}),o.getElements("button").on("click",function(){i.hide()}))},error:function(){o.broadcast("blocked")}})})}})});
//# sourceMappingURL=notifications_5.8.4.js.map