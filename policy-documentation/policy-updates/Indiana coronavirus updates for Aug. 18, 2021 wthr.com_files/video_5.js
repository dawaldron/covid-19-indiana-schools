define("video",["module","jquery","page","utils","jwplayer","jquery-utils"],function(e,s,r,d,l){"use strict";var c={name:e.id,class:"."+e.id};d.broadcast(c.name,"loaded");d.createModule(c.name,function(o){var n=this;this.module=c,this.model=null,this.videoData=null,this.reload=!1,this.init=function(){n.broadcast("init"),this.model=o.getModelData(),this.videoData=s.extend(!0,{},this.model),"true"!==r.model.isMonitor&&require(["comscore"]),n.isLongform=0<o.closest(".longform__video").length,n.getElements("player").attr("id",n.id),n.setupTeaserHandling(),this.reload||n.setupListeners(),n.isLongform?n.toggleTeaser(!1):!1!==n.isLongform||"true"!==n.videoData.autoplay&&!0!==n.videoData.autoplay?(d.broadcast("video","ready",{$el:o}),d.broadcastNoJQ("video","ready",{el:o[0]})):(n.toggleTeaser(!1),n.broadcast("autostart"))},this.$el=o,this.getElements=function(e){return n.$el.getBlock(c.name).getElements(e)},this.player=null,this.index=s(c.class).length,this.uuid=d.uuid(),this.id="video-"+this.uuid,this.showingTeaser=!0,this.transitionSpeed=500,this.maxProgressPercent=0,this.videosPlayed=1,this.isUGC=null,this.showPreroll=!0,this.hasPlayed=!1,this.do=function(e,t,a,i,o){return n.player[e](t,a,i,o)},this.get=function(e){return n.do("get"+d.initialCap(e))},this.set=function(e,t){return n.do("set"+d.initialCap(e),t)},this.on=function(e,t){return n.do("on",e,t)},this.isThisInstance=function(e){return e.is(n.$el)},this.toggleTeaser=function(e){var t=!n.showingTeaser;(t=void 0!==e?e:t)?(n.getElements("teaser").setModifier("visible",!0),window.setTimeout(function(){n.do("remove")},n.transitionSpeed)):n.initializePlayer(function(){n.setupPlayerEvents(),n.getElements("teaser").setModifier("visible",!1),d.listen("longform","playClicked",function(e,t,a){n.isThisInstance(a.$video)&&n.do("play")}),d.listen("longform","closeClicked",function(e,t,a){n.isThisInstance(a.$video)&&n.do("pause",!0)}),n.hasBroadcastReady||(d.broadcast("video","ready",{$el:o}),d.broadcastNoJQ("video","ready",{el:o[0]}),n.hasBroadcastReady=!0)})},this.showError=function(e){n.getElements("error").text(e),n.hasBroadcastReady||(d.broadcast("video","ready",{$el:o}),d.broadcastNoJQ("video","ready",{el:o[0]}),n.hasBroadcastReady=!0),n.showingTeaser||n.toggleTeaser(!0)},this.getAdCall=function(){var e={env:"vp",gdfp_req:"1",impl:"s",output:"xml_vast3",sz:"920x508",unviewed_position_start:"1",cmsid:"12768",url:window.location.href,description_url:window.location.href,vid:n.videoData.id,cust_params:{topic_section:n.videoData.subtopic,cue:"pre",cgm:"0",frmt:"22",plID:"6918249996585",contentid:n.videoData.id,ttID:n.videoData.id},scp:n.thirdPartyAdManager.providers.amazon.response,iu:d.joinIfSet("/",[r.model.dfpid,r.model.gptid,n.videoData.dfpposition,"pre_roll",n.videoData.section,n.videoData.subsection,n.videoData.topic])};return"//pubads.g.doubleclick.net/gampad/ads?"+d.assembleQueryString(e)},this.dock=function(){n.getElements("inner").setModifier("docked",!0),n.broadcast("docked")},this.undock=function(){n.getElements("inner").setModifier("docked",!1),n.broadcast("undocked")},this.setupPlayerEvents=function(){return"desktop"===r.model.platform&&"true"===n.$el[0].dataset.float&&n.$el.observeIntersections(e=>{var t=e.boundingClientRect.y,a=(n.lastIntersectionY||0)<t?"up":"down";e.isIntersectingThreshold?n.undock():"down"==a&&n.dock(),n.lastIntersectionY=t},{threshold:.9}),d.listen("article","lostFocus",function(e,t,a){a.$el.is(n.$el.closest(".article"))&&(n.do("pause",!0),"desktop"===r.model.platform&&n.undock())}),n.on("beforePlay",function(e){let t=n.player.getPlugin("related");t.on("play",function(e){n.hasPlayed=!1});var a=parseInt(n.$el.attr("data-disable-preroll-at-duration")),i=parseInt(n.$el.attr("data-duration"));if(null===n.isUGC){"ugc"===n.$el.attr("data-origin")&&(n.isUGC=!0),0<i&&i<=a&&(n.showPreroll=!1);let e=n.player.getPlugin("related");e.on("play",function(e){e.item.isUgc&&"true"===e.item.isUgc.toString()?n.isUGC=!0:n.isUGC=!1,e.item.duration&&e.item.duration<=a?n.showPreroll=!1:n.showPreroll=!0})}!1===n.hasPlayed&&(d.broadcast(c.name,"requestingPrerollBids"),n.thirdPartyAdManager.callbackHasRun=!1,n.thirdPartyAdManager.sendRequests(function(){var e;!n.showPreroll||n.isUGC&&"false"!==n.$el.attr("data-ugc-preroll-disabled")||(e=n.getAdCall(),d.broadcast(c.name,"requestingPrerollAd",{url:e}),n.do("playAd",e))}))}),n.on("fullscreen",function(e){e.fullscreen?d.broadcast(c.name,"fullscreenEnabled",{event:e,_trackEvent:{event:"enter full screen",category:"video",label:"livealert-"+n.videoData.title}}):d.broadcast(c.name,"fullscreenDisabled",{event:e,_trackEvent:{event:"leave full screen",category:"video",label:"livealert-"+n.videoData.title}})}),n.on("firstFrame",function(e){n.hasPlayed=!0,n.player.setState("volume",n.player.getVolume()),n.player.setState("milestone25",!1),n.player.setState("milestone50",!1),n.player.setState("milestone75",!1);var t=n.player.getPlaylistItem(n.player.getPlaylistIndex());1<n.videosPlayed&&(n.videoData.section=t.section,n.videoData.subsection=t.subsection,n.videoData.topic=t.topic,n.videoData.subtopic=t.subtopic,n.videoData.id=t.contentId,n.videoData.title=t.title,n.videoData.stream=t.file),d.broadcast(c.name,"firstFrame",{event:e,_trackEvent:{event:"mediaplay",category:"video",label:n.videoData.title},_trackView:{event_name:null,section:n.videoData.section||null,subsection:n.videoData.subsection||null,subcategory:n.videoData.subsection||null,topic:n.videoData.topic||null,subtopic:n.videoData.subtopic||null,asset_id:n.videoData.id,video_player_name:"jwplayer",video_name:n.videoData.title,video_autoplay:n.videoData.autoplay?"autoplay":"false",video_url:n.videoData.stream,content_type:"video",pathname:n.videoData.stream,video_milestone:null,item_number:n.videosPlayed,video_related_play:1<n.videosPlayed?"true":"false",video_length:(e=Math.floor(n.get("duration")),[d.padNumber(Math.floor(e/60),2),d.padNumber(Math.floor(e%60),2)].join(":"))},_trackTags:["googleanalytics"]}),n.videosPlayed++}),n.on("adStarted",function(e){d.broadcast(c.name,"adStarted",{event:e,_trackEvent:{event:"ad-start",category:"video",label:n.videoData.title}})}),n.on("adBidRequest",function(e){d.broadcast(c.name,"adBidRequest",{event:e,bidders:e.bidders})}),n.on("autostartNotAllowed",function(e){d.broadcast(c.name,"autostartNotAllowed",{event:e})}),n.on("adSkipped",function(e){d.broadcast(c.name,"adSkipped",{event:e,_trackEvent:{event:"ad-skip",category:"video",label:n.videoData.title}})}),n.on("adComplete",function(e){d.broadcast(c.name,"adComplete",{event:e,_trackEvent:{event:"ad-complete",category:"video",label:n.videoData.title}})}),n.on("play",function(e){d.broadcast(c.name,"play",{event:e,instance:n})}),n.on("pause",function(e){d.broadcast(c.name,"pause",{event:e,_trackEvent:{event:"mediapause",category:"video",label:n.videoData.title}})}),n.on("complete",function(e){"true"!==n.$el.attr("data-is-live-now")&&d.broadcast(c.name,"milestoneReached",{event:e,milestone:1,_trackEvent:{event:"milestoneReached-100%",category:"video",label:n.videoData.title}})}),n.on("volume",function(e){var t=n.player.getVolume();n.player.getState("volume"),n.player.setState("volume",t),d.broadcast(c.name,"volume",{event:e})}),n.on("mute",function(e){var t="mute";!1===n.player.getMute()&&(t="unmute"),d.broadcast(c.name,t,{event:e})}),n.on("time",function(e){"refreshTimer"in r&&"reset"in r.refreshTimer&&r.refreshTimer.reset(),"true"!==n.$el.attr("data-is-live-now")&&(!1===n.player.getState("milestone25")&&e.position>e.duration/4?(n.player.setState("milestone25",!0),d.broadcast(c.name,"milestoneReached",{event:e,milestone:.25,_trackEvent:{event:"milestoneReached-25%",category:"video",label:n.videoData.title}})):!1===n.player.getState("milestone50")&&e.position>e.duration/2?(n.player.setState("milestone50",!0),d.broadcast(c.name,"milestoneReached",{event:e,milestone:.5,_trackEvent:{event:"milestoneReached-50%",category:"video",label:n.videoData.title}})):!1===n.player.getState("milestone75")&&e.position>e.duration/4*3&&(n.player.setState("milestone75",!0),d.broadcast(c.name,"milestoneReached",{event:e,milestone:.75,_trackEvent:{event:"milestoneReached-75%",category:"video",label:n.videoData.title}})))}),n.on("error setupError playAttemptFailed",function(e){e.message?n.showError(e.message):n.showError("Something went wrong.")}),n},this.setupListeners=function(){return d.listen("modal","showing",(e,t,a)=>{0===n.$el.closest("modal").length&&n.player&&n.player.pause&&n.do("pause",!0)}),d.listen(c.name,"play adPlay",function(e,t,a){!1===n.isThisInstance(a.instance.$el)&&n.do("pause",!0)}),n},this.initializePlayer=function(e){var t={width:640,height:360,style:"border:1px solid #e6e6e6",src:`https://www.${r.model.primarydomain}/embeds/video/${o[0].dataset.site}-${n.videoData.id}/iframe`,allowfullscreen:!0,webkitallowfullscreen:!0,mozallowfullscreen:!0},a={width:"100%",mute:n.videoData.mute,aspectratio:"16:9",androidhls:!0,hlshtml:!0,primary:"html5",abouttext:"Tegna Media",aboutlink:"http://www.tegna.com/media/",hlslabels:{346:"Low",659:"Medium",955:"High",1776:"HD"},tracks:[],file:n.videoData.stream,title:n.videoData.title,mediaid:n.videoData.relatedMediaId,image:n.videoData.thumbnail,autostart:!n.isLongform,cast:{}};"true"!==o[0].dataset.disablePreroll&&(a.advertising={autoplayadsmuted:!1,client:"googima",skipoffset:15}),"true"!==o[0].dataset.isLiveNow&&(a.sharing={link:o[0].dataset.link,code:"<iframe "+d.assembleHtmlAttributes(t)+"></iframe>"}),o[0].dataset.captions&&a.tracks.push({kind:"captions",file:o[0].dataset.captions,label:"Closed Captions"}),n.player=l(n.id),n.player.states={},n.player.getState=function(e){return n.player.states[e]},n.player.setState=function(e,t){n.player.states[e]=t},n.player&&n.player.setState("volume",n.player.getVolume());var i=n.$el.attr("data-related-playlist-id");n.player.relatedMediaId||(n.player.relatedMediaId=n.$el.attr("data-related-media-id"));t=`https://cdn.jwplayer.com/v2/playlists/${i}?format=json`,i=n.$el.attr("data-use-trending");i&&"false"!==i.toLowerCase()||(t+=`&related_media_id=${n.player.relatedMediaId}`);i=n.$el.attr("data-recency");return a.related={file:t+=`&recency=${i}D`,oncomplete:"autoplay"},d.broadcast(c.name,"startingPlayerSetup",{settings:a}),n.do("setup",a),s("#"+n.id).addClass(c.name+"__player"),n.on("ready",e),n},this.thirdPartyAdManager={callbackHasRun:!1,timeout:500,providers:{amazon:{state:{sent:!1,received:!1,timedOut:!1},response:null,request:function(e){var t=[{slotID:`videoSlot_${n.index}`,mediaType:"video"}];"apstag"in window?(d.broadcast(c.name,"requestingAmazonBids",{slots:t}),window.apstag.fetchBids({slots:t},e)):d.broadcast(c.name,"apstagNotReady")},callback:function(e){d.broadcast(c.name,"receivedRawAmazonBids",{bids:e});e=e.filter(function(e){return"video"===e.mediaType});e&&0<e.length?(d.broadcast(c.name,"receivedAmazonBid",{instance:n,bidList:e}),n.thirdPartyAdManager.providers.amazon.response=e[0].qsParams):d.broadcast(c.name,"emptyAmazonBid",{instance:n})}},facebook:{state:{sent:!1,received:!1,timedOut:!1},response:null,request:function(t){var e,a,i;window.anPrebidAsyncInit=function(){var e=r.model.fbanplacement;new AudienceNetworkPrebid(e,n.getElements("player")[0]).getProfile(t)},e=document,a="an-prebid",i=e.getElementsByTagName("script")[0],e.getElementById(a)||((e=e.createElement("script")).id=a,e.src="//connect.facebook.com/en_US/AudienceNetworkPrebid.js",i.parentNode.insertBefore(e,i))},callback:function(e){e=e.token;window.fbPrebidToken=e,"nobid"===(n.thirdPartyAdManager.providers.facebook.response=e)?r.broadcast("video","emptyFacebookToken",{token:e}):r.broadcast("video","receivedFacebookToken",{token:e})}}},ifAllProvidersAreDone:function(e){var a=!0;s.each(this.providers,function(e,t){!1===t.state.received&&!1===t.state.timedOut&&(a=!1)}),a&&!this.callbackHasRun&&(this.callbackHasRun=!0,e())},sendRequests:function(i){s.each(this.providers,function(t,a){a.state.sent=!0,d.broadcast(c.name,"requestedThirdPartyAd",{instance:n,provider:t}),a.request(function(e){a.state.received=!0,d.broadcast(c.name,"receivedThirdPartyAdResponse",{instance:n,provider:t,response:e}),a.callback(e),n.thirdPartyAdManager.ifAllProvidersAreDone(i)}),window.setTimeout(function(){!0!==a.state.received&&(a.state.timedOut=!0,d.broadcast(c.name,"timedOutThirdPartyAd",{instance:n,provider:t})),n.thirdPartyAdManager.ifAllProvidersAreDone(i)},n.thirdPartyAdManager.timeout)})}},this.setupTeaserHandling=function(){return n.getElements("teaser").on("click",function(){n.toggleTeaser(!1)}),n}})});
//# sourceMappingURL=video_5.8.4.js.map