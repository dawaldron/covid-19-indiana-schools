window.__tnt||(window.__tnt={}),__tnt.metering||(__tnt.metering={}),__tnt.metering.init=[],__tnt.metering.access={c:[],d:[],e:[]},__tnt.metering.config={date:0,days:0,read:!1,access:!1,referred:!1,login_after_wall:!1,reg_limit:0,sub_limit:0,uuid:""},__tnt.metering.check=function(){__tnt.log("evaluating metering");var t=__tnt.metering.access.d;if(__tnt.metering.compatibility().check){if(__tnt.recent.set(__tnt.recent.get()),__tnt.metering.config.uuid=$("#asset-content").attr("data-asset-uuid"),__tnt.user.loggedIn&&sessionStorage.getItem("__tnt.metering.wall.registration")){__tnt.metering.config.login_after_wall=!0;try{sessionStorage.removeItem("__tnt.metering.wall.registration")}catch(t){}}$.each(__tnt.metering.init,function(){this()});for(var e=0;!__tnt.metering.config.access&&e<__tnt.metering.access.c.length;)__tnt.metering.access.c[e]()&&(__tnt.log("access granted"),t=__tnt.metering.access.e,__tnt.metering.config.access=!0),e++}$.each(t,function(){this()}),__tnt.recent.set(__tnt.recent.data)},__tnt.metering.clean=function(){__tnt.metering.access={c:[],d:[],e:[]},__tnt.metering.check=function(){return!1}},__tnt.metering.compatibility=function(){return{check:!0,status:""}},__tnt.metering.gtm=function(t){var e=__tnt.metering.config.reg_limit;__tnt.user.loggedIn&&(e=__tnt.metering.config.sub_limit);var n=__tnt.recent.count.get();!__tnt.metering.config.read&&__tnt.metering.config.access&&(n+=1);var i=e-n;("number"!=typeof i||i<0)&&(i=0);var r="free view";if(t&&__tnt.user.loggedIn){r="wall";try{window.sessionStorage&&sessionStorage.setItem("__tnt.metering.wall.subscription",1)}catch(t){}}else if(t){r="wall";try{window.sessionStorage&&sessionStorage.setItem("__tnt.metering.wall.registration",1)}catch(t){}}"logged in after encountering wall"==__tnt.metering.statusPretty(t)&&(r="goal"),window.dataLayer&&dataLayer.push({event:"tncms.event.trigger",tncms:{event:{trigger:{category:"subscription",action:r,label:__tnt.metering.statusPretty(t),value:n}},subscription:{meter:{views:{count:n,rem_count:i},thresholds:{registration:__tnt.metering.config.reg_limit,subscription:__tnt.metering.config.sub_limit}}}}})},__tnt.metering.statusPretty=function(t){return 0===__tnt.recent.count.get()&&t?"hit registration limit":0===__tnt.recent.count.get()?"first view":__tnt.user.loggedIn&&__tnt.metering.config.login_after_wall?"logged in after encountering wall":__tnt.metering.config.read?"previously read":__tnt.metering.config.referred?"free click":__tnt.user.loggedIn&&t&&__tnt.recent.count.get()==__tnt.metering.config.sub_limit?"hit subscription limit":t&&__tnt.recent.count.get()==__tnt.metering.config.sub_limit&&__tnt.metering.sub_limit==__tnt.metering.config.reg_limit?"hit subscription limit":t&&__tnt.recent.count.get()==__tnt.metering.config.reg_limit&&__tnt.metering.config.reg_limit!=__tnt.metering.config.sub_limit?"hit registration limit":!t&&__tnt.recent.count.get()<__tnt.metering.config.reg_limit&&__tnt.metering.config.reg_limit!=__tnt.metering.config.sub_limit?"under registration limit":!t&&__tnt.recent.count.get()<__tnt.metering.config.sub_limit?"under subscription limit":"hit subscription limit"},__tnt.metering.comments={access:function(t,e){null==__tnt.user.authToken||null==__tnt.user.services?t.parentNode.removeChild(t):e.parentNode.removeChild(e)}},__tnt.recent||(__tnt.recent={}),__tnt.recent={data:{},get:function(){var t=new Date,e={c:0,d:t.getTime(),a:[]},n=null;if(window.localStorage&&null!=localStorage.getItem("__tnt.recent")){try{n=localStorage.getItem("__tnt.recent")}catch(t){}null!=n&&void 0!=n&&"null"!=n&&"undefined"!=n&&(n=JSON.parse(localStorage.getItem("__tnt.recent")),n.c&&(e.c=n.c),n.d&&(e.d=n.d),n.a&&(e.a=n.a))}return __tnt.recent.data=e,e},set:function(t){var e=JSON.stringify(__tnt.recent.data);try{localStorage.setItem("__tnt.recent",e)}catch(t){console.log("encountered an error when setting local storage")}return e},count:{get:function(){return count=Number(__tnt.recent.data.c),count},set:function(t){return window.localStorage&&(__tnt.recent.data.c=t),t}},assets:{get:function(){return __tnt.recent.data.a},set:function(t){return __tnt.recent.data.a=t,__tnt.recent.data.a},add:function(t){for(var e=__tnt.recent.data.a;e.length>10;)e.shift();e.push(t)}},date:{get:function(){return Number(__tnt.recent.data.d)},set:function(t){var e=new Date(t).getTime();return __tnt.recent.data.d=e,e}}},__tnt.referrer=function(t,e){if(cleanedReferrer=String(String(e).split("?")[0]).replace(/https\:\/\/|http\:\/\//,"").replace(/www\./,""),t.length)for(var n=0;n<t.length;n++){for(var i=t[n].split("/"),r=cleanedReferrer.split("/"),_=!0,c=0;c<i.length&&_;)i[c]!=r[c]&&(_=!1),c++;if(_)return!0}return!1};
//# sourceMappingURL=tnt.metering.c1fd4b9015c14b57a58acdbc3ee4daca.js.map