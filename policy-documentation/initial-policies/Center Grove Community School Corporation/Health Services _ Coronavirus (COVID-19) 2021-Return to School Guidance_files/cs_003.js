!function($){$.fn.eventsCalendarSlider=function(settings){var config={calendarLinkText:"View Full Calendar",RSSLinkText:"Subscribe To This Calendar",days:7,days1024:6,days768:4,days640:3,days480:2,days320:1,calLoad:function(){}};return settings&&$.extend(config,settings),this.each(function(){var element=this,todayDate=new Date,blockDate="",longDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longMonths=["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],moduleID=$(element).parent().attr("id"),eventsData={calID:0,calRSS:"",calPageID:0,calDomainID:0,calURL:$(".view-calendar-link",element).attr("href"),events:[],monthsAdded:[]},start_date=new Date(todayDate-24*todayDate.getDay()*60*60*1e3),end_date=todayDate;function loadEvents(){$(".ui-articles > li",element).each(function(){switch($(".sw-calendar-block-date",this).length&&(blockDate=jQuery.trim($(".sw-calendar-block-date",this).text())),blockDate){case"Today":break;case"Tomorrow":var e=new Date;e.setTime(e.getTime()+864e5),eventsData.events.push({date:longMonths[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear(),jsDate:new Date(e.getFullYear(),e.getMonth(),e.getDate()),day:longDays[e.getDay()],time:jQuery.trim($(".sw-calendar-block-time",this).text()),title:jQuery.trim($(".sw-calendar-block-title a",this).text()),url:$(".sw-calendar-block-title a",this).attr("href")});break;default:var t;blockDate.split(",")[1]?(t=new Date(blockDate),eventsData.events.push({date:longMonths[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear(),jsDate:new Date(t.getFullYear(),t.getMonth(),t.getDate()),day:longDays[t.getDay()],time:jQuery.trim($(".sw-calendar-block-time",this).text()),title:jQuery.trim($(".sw-calendar-block-title a",this).text()),url:$(".sw-calendar-block-title a",this).attr("href")})):"There are no upcoming events to display."==jQuery.trim($(".ui-article-description",this).text())?$(this).remove():(t=(e=$.inArray(blockDate,longDays))>todayDate.getDay()?e-todayDate.getDay():e-todayDate.getDay()+7,(e=new Date).setTime(e.getTime()+864e5*t),eventsData.events.push({date:longMonths[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear(),jsDate:new Date(e.getFullYear(),e.getMonth(),e.getDate()),day:longDays[e.getDay()],time:jQuery.trim($(".sw-calendar-block-time",this).text()),title:jQuery.trim($(".sw-calendar-block-title a",this).text()),url:$(".sw-calendar-block-title a",this).attr("href")}))}}),0<todayDate.getDay()&&$.ajax({type:"POST",url:"/site/UserControls/Calendar/CalendarController.aspx/GetEvents",data:"{ ModuleInstanceID: "+eventsData.calID+", StartDate: '"+(start_date.getMonth()+1)+"/"+start_date.getDate()+"/"+start_date.getFullYear()+"', EndDate: '"+(end_date.getMonth()+1)+"/"+end_date.getDate()+"/"+end_date.getFullYear()+"' }",contentType:"application/json; charset=utf-8",dataType:"json",cache:!1,success:function(data){if(""!=data.d)for(var calEvents=eval(data.d),e=0;e<calEvents.length;e++){var eventTitle=jQuery.trim(calEvents[e].title),start=calEvents[e].start,end=calEvents[e].end,startDate=new Date(start),endDate=new Date(end),eventTime=1==calEvents[e].allDay?"allDay":convertTime(start)+" - "+convertTime(end);if(startDate!=endDate){var loopStart=new Date(startDate);loopStart.setDate(loopStart.getDate());var loopEnd=new Date(endDate);for(loopEnd.setDate(loopEnd.getDate());loopStart<=loopEnd;){var longDate=longMonths[startDate.getMonth()]+" "+startDate.getDate()+", "+startDate.getFullYear();eventsData.events.push({date:longDate,jsDate:new Date(longDate),day:longDays[loopStart.getDay()],eventsLoaded:new Date(loopStart.getFullYear(),loopStart.getMonth()),time:eventTime,title:eventTitle,url:"/site/Default.aspx?PageID="+eventsData.calPageID+"&PageType=17&DomainID="+eventsData.calDomainID+"&ModuleInstanceID="+eventsData.calID+"&EventDateID="+calEvents[e].id}),loopStart.setDate(loopStart.getDate()+1)}}else{var longDate=longMonths[startDate.getMonth()]+" "+startDate.getDate()+", "+startDate.getFullYear();eventsData.events.push({date:longDate,jsDate:new Date(longDate),day:longDays[startDate.getDay()],eventsLoaded:new Date(startDate.getFullYear(),startDate.getMonth()),time:eventTime,title:eventTitle,url:"/site/Default.aspx?PageID="+eventsData.calPageID+"&PageType=17&DomainID="+eventsData.calDomainID+"&ModuleInstanceID="+eventsData.calID+"&EventDateID="+calEvents[e].id})}}eventsData.events=sortByKey(eventsData.events,"jsDate"),buildSlider()}})}function buildSlider(){$("body").append("<div class='cs-calendar-popup-outer'><div class='popup-background-overlay'></div><div class='cs-calendar-popup'><div class='popup-header'><h3 class='cs-dayofweek'></h3><h6 class='cs-date'></h6></div><div class='popup-events-cont'></div><div class='popup-footer'></div></div></div>");for(var e=$("<div class='events-slider-outer'><div class='events-slider-inner'><div class='slide-btn back-button hidden'></div><div class='events-overflow'><div class='events-slider ui-clear'></div></div><div class='slide-btn next-button'></div></div></div>"),t=$("<div class='slider-day'><h3 class='cs-dayofweek'></h3><h6 class='cs-date'></h6><div class='count-container hidden'><span>Events</span><div class='count'></div></div><div class='allday-title hidden'></div></div>"),a=e.find(".events-slider"),n=new Date(start_date.setHours(0,0,0,0)),s=eventsData.events[eventsData.events.length-1].jsDate,i=s.setDate(s.getDate()+(6-s.getDay())),o=0;n<=i;){var l=t.clone(),d=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear();l.attr("style","left:"+153*o+"px").addClass(shortDays[n.getDay()].toLowerCase()),l.attr({"data-date":d,"data-count":0,"data-alldayed":0}),l.find(".cs-dayofweek").text(shortDays[n.getDay()]),l.find(".cs-date").text(shortMonths[n.getMonth()]+" "+(n.getDate()<10?"0"+n.getDate():n.getDate())),a.append(l);l=n.setDate(n.getDate()+1),n=new Date(l);o++}$(element).find(".ui-widget-detail").append(e),$.each(eventsData.events,function(){var e=new Date(this.date),e=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear();$my_day=$(".slider-day[data-date='"+e+"']");e=parseInt($my_day.attr("data-count"));$my_day.attr("data-count",e+1),"allDay"!=this.time&&""!=this.time||$my_day.find(".allday-title").hasClass("hidden")&&$my_day.find(".allday-title").text(this.title).removeClass("hidden"),0<parseInt($my_day.attr("data-count"))&&($my_day.addClass("has-events"),$my_day.find(".count").text($my_day.attr("data-count")),$my_day.find(".count-container").removeClass("hidden"))}),$(document).on("click",".has-events",function(){populatePopup($(this).data("date"))}),$(document).on("click",".popup-background-overlay",function(){$(".cs-calendar-popup-outer").fadeOut()}),$(document).on("click",".next-button",function(){$(this).hasClass("disabled")||slideNext()}),$(document).on("click",".back-button",function(){$(this).hasClass("disabled")||slideBack()})}function slideNext(){var e=slideVars(),a=$(".slider-day").length;$(".slide-btn").addClass("disabled"),$(".events-slider").animate({left:"-="+e},2e3,function(){var e=$(this).position().left,t=-153*a+slideVars();console.log("leftPos = "+e+" total = "+t),$(".slide-btn").removeClass("disabled"),e<=t&&$(".next-button").addClass("hidden")}),$(".back-button").removeClass("hidden")}function slideBack(){var e=slideVars();$(".slide-btn").addClass("disabled"),$(".next-button").removeClass("hidden"),$(".events-slider").animate({left:"+="+e},2e3,function(){$(".slide-btn").removeClass("disabled"),0==$(".events-slider").position().left&&$(".back-button").addClass("hidden")})}function slideVars(){var e=$(window).width(),t=config.days;return e<1280&&1024<=e?t=config.days1024:e<1024&&768<=e?t=config.days768:e<768&&640<=e?t=config.days640:e<640&&480<=e?t=config.days480:e<480&&(t=config.days320),153*t}function populatePopup(e){var t=new Date(e),a=shortDays[t.getDay()],n=shortMonths[t.getMonth()],e=t.getDate()<10?"0"+t.getDate():t.getDate(),s=new Date(t.setHours(0,0,0,0)),i=$("<div class='popup-event'><a href='#'></a><span class='time'></span></div>");$(".popup-events-cont").empty(),$.each(eventsData.events,function(){var e=new Date(this.date);new Date(e.setHours(0,0,0,0)).toString()==s.toString()&&($evt=i.clone(),$evt.find("a").text(this.title).attr("href",this.url),"allDay"==this.time||""==this.time?$evt.find(".time").text("All Day"):$evt.find(".time").text(this.time),$(".popup-events-cont").append($evt))}),$(".popup-header .cs-dayofweek").text(a),$(".popup-header .cs-date").text(n+" "+e),$(".popup-footer .view-calendar-link").length||$(".popup-footer").append($(element).find(".view-calendar-link").clone()),$(".popup-footer .cs-calendar-link").length||$(".popup-footer").append("<a href='"+eventsData.calRSS+"' class='cs-calendar-link'><span>"+config.RSSLinkText+"</span></a>"),$(".cs-calendar-popup-outer").fadeIn()}function checkForEvents(e){var t=0;return t<eventsData.events.length&&jQuery.trim(eventsData.events[t].jsDate)==jQuery.trim(e)}function createCookie(e,t,a){var n=a?((n=new Date).setTime(n.getTime()+24*a*60*60*1e3),"; expires="+n.toGMTString()):"";document.cookie=escape(e)+"="+escape(t)+n+"; path=/"}function readCookie(e){for(var t=escape(e)+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){for(var s=a[n];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return unescape(s.substring(t.length,s.length))}return null}function convertTime(e){var t=e.getHours(),a=e.getMinutes(),e=12<=t?" PM":" AM";return(t=(t%=12)||12)+":"+(a=a<10?"0"+a:a)+e}function sortByKey(e,a){return e.sort(function(e,t){e=e[a],t=t[a];return e<t?-1:t<e?1:0})}function buildStyleSheet(){var e,t,a=document.createElement("style");a&&(a.setAttribute("type","text/css"),(t=document.getElementsByTagName("head")[0])&&t.insertBefore(a,t.childNodes[0]),e="#"+moduleID+" .upcomingevents .ui-articles {display: none;}.hidden {display:none;}.events-slider-outer {position:relative;}.events-slider-inner {position:relative;width:1071px;height:126px;margin:0 auto;}.events-overflow {position:relative;width:100%;height:126px;overflow:hidden;}.events-slider {position:relative;width:1071px;height:126px;}.slider-day.has-events {cursor: pointer;}.slide-btn {cursor:pointer;}.slide-btn.disabled {cursor:default;opacity:0.3;}.next-button {position:absolute;top:20px;right:-40px;width:30px;height:50px;background:green;}.back-button {position:absolute;top:20px;left:-40px;width:30px;height:50px;background:orange;}.slider-day {position:absolute;top:0px;left:0px;width:153px;height:126px;}.cs-dayofweek {font-size: 23px;font-weight: 700;text-transform: uppercase;margin:0;}.cs-date {font-size: 12px;font-weight: 700;text-transform: uppercase;margin:0;}.slider-day .count-container {position: absolute;top: 20px;right: 20px;}.slider-day .count-container .count {border-radius: 50%;}.slider-day .allday-title {font-size: 12px;font-style: italic;}.popup-background-overlay {position: absolute;top: 0;left: 0;width: 100%;height: 100%;background: rgba(0,0,0,.25);}.cs-calendar-popup-outer {position: fixed;width: 100%;height: 100%;top: 0;left: 0;text-align: center;z-index: 10000;display: none;}.cs-calendar-popup-outer:before {content: '';display: inline-block;height: 100%;vertical-align: middle;margin-right: -0.25em}.cs-calendar-popup {display: inline-block;vertical-align: middle;width: 403px;position: relative;background: #FFF;}@media (max-width: 1279px) {.events-slider-inner {width:918px;}}@media (max-width: 1023px) {.events-slider-inner {width:612px;}}@media (max-width: 767px) {.events-slider-inner {width:459px;}}@media (max-width: 639px) {.events-slider-inner {width:306px;}}@media (max-width: 479px) {.events-slider-inner {width:153px;}}",t=document.createTextNode(e),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t)),window.csEventsCSS=1}calModuleID=moduleID.replace("module-content-","");var eventCalCookie="eventsCal"+calModuleID,eventCalCookiePageID="eventsCal"+calModuleID+"PageID",eventCalCookieDomainID="eventsCal"+calModuleID+"DomainID",eventCalCookieModID="eventsCal"+calModuleID+"ModID",eventCalCookieRSS="eventsCal"+calModuleID+"RSS";readCookie(eventCalCookie)?(eventsData.calPageID=readCookie(eventCalCookiePageID),eventsData.calDomainID=readCookie(eventCalCookieDomainID),eventsData.calID=readCookie(eventCalCookieModID),eventsData.calRSS=readCookie(eventCalCookieRSS),loadEvents(start_date,end_date)):$.ajax({url:eventsData.calURL,cache:!1,dataType:"html"}).done(function(e){var t=function e(t){for(var a=[],n=0;n<t.childNodes.length;n++){var s=t.childNodes[n];8===s.nodeType?a.push(s):a.push.apply(a,e(s))}return a}(document)[0].nodeValue.match(/\<Attribute name="siteid"\>[0-9].*?\<\/Attribute\>/gi),t=parseInt($.trim(t[0].replace(/\<Attribute name="siteid"\>|\<\/Attribute\>/gi,"")));eventsData.calPageID=parseInt(eventsData.calURL.replace("/Page/","")),eventsData.calDomainID=t,eventsData.calID=$(e).find(".ui-widget.app.calendar").closest("div[id^='module-content']").attr("id").replace("module-content-",""),createCookie(eventCalCookie,1),createCookie(eventCalCookiePageID,eventsData.calPageID),createCookie(eventCalCookieDomainID,eventsData.calDomainID),createCookie(eventCalCookieModID,eventsData.calID),createCookie(eventCalCookieRSS,eventsData.calRSS),loadEvents(start_date,end_date)}),window.csEventsCSS||buildStyleSheet()})}}(jQuery);