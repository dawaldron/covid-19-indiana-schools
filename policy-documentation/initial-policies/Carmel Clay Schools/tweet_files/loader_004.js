(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{"Pc/x":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));const n=new(i("qrPT").a);var r=i("G6rE");let o;const a=new Error("[AudioModule] config not initialized");var s=new class{constructor(){this.proxsee=n}init(e){o=e,n.init(o)}initialized(){return!!o}loggedInUser(){if(this.initialized()){const e=o.store.getState();return r.e.selectLoggedInUser(e)}}audioSpace(e){return o?o.api.AudioSpaces.byId(e):Promise.reject(a)}subscribeToScheduledSpace(e){return o?o.api.AudioSpaces.subscribeToScheduledSpaceById(e):Promise.reject(a)}unsubscribeFromScheduledSpace(e){return o?o.api.AudioSpaces.unsubscribeFromScheduledSpaceById(e):Promise.reject(a)}}},qrPT:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var n=i("KEM+"),r=i.n(n),o=i("CEs6");class a extends Error{constructor(e,t,i){super(`${a.displayName}: ${e} HTTP-${t} message: ${i}`),this.url=e,this.status=t}}r()(a,"displayName","ProxseeApiError");var s=i("epkG"),c=i("SrIh"),u=i("RqPI");let l,p=0;class d{constructor(e=m){r()(this,"reportSpaceFor",{SelfHarm:e=>this._reportSpace({abuse_type:_.SelfHarm,...e}),Violence:e=>this._reportSpace({abuse_type:_.Violence,...e}),SexualContent:e=>this._reportSpace({abuse_type:_.SexualContent,...e}),ChildSafety:e=>this._reportSpace({abuse_type:_.ChildSafety,...e}),PrivateInformation:e=>this._reportSpace({abuse_type:_.PrivateInformation,...e}),AbusiveBehavior:e=>this._reportSpace({abuse_type:_.AbusiveBehavior,...e})});const{httpConfig:t}=e;this.client=new s.a({...b,...t}),this._authToken=void 0,this._authPromise=null}init(e){l=e}initialized(){return!!l}isLoggedIn(){return!!this._authToken}isTwitterAuthenticated(){if(!this.initialized())return!1;const e=l.store.getState();return Object(u.j)(e)}authToken(){return this._authToken}dispatch(e){return this.initialized()?this.client.dispatch(e).then(o.a):Promise.reject(new Error("[ProxseeApi] config not initialized"))}post(e,t,i={}){const{params:n}=i,r=Object.assign(function(){const e=Date.now();return p=e<=p?p+1:e,Object.assign({},y,{[h]:p,"content-type":"application/json"})}(),i.headers),o=JSON.stringify({...t,cookie:this._authToken}),a="Twitter"===this._authUserType?`twitter/${e}`:e;return this.dispatch({method:"POST",path:`/api/v2/${a}`,headers:r,params:n,data:o})}login(){return this._authPromise?this._authPromise:this.initialized()?this.isTwitterAuthenticated()?this.isLoggedIn()?Promise.resolve():(this._authPromise=l.api.Auth.authenticatePeriscope().then((e=>this.loginTwitterToken(e.token))).then((e=>{if(!e)throw new Error("[ProxseeApi] invalid loginTwitterToken response");this._authToken=e.cookie,this._authUserType=e.type})).catch((e=>{const t={err:e};Object(c.a)("[ProxseeApi] failed to login",{extra:t})})).then((()=>{this._authPromise=null})),this._authPromise):Promise.resolve():Promise.reject(new Error("[ProxseeApi] config not initialized"))}loginTwitterToken(e){const t={jwt:e,vendor_id:f,create_user:!1,direct:!0};return this.post("loginTwitterToken",t)}accessChat(e){const t=this.isLoggedIn()?"accessChat":"accessChatPublic";return this.post(t,{chat_token:e})}_reportSpace(e){return this.post("markAbuse",e).catch((e=>{Object(c.a)("[ProxseeApi] failed to report space",{extra:{err:e}})}))}}const h="X-Idempotence",y={["X-Periscope-User-Agent"]:"Twitter/m5",["X-Attempt"]:1};const f="m5-proxsee-login-a2011357b73e",m={},b={host:"https://proxsee.pscp.tv",errorFilter:function(e,t){return t(e).then((t=>{return t.status&&((i=t.status)<200||i>399)?Promise.reject(function(e,t){const{uri:i}=e,{status:n}=t,r=Object(o.a)(t);return new a(i,n,r.msg)}(e,t)):t;var i}))}};const _=Object.freeze({SelfHarm:"SELF_HARM",Violence:"VIOLENCE",SexualContent:"SEXUAL_CONTENT",ChildSafety:"CSE",PrivateInformation:"PRIVATE_INFO",AbusiveBehavior:"HARASSMENT"})},u2Vg:function(e,t,i){"use strict";i.r(t),i.d(t,"__DANGEROUS_IMPORT_VIDEOPLAYER_BASE__",(function(){return S})),i.d(t,"__DANGEROUS_IMPORT__",(function(){return T}));i("kYxP");var n=i("ERkP"),r=i("v6aA"),o=i("rxPX");const a=()=>(e,t,{api:i})=>i.getHttpClient();var s=Object(o.a)().propsFromActions((()=>({getTwitterAuthedHttpClient:a}))).withAnalytics(),c=i("Pc/x"),u=i("Xq8B");var l=i("epkG"),p=i("88qn"),d=i("fs1G"),h=i("mf9H"),y=i("lklz"),f=i("MWbm"),m=i("HT/6"),b=i("Zl35"),_=i("rHpw");function P(e){const{featureSwitches:t}=n.useContext(r.a),{broadcastId:i,mediaKey:o,media:a,requestedTimecode:s,onEnded:l,onPlayerApi:f,onPlayerState:b}=e,[_,P]=n.useState(null),S=n.useRef({playbackCoordinationEmitter:null,previousPlayerState:null}),T=a||i&&o;if(n.useEffect((()=>{null===_&&T&&Object(p.a)({showControls:!1,source:{}},t).then((e=>P((()=>e))))}),[_,T,t]),n.useEffect((()=>function(){const{playbackCoordinationEmitter:e}=S.current;e&&e.unregister()}),[]),null===_||!T)return null;const k={analytics:function(e,t){const i={scribeContext:{...e.analytics.contextualScribeNamespace},enableShortFormCompleteLogging:t.isTrue("responsive_web_video_pcomplete_enabled"),periscopeAuthToken:c.a.proxsee.authToken()},n={log:t=>{const{category:i,data:n,namespace:r}=t;null!=r&&r.action&&e.analytics.scribe({...r,data:{...n,_category_:i}})}};return new u.a(n,{log:()=>{}},e.getTwitterAuthedHttpClient(),i)}(e,t),basePlayerClass:_,httpClient:v,onApiReady:function(t){var n;t.play(),"function"==typeof f&&f(t);const r=null==a||null==(n=a.video_info)?void 0:n.duration_millis;"number"==typeof r&&"number"==typeof s&&t.scrubToFraction(s/r);const c=e.disablePlaybackCoordination?d.a:()=>t.pause(),u=i&&o?m.a.SPACE:m.a.NORMAL;S.current.playbackCoordinationEmitter=function(e,t){const i={onAutoPlayRequest:()=>{},onPauseRequest:e,canAutoplay:!1,isLooping:!1,playbackPriority:t};return h.b.register(i)}(c,u)},onStateUpdate:function(e,t){"function"==typeof b&&b(e,t),function(e){const t=A(e);e.isPlaying&&t&&t.durationMs===t.currentTimeMs&&"function"==typeof l&&(l(),S.current.playbackCoordinationEmitter&&S.current.playbackCoordinationEmitter.signalPlaybackFinish())}(e),function(e){const{playbackCoordinationEmitter:t,previousPlayerState:i}=S.current,n=null===i,r=null==i?void 0:i.isPlaying,o=e.isPlaying,a=!n&&r&&!o;!n&&r||!o?a&&t&&t.signalPause():t&&t.signalPlay()}(e),S.current.previousPlayerState=e},twitterAuthedHttpClient:e.getTwitterAuthedHttpClient()};if(i&&o){const e={...k,configType:"static",contentId:o,contentType:"broadcast",variants:[],videoId:y.b.forAudioSpace(i,o)};return n.createElement(g,{key:i,playerConfig:e})}if(a){const e={...k,configType:"static",contentId:a.id_str,loop:!1,contentType:"media_entity",durationMs:a.video_info.duration_millis,variants:a.video_info.variants.map((({bitrate:e,content_type:t,url:i})=>({type:t,src:i})))};return n.createElement(g,{key:a.id_str,playerConfig:e})}return null}function g({playerConfig:e}){return n.createElement(f.a,{style:k.displayNone},n.createElement(b.b,e))}const S=P,T=s(P),A=e=>e&&e.tracks[e.currentTrackId],v=new l.a({}),k=_.a.create((e=>({displayNone:{display:"none"}})))}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.AudioOnlyVideoPlayer.c05e6185.js.map