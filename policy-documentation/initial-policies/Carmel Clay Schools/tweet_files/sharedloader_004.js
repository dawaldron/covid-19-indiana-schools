(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"72nz":function(e,t,s){"use strict";s.r(t),s.d(t,"SearchBoxContainer",(function(){return Ke}));var a=s("97Jx"),r=s.n(a),n=s("KEM+"),c=s.n(n),i=(s("MvUL"),s("ERkP")),o=s("ZNx0"),h=s("lnti"),l=s("wtjx"),d=s("rxPX");var u=Object(d.a)().propsFromActions((()=>({addQuery:l.a}))).withAnalytics({component:"search_box"}),p=s("3XMw"),m=s.n(p),S=s("8jkQ"),y=s("u3ZE"),_=s("rRIm"),f=s("Rp9C"),b=(s("kYxP"),s("0KEI")),v=s("hqKg"),I=s("kGix"),E=s("3IPs"),g=s("M0jS"),w=s("G6rE"),R=s("k49u"),C=s("J4ZH"),T=s("v4XE");const x=e=>Object(R.c)(e,R.a.GenericUserNotFound)||Object(R.c)(e,R.a.OtherUserSuspended)||Object(R.c)(e,R.a.AddressBookLookupNotFound);var k=Object(d.a)().propsFromState((()=>{const e=Object(v.createSelector)(l.g,w.e.selectFetchStatuses,((e,t)=>{const s=Object(h.a)(e.map((e=>{var s;const a=null==(s=e.user)?void 0:s.id;return a&&t[a]?{id:a,fetchStatus:t[a]}:void 0})));return Object(C.a)(s,(e=>e.fetchStatus))})),t=Object(v.createSelector)(e,(e=>(e[I.a.FAILED]||[]).map((e=>e.id)))),s=Object(v.createSelector)(e,w.e.selectErrors,((e,t)=>(e[I.a.FAILED]||[]).filter((({id:e})=>x(t[e]||{}))).map((e=>e.id)))),a=Object(v.createSelector)(e,w.e.selectErrors,((e,t)=>{const s=(e[I.a.FAILED]||[]).filter((({id:e})=>!x(t[e]||{})));return(e[I.a.LOADING]||[]).length>0?I.a.LOADING:(e[I.a.LOADED]||[]).length>0?I.a.LOADED:s.length>0?I.a.FAILED:I.a.NONE})),r=Object(v.createSelector)(l.g,(e=>e.map((e=>({...e,category:E.b.RecentSearch}))))),n=Object(v.createSelector)(T.d,(e=>e.map((e=>({keyword:{query:e.query},savedSearchId:e.id_str,category:E.b.SavedSearch})))));return{isRecentSearchDataLoaded:l.e,recentSearches:r,usersFetchStatus:a,invalidRecentSearchUserIds:s,failedRecentSearchUserIds:t,savedSearches:n}})).adjustStateProps((({isRecentSearchDataLoaded:e,recentSearches:t,usersFetchStatus:s,invalidRecentSearchUserIds:a,failedRecentSearchUserIds:r,savedSearches:n})=>{const c=!t.filter((({user:e})=>e&&a.indexOf(e.id)<0)).length,i=s!==I.a.LOADING&&e&&c?I.a.LOADED:s;return{failedRecentSearchUserIds:r,invalidRecentSearchUserIds:a,recentSearches:t,fetchStatus:i,savedSearches:n}})).propsFromActions((()=>({clearAll:l.b,createLocalApiErrorHandler:Object(b.d)("SEARCH_ONE_CLICK"),deleteSavedSearch:T.a,fetchRecentSearchesIfNeeded:l.c,fetchSavedSearchesIfNeeded:T.b,fetchUsersIfNeeded:w.e.fetchManyIfNeeded,fetchUsersPresenceIfNeeded:g.b.fetchManyIfNeeded,removeQuery:l.d}))).withAnalytics({element:"typeahead"}),O=s("sYRn"),D=s("v//M"),U=s("7nmT"),A=s.n(U),F=s("hOZg"),L=s("5T6p"),N=s("MWbm"),q=s("/yvb"),j=s("rHpw");const M=m.a.e68b09b4;class P extends i.PureComponent{render(){const{id:e,onRemove:t,...s}=this.props;return e?i.createElement(N.a,{style:H.root},i.createElement(L.a,s),i.createElement(q.a,{accessibilityLabel:M,icon:i.createElement(F.a,null),onPress:t,size:j.a.isVdlRefreshEnabled()?"experimentalSmall":"small",style:H.button,type:"text"})):null}get searchItemData(){const{id:e,image:t,title:s,supportText:a}=this.props;return{category:E.b.RecentSearch,query:e,recentSearchType:E.a.Event,queryMetadata:{id:e,image:t,title:s,supportText:a}}}}const H=j.a.create((e=>({root:{flexDirection:"row",justifyContent:"space-between"},button:{alignSelf:"center"}})));var V=P,B=s("j7Bv"),K=s("5mJL"),Q=s("t62R"),z=s("EHV7");const $=i.createElement(F.a,null),G=m.a.e68b09b4;class W extends i.Component{render(){const{id:e,name:t,description:s,onRemove:a,withNewTypeaheadUI:r}=this.props;if(!e)return null;const n=r?"xxxLarge":"xLarge",c=i.createElement(B.a,{Icon:z.a,color:"primary",size:n,style:Y.searchIcon});return i.createElement(K.a,{avatarCell:c,avatarSize:n,cellStyle:Y.bodyColumn},i.createElement(N.a,null,i.createElement(Q.c,{numberOfLines:1,weight:"bold",withHashflags:!0},t),i.createElement(Q.c,{color:"gray700",numberOfLines:1,withHashflags:!0},s)),i.createElement(q.a,{accessibilityLabel:G,icon:$,onPress:a,size:j.a.isVdlRefreshEnabled()?"experimentalSmall":"small",type:"text"}))}get searchItemData(){const{id:e,name:t,description:s}=this.props;return e?{category:E.b.RecentSearch,query:e,recentSearchType:E.a.Topic,queryMetadata:{id:e,name:t,description:s}}:null}}var X=W;const Y=j.a.create((e=>({bodyColumn:{alignItems:"center",flexDirection:"row",justifyContent:"space-between"},searchIcon:{marginRight:e.spaces.space12}}))),J=(e,t)=>w.e.select(e,t.id),Z=(e,t)=>Object(g.c)(e,t.id),ee=(e,t)=>Object(g.d)(e,t.id);var te=Object(d.a)().propsFromState((()=>({user:J,userFleets:Z,userSpace:ee}))),se=s("v6aA"),ae=s("GjuJ"),re=s("IMA+");const ne=i.createElement(F.a,null),ce=m.a.e68b09b4,ie=m.a.fd06b02f;class oe extends i.Component{constructor(...e){super(...e),c()(this,"_handleAvatarClick",(()=>{const{userFleets:e,userSpace:t}=this.props;e||t||this._handleClick()})),c()(this,"_handleClick",(()=>{const{index:e,onItemClick:t}=this.props,s=this.searchItemData;s&&t(s,e)}))}render(){const{user:e,onRemove:t,userFleets:s,userSpace:a,style:r,withNewTypeaheadUI:n}=this.props,{featureSwitches:c}=this.context;if(!e)return null;const o=a&&c.isTrue("voice_rooms_recent_search_audiospace_ring_enabled")?a:void 0,h=s&&!a?((e,t,s)=>s.isTrue("responsive_web_fleets_user_presence_enabled")?{presenceRingType:e.fully_read?ae.a.FleetRead:ae.a.FleetUnread,link:`/${t}/fleets/`}:void 0)(s,e.screen_name,c):void 0,l=o||h;o&&(o.accessibilityLabel=ie({screenName:e.screen_name}));const d=i.createElement(q.a,{accessibilityLabel:ce,icon:ne,onPress:t,size:j.a.isVdlRefreshEnabled()?"experimentalSmall":"small",type:"text"});return i.createElement(re.a,{avatarSize:"xLarge",avatarUri:e.profile_image_url_https,decoration:d,displayMode:n?"ExperimentalUserTypeahead":"UserCompact",isProtected:e.protected,isVerified:e.verified,name:e.name,onAvatarClick:this._handleAvatarClick,onCellClick:this._handleClick,onScreenNameClick:this._handleClick,presenceIndicator:l,screenName:e.screen_name,style:r,userId:e.id_str,withInteractiveStyling:!1,withLink:!1,withUsernameCenterAligned:!0})}get searchItemData(){return this.props.user?{category:E.b.RecentSearch,link:this.props.user.screen_name,query:this.props.id,recentSearchType:E.a.User}:null}}c()(oe,"contextType",se.a);var he=te.forwardRef(oe),le=s("oQhu"),de=s("hiGS"),ue=s("VwDm");const pe=i.createElement(F.a,null),me=i.createElement(de.a,null),Se=Object(le.a)((e=>e===E.b.SavedSearch?"destructiveText":"text")),ye=Object(le.a)((e=>e===E.b.SavedSearch?me:pe));class _e extends i.Component{constructor(...e){super(...e),c()(this,"_getButtonType",(()=>{const{category:e}=this.props;return Se(e)})),c()(this,"_getRemoveIcon",(()=>{const{category:e}=this.props;return ye(e)}))}render(){const{query:e,onRemove:t,withNewTypeaheadUI:s}=this.props,a=s?"xxxLarge":"xLarge",r=i.createElement(B.a,{Icon:ue.a,color:"neutral",size:a,style:fe.searchIcon});return i.createElement(K.a,{avatarCell:r,avatarSize:a,cellStyle:fe.bodyColumn},i.createElement(Q.c,{numberOfLines:1,withHashflags:!0},e),i.createElement(q.a,{accessibilityLabel:"",icon:this._getRemoveIcon(),onPress:t,size:j.a.isVdlRefreshEnabled()?"experimentalSmall":"small",type:this._getButtonType()}))}get searchItemData(){const{category:e,query:t}=this.props;return{category:e,query:t,recentSearchType:e===E.b.RecentSearch?E.a.Keyword:void 0}}}const fe=j.a.create((e=>({bodyColumn:{alignItems:"center",flexDirection:"row",justifyContent:"space-between"},searchIcon:{marginRight:e.spaces.space12}})));var be=_e,ve=s("htQn");class Ie extends i.Component{constructor(e,t){super(e,t),c()(this,"_renderSearchItem",(()=>{const{item:e,index:t,onItemClick:s}=this.props;return e.keyword?i.createElement(be,{category:e.category,onRemove:this._handleOnRemove,query:e.keyword.query,ref:this._handleItemRef,withNewTypeaheadUI:this._withNewTypeaheadUI}):e.user?i.createElement(he,{id:e.user.id||"",index:t,onItemClick:s,onRemove:this._handleOnRemove,ref:this._handleItemRef,style:Ee.itemPadding,withNewTypeaheadUI:this._withNewTypeaheadUI}):e.topic?i.createElement(X,{description:e.topic.description||"",id:e.topic.id,name:e.topic.name||"",onRemove:this._handleOnRemove,ref:this._handleItemRef,withNewTypeaheadUI:this._withNewTypeaheadUI}):e.event?i.createElement(V,{id:e.event.id,image:e.event.image||{url:"",height:0,width:0},onRemove:this._handleOnRemove,ref:this._handleItemRef,supportText:e.event.supportText||"",title:e.event.title||"",withNewTypeaheadUI:this._withNewTypeaheadUI}):null})),c()(this,"_handleItemRef",(e=>{this._itemRef=e})),c()(this,"_handleOnRemove",(e=>{const{onRemoveQuery:t,item:s,index:a}=this.props;t(s,a),e.stopPropagation()})),c()(this,"_handleOnClick",(()=>{const{onItemClick:e,index:t,item:s}=this.props;s.user||this.searchItemData&&e(this.searchItemData,t)})),this._withNewTypeaheadUI=this.context.featureSwitches.isTrue("responsive_web_account_search_readability_enabled")}render(){const{domId:e,item:t}=this.props;return i.createElement(o.a,{viewType:"search_item"},i.createElement(ve.a,{accessibilityRole:"option",accessibilityState:{selected:!!e},focusable:!0,nativeID:e,onClick:this._handleOnClick,style:[Ee.root,!this._withNewTypeaheadUI&&!j.a.isVdlRefreshEnabled()&&Ee.border,e&&Ee.focused,!(null!=t&&t.user)&&Ee.itemPadding]},this._renderSearchItem()))}get searchItemData(){return this._itemRef?this._itemRef.searchItemData:null}}c()(Ie,"contextType",se.a);const Ee=j.a.create((e=>({root:{cursor:"pointer"},border:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:1},itemPadding:{paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.componentDimensions.gutterVertical},focused:{backgroundColor:e.colors.gray0}})));var ge=Ie,we=s("eb3s"),Re=s("MXDK");const Ce=m.a.ee295fbe,Te={headline:m.a.f45c425f,text:m.a.caae4dd9,confirmButtonLabel:m.a.dbd5d40f},xe=m.a.a8d68f61,ke=m.a.c6530778,Oe=m.a.e047b8fa,De=["user","keyword"];class Ue extends i.Component{constructor(e,t){super(e,t),c()(this,"_withNewTypeaheadUI",!1),c()(this,"_getRecentSearchItems",(()=>{const{failedRecentSearchUserIds:e,recentSearches:t}=this.props,{allowedRecentSearchItems:s}=this.state,a=t.filter((({user:t})=>!t||e.indexOf(t.id)<0)).filter((e=>Object.keys(e).some((e=>s.includes(e)))));return a.length>15?a.slice(0,15):a})),c()(this,"_render",(()=>{const{domId:e,savedSearches:t}=this.props,s=0===this._getNumOfSearchItems(),a=this._getRecentSearchItems();return s?i.createElement(N.a,{style:[Ae.emptyState]},i.createElement(Q.c,{align:"center",color:"gray700"},Ce)):i.createElement(N.a,{accessibilityRole:"listbox",nativeID:e},a.length>0?i.createElement(i.Fragment,null,i.createElement(N.a,{style:[Ae.header,!this._withNewTypeaheadUI&&!j.a.isVdlRefreshEnabled()&&Ae.borderBottom]},i.createElement(Q.c,{numberOfLines:1,size:"headline1",weight:"bold"},xe),i.createElement(q.a,{onPress:this._handleClearAllClick,size:"small",type:"text"},Oe)),a.map(((e,t)=>this._renderRecentSearchItem(e,t)))):null,t.length>0?i.createElement(i.Fragment,null,i.createElement(N.a,{accessibilityHidden:!0,style:[Ae.header,j.a.isVdlRefreshEnabled()||this._withNewTypeaheadUI?Ae.borderTop:Ae.borderBottom]},i.createElement(Q.c,{numberOfLines:1,size:"headline1",weight:"bold"},ke)),this._renderSavedSearches()):null)})),c()(this,"_renderRecentSearchItem",((e,t)=>{const{ariaDescendantId:s}=this.props,a=this.state.focusIndex===t;return i.createElement(ge,{domId:a?s:void 0,index:t,item:e,key:this._chooseKeyType(e,t),onItemClick:this._handleOnItemClick,onRemoveQuery:this._handleRemoveQuery,ref:a?this._setFocusedItemRef:void 0})})),c()(this,"_chooseKeyType",((e,t)=>e.keyword?`keyword_${e.keyword.query}`:e.user?`user_${e.user.id}`:e.topic?`topic_${e.topic.id}`:e.event?`event_${e.event.id}`:`${t}`)),c()(this,"_renderSavedSearches",(()=>{const{ariaDescendantId:e,savedSearches:t}=this.props,{focusIndex:s}=this.state,a=this._getRecentSearchItems(),r=[...t];return r.reverse(),i.createElement(N.a,null,r.map(((t,r)=>{const n=s===r+a.length;return i.createElement(ge,{domId:n?e:void 0,index:r,item:t,key:t.savedSearchId,onItemClick:this._handleOnItemClick,onRemoveQuery:this._handleRemoveQuery,ref:n?this._setFocusedItemRef:void 0})})))})),c()(this,"_getNumOfSearchItems",(()=>{const{savedSearches:e}=this.props,t=this._getRecentSearchItems();return e.length+t.length})),c()(this,"_handleUsersRetry",(()=>{this._fetchUsersDetailsIfNeeded()})),c()(this,"_fetchUsersDetailsIfNeeded",(()=>{const{fetchUsersIfNeeded:e,fetchUsersPresenceIfNeeded:t,createLocalApiErrorHandler:s,recentSearches:a,invalidRecentSearchUserIds:r}=this.props,{featureSwitches:n,loggedInUserId:c}=this.context,i=((e,t)=>e.map((e=>{var t;return null==e||null==(t=e.user)?void 0:t.id})).filter(Boolean).filter((e=>t.indexOf(e)<0)))(a,r);e(i).catch(s({})),c&&n.isTrue("voice_rooms_recent_search_audiospace_ring_enabled")&&t(i).catch(s({}))})),c()(this,"_handleRemoveQuery",((e,t)=>{const{analytics:s,removeQuery:a}=this.props;switch(e.category){case E.b.RecentSearch:{const r={keyword:e.keyword,user:e.user,topic:e.topic,event:e.event};a(r),this._resetFocus();const n=f.a.forRecentSearchResult(r,t),c=this._handleRemoveAction(e);n&&s.scribe({action:c,data:{items:[n]}});break}case E.b.SavedSearch:this.setState({shouldShowDeleteSavedSearchConfirmation:!0,savedSearchIdToDelete:e.savedSearchId});break;default:return}})),c()(this,"_handleRemoveAction",(e=>e.user?"clear_user":e.topic?"clear_topic_interests":e.event?"clear_event":"clear_topic")),c()(this,"_handleClearAllClick",(()=>{this.setState({shouldShowClearAllConfirmationSheet:!0})})),c()(this,"_handleOnClearAllConfirm",(()=>{const{analytics:e,clearAll:t}=this.props;t(),e.scribeAction("clear_all"),this.setState({shouldShowClearAllConfirmationSheet:!1})})),c()(this,"_handleOnClearAllCancel",(()=>{this.setState({shouldShowClearAllConfirmationSheet:!1})})),c()(this,"_handleOnDeleteSavedSearchConfirm",(()=>{const{analytics:e,deleteSavedSearch:t,savedSearches:s}=this.props,{savedSearchIdToDelete:a}=this.state,r=s.findIndex((e=>e.savedSearchId===a)),n=s[r];if(a){t(a);const s=n&&f.a.forSavedSearchResult(n.keyword.query,r);s&&e.scribe({element:"saved_search",action:"delete",data:{items:[s]}})}this.setState({shouldShowDeleteSavedSearchConfirmation:!1,savedSearchIdToDelete:void 0})})),c()(this,"_handleOnDeleteSavedSearchCancel",(()=>{this.setState({shouldShowDeleteSavedSearchConfirmation:!1,savedSearchIdToDelete:void 0})})),c()(this,"_handleOnItemClick",((e,t)=>{const{onDismiss:s,onItemClick:a}=this.props;a(e,t),this._scribeClick(e,t),s&&s()})),c()(this,"_scribeRecentSearchImpression",(()=>{const{analytics:e,recentSearches:t}=this.props;if(t&&t.length){const s=Object(h.a)(t.map(((e,t)=>f.a.forRecentSearchResult(e,t))));e.scribe({action:"impression",data:{items:s}})}})),c()(this,"_scribeSavedSearchImpression",(()=>{const{analytics:e,savedSearches:t}=this.props;if(t&&t.length){const s=Object(h.a)(t.map(((e,t)=>f.a.forSavedSearchResult(e.keyword.query,t))));e.scribe({element:"saved_search",action:"impression",data:{items:s}})}})),c()(this,"_scribeClick",((e,t)=>{const{analytics:s}=this.props;switch(e.category){case E.b.SavedSearch:{const a=f.a.forSavedSearchResult(e.query,t);s.scribe({element:"typeahead",action:"click",data:{targets:[a]}});break}case E.b.RecentSearch:{let a;e.recentSearchType&&(a=e.recentSearchType===E.a.User?{user:{type:E.a.User,id:e.query}}:e.recentSearchType===E.a.Event&&e.queryMetadata&&e.queryMetadata.title?{event:{...e.queryMetadata,type:E.a.Event,id:e.query}}:e.recentSearchType===E.a.Topic&&e.queryMetadata&&e.queryMetadata.name?{topic:{...e.queryMetadata,type:E.a.Topic,id:e.query}}:{keyword:{type:E.a.Keyword,query:e.query}});const r=a&&f.a.forRecentSearchResult(a,t);r&&s.scribe({action:"click",data:{targets:[r]}});break}}})),c()(this,"_setFocusedItemRef",(e=>{this._focusedItemRef=e,e&&this._shouldScrollToFocusedItem&&(Object(Re.c)(this._getScrollParent(),this._getFocusedItem()),this._shouldScrollToFocusedItem=!1)})),c()(this,"hasFocusedItem",(()=>this._getNumOfSearchItems()>0)),c()(this,"selectFocusedItem",(()=>{if(this.hasFocusedItem()){const e=this._focusedItemRef&&this._focusedItemRef.searchItemData;e&&this._handleOnItemClick(e,this.state.focusIndex)}})),c()(this,"_setFocusIndex",((e,t)=>{const{onItemFocusChanged:s}=this.props;this._shouldScrollToFocusedItem=t,this.setState({focusIndex:e}),s&&s()})),c()(this,"_resetFocus",(()=>{this._setFocusIndex(-1)})),c()(this,"focusNext",(()=>{const{focusIndex:e}=this.state,t=this._getNumOfSearchItems();if(0===t)return;const s=e+1>=t?0:e+1;this._setFocusIndex(s,!0)})),c()(this,"focusPrevious",(()=>{const{focusIndex:e}=this.state,t=this._getNumOfSearchItems();if(0===t)return;const s=e-1<0?t-1:e-1;this._setFocusIndex(s,!0)}));const{featureSwitches:s}=this.context;var a,r;this.state={focusIndex:0,shouldShowClearAllConfirmationSheet:!1,shouldShowDeleteSavedSearchConfirmation:!1,allowedRecentSearchItems:(a=!0===s.getValueWithoutScribeImpression("responsive_web_recent_searches_topics_enabled"),r=!0===s.getValueWithoutScribeImpression("responsive_web_recent_searches_events_enabled"),[...De,a?"topic":"",r?"event":""])},this._withNewTypeaheadUI=this.context.featureSwitches.isTrue("responsive_web_account_search_readability_enabled")}componentDidMount(){const{createLocalApiErrorHandler:e,fetchRecentSearchesIfNeeded:t,fetchSavedSearchesIfNeeded:s,recentSearches:a,savedSearches:r}=this.props;t(),s().catch(e({})),this._fetchUsersDetailsIfNeeded(),this._scribeRecentSearchImpression(),this._scribeSavedSearchImpression(),(a&&a.length||r&&r.length)&&this._resetFocus()}componentDidUpdate(e){const{recentSearches:t,savedSearches:s}=this.props;e.recentSearches!==t&&(this._fetchUsersDetailsIfNeeded(),this._resetFocus(),this._scribeRecentSearchImpression()),e.savedSearches!==s&&(this._resetFocus(),this._scribeSavedSearchImpression())}render(){const{style:e,fetchStatus:t}=this.props,{shouldShowClearAllConfirmationSheet:s,shouldShowDeleteSavedSearchConfirmation:a}=this.state;return i.createElement(N.a,{style:e},i.createElement(D.a,{fetchStatus:t,onRequestRetry:this._handleUsersRetry,render:this._render}),s?i.createElement(we.a,{confirmButtonLabel:Te.confirmButtonLabel,confirmButtonType:"destructive",headline:Te.headline,onCancel:this._handleOnClearAllCancel,onConfirm:this._handleOnClearAllConfirm,text:Te.text}):null,a?i.createElement(O.a,{onCancel:this._handleOnDeleteSavedSearchCancel,onConfirm:this._handleOnDeleteSavedSearchConfirm}):null)}_getScrollParent(){if(!this._scrollParent){const e=Object(Re.a)(A.a.findDOMNode(this));this._scrollParent=e===window?null:e}return this._scrollParent}_getFocusedItem(){const e=this._focusedItemRef&&A.a.findDOMNode(this._focusedItemRef);return e instanceof Element?e:null}}c()(Ue,"contextType",se.a);const Ae=j.a.create((e=>({emptyState:{padding:e.spaces.space12,paddingTop:e.spaces.space20},borderTop:{borderTopColor:e.colors.borderColor,borderTopStyle:"solid",borderTopWidth:1},borderBottom:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:1},header:{alignItems:"center",flexDirection:"row",justifyContent:"space-between",paddingVertical:e.componentDimensions.gutterVertical,paddingHorizontal:e.componentDimensions.gutterHorizontal}})));var Fe=k.forwardRef(Ue),Le="SearchBox_Search_Input",Ne=s("TnY3"),qe=s("GZwR"),je=s("4e/K");const Me=m.a.ib2e46ee,Pe=m.a.hbc99b02,He=/^(\w+)$/,Ve=[qe.a.Events,qe.a.Users,qe.a.Topics],Be=e=>"@"===e[0]?e.substring(1):e;class Ke extends i.Component{constructor(e,t){super(e,t),c()(this,"_withNewTypeaheadUI",!1),c()(this,"_reorderResults",((e,t,s,a)=>Object(h.a)([e,t.length?t:void 0,s.length?s:void 0,a.length?a:void 0]))),c()(this,"_renderSearchBoxEmptyState",(e=>i.createElement(Fe,r()({},e,{onItemClick:this._handleSearchItemClick})))),c()(this,"_handleSearchItemClick",(({link:e,query:t,recentSearchType:s,category:a,queryMetadata:r})=>{const{addQuery:n}=this.props;a===E.b.SavedSearch?this._submitQuery({query:t,shouldAddToRecentSearch:!1,src:y.a.SavedSearchClick}):s===E.a.Keyword?this._submitQuery({query:t,shouldAddToRecentSearch:!0,src:y.a.RecentSearchClick}):s===E.a.Event?(this._routeTransition({pathname:`/i/events/${t}`}),r&&r.title&&n({event:{...r,id:t,type:E.a.Event}})):s===E.a.Topic?(this._routeTransition({pathname:`/i/topics/${t}`}),r&&r.name&&n({topic:{...r,id:t,type:E.a.Topic}})):e&&(this._routeTransition({pathname:`/${e}`}),n({user:{id:t,type:E.a.User}}))})),c()(this,"_handleSearchShortcut",(e=>{const t=this._inputRef;t&&(e&&t.setQuery(e),t.focus())})),c()(this,"_getUserExactMatch",(({query:e,hasResults:t,isLoaded:s})=>{const a=Be(e);if(a.match(He))return{id:`${e}_no_result_user`,type:qe.b.NoResult,data:{text:Pe({screenName:a}),type:"user"}}})),c()(this,"_handleOnDismiss",(()=>{const{history:e}=this.props,{location:t}=e,s=t.state||{};if(s.searchFocused){const a={...t,state:{...s,lockScroll:!1,searchFocused:!1}};e.replace(a)}})),c()(this,"_handleOnFocus",(()=>{const{analytics:e,history:t}=this.props,{location:s}=t,a=s.state||{};if(!a.searchFocused){const r={...s,state:{...a,searchFocused:!0,lockScroll:!0}};e.scribe({action:"focus_field"}),t.push(r)}})),c()(this,"_handleChange",(e=>{this.setState({query:e,querySubmitted:!1})})),c()(this,"_handleTypeaheadSubmit",(()=>{const{query:e,items:t}=this.state,{analytics:s}=this.props;/^\s*$/.test(e)||(s.scribe({action:"search",data:{items:f.a.forTypeaheadResults(t),search_details:{query:e}}}),this._submitQuery({query:e,shouldAddToRecentSearch:!0}))})),c()(this,"_handleItemClick",((e,t)=>{const{addQuery:s}=this.props,{query:a}=this.state;switch(e.type){case qe.b.User:if(e.data.id_str){s({user:{id:e.data.id_str,type:E.a.User}})}this._routeTransition({pathname:`/${e.data.screen_name}`});break;case qe.b.Topic:case qe.b.Hashtag:this._submitQuery({query:e.data.topic,shouldAddToRecentSearch:!0,src:y.a.TypeaheadClick});break;case qe.b.Event:e.data&&e.data.url?this._routeTransition({pathname:S.b.parseInternalUrl(e.data.url)}):this._submitQuery({query:e.data.topic,src:y.a.TypeaheadClick});break;case qe.b.NoResult:{const{type:t}=e.data;"user"===t?this._routeTransition({pathname:`/${Be(a)}`}):"topic"===t&&this._submitQuery({query:a,shouldAddToRecentSearch:!0,src:y.a.TypeaheadClick});break}}})),c()(this,"_handleItemsChanged",(e=>{this.setState({items:e})})),c()(this,"_routeTransition",(({pathname:e,query:t,params:s,src:a})=>{const{history:r,location:n}=this.props,c={...n,pathname:e,search:"",query:s||(t?{q:t,src:a}:{}),state:{...n.state,searchFocused:!1,lockScroll:!1}};r.replace(c)})),c()(this,"_submitQuery",(({query:e,shouldAddToRecentSearch:t=!1,src:s=y.a.Typed})=>{const{addQuery:a,mode:r,onSubmit:n,searchFilters:c,searchRoute:i}=this.props;if(n&&n(e,s),t){a({keyword:{query:e,type:E.a.Keyword}})}const o=Object(E.g)({query:e,querySrc:s,mode:r,searchFilters:c});this._routeTransition({pathname:i,params:o,src:s}),this.setState({querySubmitted:!0})})),c()(this,"_setInputRef",(e=>{this._inputRef=e})),this.state={query:e.initialValue,querySubmitted:!0,items:[]},this._withNewTypeaheadUI=this.context.featureSwitches.isTrue("responsive_web_account_search_readability_enabled")}componentDidMount(){const{shouldHandleSearchShortcut:e}=this.props;e&&(this._unregisterSearchShortcutHandler=Object(_.b)(this._handleSearchShortcut))}componentWillUnmount(){this._unregisterSearchShortcutHandler&&this._unregisterSearchShortcutHandler()}componentDidUpdate(e){this.props.initialValue!==e.initialValue&&this.setState({query:e.initialValue,querySubmitted:!0})}render(){const{location:e,placeholder:t,history:s,isCompact:a,isInSidebar:r}=this.props,{query:n}=this.state,{location:c}=s,h=c.state||{},{searchPrefill:l}=e.state||{},d=this.props.initialValue||l;let u,p,m;const S=!!e.state&&!!e.state.searchFocused;return h.searchFocused&&(u=this.context.featureSwitches.isTrue("responsive_web_search_reorder_typeahead_results_enabled"),p=!this.context.featureSwitches.isTrue("responsive_web_search_delay_prefetch_typeahead_results_enabled"),m=this.context.featureSwitches.getNumberValue("responsive_web_search_limit_user_typeahead_results")),i.createElement(o.a,{viewType:"search_field"},i.createElement(N.a,{style:Qe.root},i.createElement(je.default,{filter:Ve,forceVdlDisable:!0,getTopicExactMatch:n?qe.e:void 0,getUserExactMatch:n?this._getUserExactMatch:void 0,initialValue:d,inputStyle:Qe.input,isCompact:a,isInSidebar:r,onDismiss:this._handleOnDismiss,onFocus:this._handleOnFocus,onItemClick:this._handleItemClick,onItemsChanged:this._handleItemsChanged,onQueryChange:this._handleChange,onSubmit:this._handleTypeaheadSubmit,orderResults:u?this._reorderResults:void 0,placeholder:t,ref:this._setInputRef,renderEmptyState:this._renderSearchBoxEmptyState,rounded:!0,shouldAutoFocus:S,shouldClearOnSelect:!0,shouldDeferPrefetch:!u,shouldShowPrefetchResults:!!p,source:qe.d.SearchBox,testID:Le,userLimit:m||void 0,withFixedPositioning:!0,withFocusStyling:!0,withSectionDivider:!this._withNewTypeaheadUI})))}}c()(Ke,"defaultProps",{initialValue:"",isInSidebar:!1,placeholder:Me,searchRoute:"/search"}),c()(Ke,"contextType",se.a);const Qe=j.a.create((e=>({root:{alignItems:"stretch",flexBasis:0,flexDirection:"row",flexGrow:1},input:{flexShrink:1}})));t.default=Object(Ne.a)(u(Ke))},hiGS:function(e,t,s){"use strict";var a=s("ERkP"),r=s("Lsrn"),n=s("k/Ka");const c=(e={})=>Object(n.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[r.a.root,e.style],viewBox:"0 0 24 24"},a.createElement("g",null,a.createElement("path",{d:"M20.746 5.236h-3.75V4.25c0-1.24-1.01-2.25-2.25-2.25h-5.5c-1.24 0-2.25 1.01-2.25 2.25v.986h-3.75c-.414 0-.75.336-.75.75s.336.75.75.75h.368l1.583 13.262c.216 1.193 1.31 2.027 2.658 2.027h8.282c1.35 0 2.442-.834 2.664-2.072l1.577-13.217h.368c.414 0 .75-.336.75-.75s-.335-.75-.75-.75zM8.496 4.25c0-.413.337-.75.75-.75h5.5c.413 0 .75.337.75.75v.986h-7V4.25zm8.822 15.48c-.1.55-.664.795-1.18.795H7.854c-.517 0-1.083-.246-1.175-.75L5.126 6.735h13.74L17.32 19.732z"}),a.createElement("path",{d:"M10 17.75c.414 0 .75-.336.75-.75v-7c0-.414-.336-.75-.75-.75s-.75.336-.75.75v7c0 .414.336.75.75.75zm4 0c.414 0 .75-.336.75-.75v-7c0-.414-.336-.75-.75-.75s-.75.336-.75.75v7c0 .414.336.75.75.75z"})));c.metadata={width:24,height:24},t.a=c},kIAd:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return n}));var a=s("0vv5");const r=500,n={scoper:[{type:"dmUserSearch",regexp:/^[@＠]?(.*)|^$/,srcInputs:["compose_message"],scope:{result_type:"users",count:20}},{type:"username",regexp:/^[@＠](\w{1,20})/,srcInputs:["compose"],scope:{result_type:"users",count:20}},{type:"hashtag",regexp:s.n(a).a,srcInputs:["compose"],scope:{result_type:"topics",count:20}},{type:"topic",regexp:/(.+)/,srcInputs:["search_box"],scope:{result_type:"all"}},{type:"ttt",regexp:/(.+)/,srcInputs:["welcome_flow"],scope:{count:10,result_type:"topics,ttt"}}],WordBoundary:/[!'%&'()*+,\\\-./:;<=>?[\]^{|}~\s]|$/,WordEnd:/[^!'%&'()*+,\\\-./:;<=>?[\]^{|}~\s]+$/}},oEoC:function(e,t,s){"use strict";s.d(t,"d",(function(){return r})),s.d(t,"c",(function(){return n})),s.d(t,"b",(function(){return c})),s.d(t,"e",(function(){return i})),s.d(t,"a",(function(){return o}));s("kYxP");var a=s("kIAd");s("GZwR");function r(e,t){let s;const r=a.b.scoper.find((a=>{if(-1!==a.srcInputs.indexOf(t))return s=e.match(a.regexp),s}));let n="";return s&&(n=s&&(1===s.length?s[0]:s[1])),r?{...r.scope,src:t,q:n}:null}function n(e,t){const s=t.slice(0,e),r=t.slice(e,t.length),n=s.search(a.b.WordEnd),c=n>=0?s.slice(n):"",i=r.search(a.b.WordBoundary),o=c+r.slice(0,i);return o.trim()?{start:n,end:e+i,word:o}:{start:-1,end:-1,word:""}}function c(){return`typeaheadFocus-${Math.random()}`}function i(e){const{altKey:t,ctrlKey:s,metaKey:a}=e;return!(t||s||a)}function o(e,t){const s=[];e.forEach((e=>{const a=t.find((t=>t.id===e.id));a&&a.data&&a.data.result_context?s.push(a):s.push(e)}));const a=s.map((e=>e.id)),r=t.filter((e=>a.indexOf(e.id)<0));return[...s,...r]}},rRIm:function(e,t,s){"use strict";s.d(t,"b",(function(){return O}));var a=s("KEM+"),r=s.n(a),n=(s("kYxP"),s("ERkP")),c=s("sTyV"),i=s("6/RC"),o=s("sebV"),h=s("rxPX"),l=s("G6rE"),d=Object(h.a)().propsFromState((()=>({loggedInUser:l.e.selectLoggedInUser}))).adjustStateProps((({loggedInUser:e})=>({loggedInUserScreenName:e?e.screen_name:void 0}))),u=s("3XMw"),p=s.n(u),m=s("OrGc"),S=s("QK5w"),y=s("aITJ"),_=s("MWbm"),f=s("TnY3"),b=s("rHpw"),v=s("t62R"),I=s("v6aA"),E=s("uScj"),g=s("fs1G"),w=s("BcsE"),R=s("VPAj");const C=p.a.b47e760d,T=p.a.fd2c7b43,x=new E.a,k=e=>{if(e.target instanceof HTMLInputElement){const t=e.target.tagName.toLowerCase();return"input"===t||"textarea"===t}return!1},O=e=>{if(!i.canUseDOM)return g.a;return x.subscribe(e).unsubscribe};class D extends n.Component{constructor(...e){super(...e),r()(this,"_bindKeyboardShortcuts",(()=>{const{history:e,loggedInUserScreenName:t}=this.props,s=t=>s=>{s.preventDefault(),x.getListeners().length?x.notify(t):e.push({pathname:"/explore",state:{searchFocused:!0,searchPrefill:t}})},a={[m.e.search]:s(),[m.e.goToUser]:s("@"),[m.e.openKeyboardShortcuts]:()=>e.push("/i/keyboard_shortcuts"),[m.e.goExplore]:()=>e.push("/explore"),[m.e.goSettings]:()=>e.push("/settings")},r=t=>({[m.e.goProfile]:()=>e.push(`/${t}`),[m.e.goLikes]:()=>e.push(`/${t}/likes`),[m.e.goLists]:()=>e.push(`/${t}/lists`)}),n=this.context.featureSwitches.isTrue("responsive_web_moment_maker_enabled"),i=t&&n?{...r(t),[m.e.goMomentMaker]:()=>e.push("/i/moment_maker")}:t?r(t):{},o={...a,...i,[m.e.goHome]:()=>e.push("/home"),[m.e.goDisplay]:()=>e.push("/i/display"),[m.e.goNotifications]:()=>e.push("/notifications"),[m.e.goMentions]:()=>e.push("/notifications/mentions"),[m.e.goMessages]:()=>e.push("/messages"),[m.e.newMessage]:()=>e.push("/messages/compose"),[m.e.newTweet]:()=>e.push("/compose/tweet"),[m.e.goBookmarks]:()=>e.push("/i/bookmarks")},h=this.props.loggedInUserScreenName?o:a;this._unbindKeyboardShortcuts=Object(c.a)(h)})),r()(this,"_handleKeyDown",(e=>{k(e)||"Backspace"!==e.key||(this._backspaceDown=Date.now(),e.preventDefault(),e.stopPropagation())})),r()(this,"_handleKeyUp",(e=>{if(!k(e)&&"Backspace"===e.key){e.preventDefault(),e.stopPropagation();const t=this._backspaceDown,s=!!Object(w.a)(t)&&Date.now()-t<500,a=Object(S.a)({},{location:this.props.location});s&&a?this.props.history.goBack():window.close()}}))}componentDidMount(){this._bindKeyboardShortcuts(),y.b.isKaiOS()&&o.a.isStandaloneApp()&&(document.addEventListener("keydown",this._handleKeyDown),document.addEventListener("keyup",this._handleKeyUp))}componentWillUnmount(){this._unbindKeyboardShortcuts&&this._unbindKeyboardShortcuts(),y.b.isKaiOS()&&o.a.isStandaloneApp()&&(document.removeEventListener("keydown",this._handleKeyDown),document.removeEventListener("keyup",this._handleKeyUp))}render(){return this.props.loggedInUserScreenName?n.createElement(_.a,{accessibilityLevel:2,accessibilityRole:"heading",style:b.a.visuallyHidden},n.createElement(v.c,null,C),n.createElement(v.c,{focusable:!1,link:"/i/keyboard_shortcuts"},T)):null}}r()(D,"contextType",I.a);const U=d(D),A=i.canUseDOM?Object(f.a)(U):Object(R.a)(null);t.a=A},sYRn:function(e,t,s){"use strict";var a=s("ERkP"),r=s("eb3s"),n=s("3XMw"),c=s.n(n);const i=c.a.hffea05c,o=c.a.j037e373,h=c.a.d96cf7cd;t.a=({onCancel:e,onConfirm:t})=>a.createElement(r.a,{confirmButtonLabel:h,confirmButtonType:"destructive",headline:i,onCancel:e,onConfirm:t,text:o})},v4XE:function(e,t,s){"use strict";s.d(t,"d",(function(){return m})),s.d(t,"c",(function(){return S})),s.d(t,"a",(function(){return y})),s.d(t,"b",(function(){return _}));s("kYxP");var a=s("oEOe"),r=s("kGix"),n=s("Ssj5"),c=s("SrIh"),i=s("RqPI");const o="savedSearches",h={fetchStatus:r.a.NONE,savedSearches:[]},l=Object.freeze({REQUEST:"rweb/savedSearches/FETCH_SAVED_SEARCHES_REQUEST",SUCCESS:"rweb/savedSearches/FETCH_SAVED_SEARCHES_SUCCESS",FAILURE:"rweb/savedSearches/FETCH_SAVED_SEARCHES_FAILURE"}),d=Object.freeze({REQUEST:"rweb/savedSearches/SAVE_SEARCH_REQUEST",SUCCESS:"rweb/savedSearches/SAVE_SEARCH_SUCCESS",FAILURE:"rweb/savedSearches/SAVE_SEARCH_FAILURE"}),u=Object.freeze({REQUEST:"rweb/savedSearches/DELETE_SAVED_SEARCH_REQUEST",SUCCESS:"rweb/savedSearches/DELETE_SAVED_SEARCH_SUCCESS",FAILURE:"rweb/savedSearches/DELETE_SAVED_SEARCH_FAILURE"});function p(e=h,t){switch(t.type){case l.SUCCESS:{const s=t.payload,a=Array.isArray(s);return a||Object(c.a)("Saved search results are not type array",{extra:{savedSearchResultsType:typeof s}}),{...e,fetchStatus:r.a.LOADED,savedSearches:a&&s?s:[]}}case l.FAILURE:return{...e,fetchStatus:r.a.FAILED};case d.SUCCESS:return{...e,savedSearches:t.payload?[...e.savedSearches,t.payload]:e.savedSearches};case u.SUCCESS:return t.payload?{...e,savedSearches:e.savedSearches.filter((e=>e.id_str!==t.payload.id_str))}:e;default:return e}}n.a.register({[o]:p});const m=e=>e.savedSearches.savedSearches,S=e=>(t,s,{api:r})=>Object(a.b)(t,{request:r.SavedSearches.create,params:{query:e}})({actionTypes:d,context:"SAVE_SEARCH"}),y=e=>(t,s,{api:r})=>Object(a.b)(t,{request:r.SavedSearches.destroy,params:{id:e}})({actionTypes:u,context:"DELETE_SAVED_SEARCH"}),_=()=>(e,t,{api:s})=>{const n=t();if(!Object(i.j)(n))return Promise.resolve();return(e=>e.savedSearches.fetchStatus)(n)===r.a.LOADED?Promise.resolve():e(((e,t,{api:s})=>Object(a.b)(e,{request:s.SavedSearches.fetch,params:{}})({actionTypes:l,context:"FETCH_SAVED_SEARCHES"})))}}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.Typeahead~bundle.Explore.ee1647c5.js.map